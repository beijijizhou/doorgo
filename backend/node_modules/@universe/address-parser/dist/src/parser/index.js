import { Country, FacilityType, getCountryDesc, isPersonalIdentifier, toCountry, UnitAbbr } from '@universe/models';
import { directionalString, isDirectional, toDirectional } from '../data/Directional.js';
import { isFacilityType, isUrbanization, toFacilityType } from '../data/FacilityType.js';
import { isState, toState } from '../data/State.js';
import { isStreetPrefix, isStreetType, streetTypeString, toStreetType } from '../data/StreetType.js';
import { isUnitAbbr, toUnitAbbr, unitAbbrString } from '../data/UnitAbbr.js';
import { findNextNewLine, hasLaterStreetType, hasStateUnit, isHead, isHyphenatedCode, isNewlineSep, isNumberOrCode, newlineCount, tokenize, } from './tokenizer.js';
import { isNumerical, isOrdinal, normalizeHouseNum, normalizeUnitNum, orderToOrdinal, ordinalToOrder } from './utils.js';
function stripLeadingZeros(str) {
    return str.replace(/^0+/, '');
}
function expandAbbr(token, directional = false, unit = false, street = false, ordinals = false) {
    let value = token.value;
    if (token.prev?.separator) {
        return;
    }
    if (isDirectional(value)) {
        value = (directional ? directionalString(value) : toDirectional(value)) || value;
    }
    if (unit && isUnitAbbr(value)) {
        value = unitAbbrString(value) || value;
    }
    if (street && isStreetType(value)) {
        value = streetTypeString(value) || value;
    }
    value = ordinals ? orderToOrdinal(value) : ordinalToOrder(value);
    token.value = value;
}
function flatten(token) {
    const tokens = [];
    while (token) {
        tokens.push(token);
        token = token.next;
    }
    return tokens;
}
const concat = (input, ...flags) => {
    const out = [];
    const tokens = !Array.isArray(input) ? flatten(input) : input;
    for (const token of tokens) {
        expandAbbr(token, ...flags);
        if (!isStreetType(token.value) && isFacilityType(token.value)) {
            token.value = toFacilityType(token.value) || token.value;
        }
        out.push(token.value);
        if ((token !== tokens[tokens.length - 1] || token.separator === '.')) {
            if (token.isEOL && !token.separator) {
                out.push('\n');
                continue;
            }
            switch (token.separator) {
                case '#':
                    out.push(' # ');
                    break;
                case '.':
                    out.push('.');
                    break;
                case '&':
                    out.push(' & ');
                    break;
                case ',':
                    out.push(', ');
                    break;
                case '-':
                    out.push('-');
                    break;
                case '/':
                    out.push('/');
                    break;
                default: out.push(' ');
            }
        }
    }
    return out.join('').trim();
};
function toForeignSitus(working) {
    return {
        care: concat(working.care) || null,
        facility: null,
        facilityType: null,
        pinType: null,
        pinNum: null,
        number: null,
        streetPreDir: null,
        streetName: null,
        streetType: null,
        streetPostDir: null,
        unitAbbr: null,
        unitNum: null,
        city: null,
        state: null,
        zip: null,
        zip4: null,
        country: working.country,
    };
}
function toSitus(working) {
    const OUT = {
        care: null,
        facility: null,
        facilityType: null,
        pinType: null,
        pinNum: null,
        number: null,
        streetPreDir: null,
        streetName: null,
        streetType: null,
        streetPostDir: null,
        unitAbbr: null,
        unitNum: null,
        city: null,
        state: null,
        zip: null,
        zip4: null,
        country: null,
    };
    OUT.care = concat(working.care, true, true, true, false) || null;
    OUT.facility = concat(working.facility, true, true, false, true) || null;
    OUT.facilityType = working.facilityType ? toFacilityType(working.facilityType.value) : null;
    OUT.pinType = working.pinType ? working.pinType.value.toUpperCase() : null;
    OUT.pinNum = concat(working.pinNum) ? concat(working.pinNum, false, false, false, true).toUpperCase() : null;
    OUT.number = normalizeHouseNum(stripLeadingZeros(concat(working.number, true, true, true, true))) || null;
    OUT.streetPreDir = working.streetPreDir ? toDirectional(working.streetPreDir.value) : null;
    OUT.streetName = stripLeadingZeros(concat(working.streetName, false, true, true, true)) || null;
    OUT.streetType = working.streetType ? toStreetType(working.streetType.value) : null;
    OUT.streetPostDir = working.streetPostDir ? toDirectional(working.streetPostDir.value) : null;
    OUT.unitAbbr = working.unitAbbr ? toUnitAbbr(working.unitAbbr.value) : null;
    OUT.unitNum = normalizeUnitNum(working.unitNum) || null;
    OUT.city = concat(working.city, true, false, false, false) || null;
    OUT.state = working.state ? toState(working.state.value) : null;
    OUT.zip = working.zip?.value || null;
    OUT.zip4 = working.zip4?.value || null;
    OUT.country = working.country; // We catch foreign addresses early. Everything that makes it this far will be USA.
    if (OUT.facilityType === FacilityType.PO && OUT.unitAbbr === UnitAbbr.BOX) {
        OUT.unitNum = OUT.unitNum ? OUT.unitNum.replace(/ /g, '').toUpperCase() : null;
    }
    return OUT;
}
function consumeIds(pointer, hyphensOnly = false) {
    const ids = [];
    while (pointer && isNumberOrCode(pointer)) {
        ids.push(pointer);
        pointer = pointer.next;
        if (hyphensOnly && pointer?.prev && !isHyphenatedCode(pointer.prev)) {
            break;
        }
        if (pointer?.prev && isNewlineSep(pointer.prev)) {
            break;
        }
    }
    return [ids, pointer];
}
function consumeLine(pointer) {
    const ids = [];
    while (pointer) {
        ids.push(pointer);
        pointer = pointer.next;
        if (pointer?.prev && isNewlineSep(pointer.prev)) {
            break;
        }
    }
    return [ids, pointer];
}
function isLikelyFinalLine(pointer) {
    let foundToken = false;
    let foundCode = false;
    while (pointer) {
        if (isStreetType(pointer.value) || isUnitAbbr(pointer.value)) {
            foundToken = true;
        }
        if (isNumberOrCode(pointer.value)) {
            foundCode = true;
        }
        if (foundToken && foundCode) {
            return false;
        }
        if (isState(pointer.value) && pointer.next && pointer.next.alphas === 0 && pointer.next.decimals === 5) {
            return true;
        }
        if (isNewlineSep(pointer)) {
            return false;
        }
        pointer = pointer.next;
    }
    return true;
}
function isLastState(pointer) {
    if (!pointer) {
        return false;
    }
    if (!isState(pointer.value)) {
        return false;
    }
    pointer = pointer.next;
    while (pointer) {
        if (isState(pointer.value)) {
            return false;
        }
        pointer = pointer.next;
    }
    return true;
}
function isOnlyIds(pointer) {
    while (pointer) {
        if (!isNumberOrCode(pointer) || isOrdinal(pointer.value) || isDirectional(pointer.value) || isStreetType(pointer.value) || isUnitAbbr(pointer.value)) {
            return false;
        }
        if (isNewlineSep(pointer)) {
            break;
        }
        pointer = pointer.next;
    }
    return true;
}
function isForeignAddress(head, out) {
    if (!head.next) {
        return false;
    }
    let pointer = head.next;
    while (pointer.next) {
        pointer = pointer.next;
    }
    let countryTest = '';
    while (pointer !== head) {
        if (isHead(pointer)) {
            break;
        } // Mostly for Typescript
        if (isNewlineSep(pointer)) {
            break;
        }
        countryTest = [pointer.value, countryTest].filter(Boolean).join(' ');
        // Don't interpret partial addresses ending in a standard data abbreviation value as foreign.
        if (toState(countryTest) || toStreetType(countryTest) || toUnitAbbr(countryTest)) {
            continue;
        }
        const country = toCountry(countryTest);
        if (!country) {
            pointer = pointer.prev;
            continue;
        }
        const desc = getCountryDesc(country);
        if (!desc) {
            pointer = pointer.prev;
            continue;
        }
        if (country === Country.USA || desc.sovereignty === Country.USA) {
            out.country = Country.USA;
            pointer.prev.next = null;
            return false;
        }
        // Handle corner case with addresses that end with "Del Mar".
        if (country === Country.MAR && !pointer.prev.isEOL && pointer.prev?.value?.toLowerCase() === 'del') {
            return false;
        }
        pointer.prev.next = null;
        out.care = flatten(head.next);
        out.country = country;
        return true;
    }
    return false;
}
// Extract care-of lines where we have a definite match.
// TODO: Add more definitive company types here...
const CompanyTypes = new Set(['UNIVERSITY', 'COLLEGE', 'SERVICES', 'TAW']);
const WellKnownCare = new Set(['GENERAL DELIVERY']); // Special Post Office Term
function extractCareOf(head, out) {
    let lineStart = head.next;
    let pointer = head.next;
    let OUT = [];
    let foundStart = false;
    let foundStreetType = false;
    let foundFacilityType = false;
    let foundDefiniteMatch = false;
    let hasCodeTokens = false;
    while (pointer) {
        // If the first value is a straight number, this is likely not a care of line, its a street! Skip.
        if (!foundStart && !pointer.alphas && pointer.decimals) {
            return;
        }
        // If this is a PIN Type, collect accordingly. Ignore pins separated by '&' (ex: A & M Liquors)
        else if (pointer.separator === '&' || pointer.prev.separator === '&') {
            1;
        }
        else if (isNumberOrCode(pointer)) {
            hasCodeTokens = true;
        }
        else if (isStreetType(pointer.value) && !pointer.prev.separator) {
            foundStreetType = true;
        }
        else if (isFacilityType(pointer.value) && !pointer.prev.separator) {
            foundFacilityType = true;
        }
        else if (CompanyTypes.has(pointer.value.toUpperCase())) {
            foundDefiniteMatch = true;
        }
        foundStart = true;
        OUT.push(pointer);
        if (WellKnownCare.has(OUT.map(p => p.value).join(' ').toUpperCase())) {
            foundDefiniteMatch = true;
            pointer.isEOL = true;
        }
        // If we just finished a line, check if is valid.
        if (isNewlineSep(pointer)) {
            // If this line is a definite care-of match, break!
            if (((!foundStreetType && !hasCodeTokens) || (foundStreetType && !hasCodeTokens) || (foundDefiniteMatch && !foundStreetType)) && !foundFacilityType) {
                break;
            }
            lineStart = pointer.next;
            foundFacilityType = false;
            foundStreetType = false;
            foundDefiniteMatch = false;
            OUT = [];
        }
        pointer = pointer.next;
    }
    // If this line is a definite care-of match, splice it out of the linked list and return the tokens!
    if (lineStart && ((!foundStreetType && !hasCodeTokens) || (foundStreetType && !hasCodeTokens) || (foundDefiniteMatch && !foundStreetType)) && !foundFacilityType) {
        lineStart.prev.next = pointer?.next || null;
        lineStart.prev.isEOL = pointer?.isEOL || false;
        pointer?.next && (pointer.next.prev = lineStart.prev);
        out.care = OUT;
    }
}
function extractPID(head, out) {
    // Extract well know PID types if we can find a definite match.
    let pointer = head.next;
    while (pointer) {
        // If this is a PIN Type, collect accordingly.
        if (pointer && isPersonalIdentifier(pointer.value.toUpperCase())) {
            const pid = pointer;
            pointer = pointer.next;
            const [ids, next] = consumeLine(pointer);
            if (ids.length === 0) {
                continue;
            }
            // There is ambiguity between the "MS" abbreviation for "Mail Stop" and "Mississippi".
            // Ensure we're not accidentally scooping up the state and zip here.
            if (pid.value.toUpperCase() === 'MS' && isLikelyFinalLine(pid)) {
                continue;
            }
            out.pinType = pid;
            out.pinNum = ids;
            pointer = next;
            // Splice the entire PIN statement out of the linked list.
            pid.prev.next = next;
            if (!isHead(pid.prev) && !isHead(next?.prev)) {
                pid.prev.separator = next?.prev?.separator || null;
                pid.prev.isEOL = next?.prev?.isEOL || false;
            }
            next && (next.prev = pid.prev);
            continue;
        }
        pointer = pointer.next;
    }
}
function extractFacility(pointer, out) {
    let facility = [];
    let facilityType = null;
    let number = [];
    let pinNum = [];
    let unitAbbr = null;
    let unitNum = [];
    facilityLine: while (pointer) {
        // If is a known facility type, save this as a standard value.
        if (!facilityType && toFacilityType(pointer.value)) {
            facilityType = pointer;
            pointer = pointer.next;
        }
        // If is a unit abbreviation then someone put the unit on the facility line! Accommodate.
        else if (toUnitAbbr(pointer.value)) {
            const prevUnitAbbr = unitAbbr;
            unitAbbr = pointer;
            pointer = pointer.next;
            // Consume identifiers until there are no more unit ids.
            const [ids, next] = consumeIds(pointer);
            // If there is no valid unitNum, then this unit abbr must be part of the facility name.
            if (!ids.length) {
                facility.push(unitAbbr);
                unitAbbr = prevUnitAbbr;
            }
            else {
                unitNum = ids;
                pointer = next;
            }
        }
        // If we've found a number or code, preserve it. This will never run first.
        else if (isNumberOrCode(pointer)) {
            // We only get one (non-hyphenated) number identifier for enumerated facilities. Everything following must be a unit or PIN.
            const isFindNumber = !!(facilityType && !number.length);
            // Fetch all our id tokens.
            const [ids, next] = consumeIds(pointer, isFindNumber);
            // To store as a number or pin, it must actually contain a number!
            let hasNum = false;
            for (const id of ids) {
                if (id.value.match(/\d/)) {
                    hasNum = true;
                    break;
                }
            }
            if (!hasNum) {
                facility = [...facility, ...ids];
            }
            else if (isFindNumber) {
                number = ids;
            }
            else {
                pinNum = ids;
            }
            pointer = next;
        }
        // Otherwise, this is part of the facility name. Save and continue on.
        // If we already have a number going, it was actually party of the facility name.
        // Don't overwrite explicitly named PINs discovered earlier.
        else {
            facility = [...facility, ...number, ...pinNum, pointer];
            number = [];
            pinNum = [];
            pointer = pointer.next;
        }
        // If this is the first token on a new line, break. Facility strings must always be on the first line.
        if (pointer && isNewlineSep(pointer.prev)) {
            break facilityLine;
        }
    }
    if (out.pinNum.length && pinNum.length && !out.pinType) {
        out.facility.push(...out.pinNum);
    }
    if (out.facilityType && facilityType) {
        out.facility.push(out.facilityType);
    }
    if (out.number.length && number.length && !out.pinType) {
        out.pinNum = out.number;
    }
    // Promote the previous facility name to the care line if it isn't already specified.
    if (!out.care.length && !out.facilityType && facility.length) {
        out.care = [...out.facility, ...(!out.pinType ? out.pinNum : [])].filter(Boolean);
        out.facility = [];
        out.pinNum = out.pinType ? out.pinNum : [];
    }
    // If we've added new facility strings (we may find multiple...) add a comma to delineate.
    if (facility.length) {
        const last = out.facility[out.facility.length - 1];
        last && (last.separator = ',');
    }
    out.facility = [...out.facility, ...facility];
    out.facilityType = facilityType || out.facilityType;
    out.number = number.length ? number : out.number;
    out.pinNum = pinNum.length ? pinNum : out.pinNum;
    out.unitAbbr = unitAbbr || out.unitAbbr;
    out.unitNum = unitNum.length ? unitNum : out.unitNum;
    // If we have a facility type and number, but no facility name, use the number as the facility name – its more accurate.
    if (!out.care.length && out.facilityType && out.number.length && !out.facility.length) {
        out.facility = out.number;
        out.number = [];
    }
    return pointer;
}
export function parse(...lines) {
    const address = lines.filter(Boolean).join('\n');
    const head = tokenize(address);
    const OUT = {
        care: [],
        facility: [],
        facilityType: null,
        number: [],
        streetPreDir: null,
        streetName: [],
        streetType: null,
        streetPostDir: null,
        pinType: null,
        pinNum: [],
        unitAbbr: null,
        unitNum: [],
        city: [],
        state: null,
        zip: null,
        zip4: null,
        country: Country.USA,
    };
    // Test if this is a foreign address. If yes, we short circuit quickly.
    if (isForeignAddress(head, OUT)) {
        return toForeignSitus(OUT);
    }
    // Extract PIDs where we can find a definite match.
    // Do this before extracting obvious Care-Of lines.
    extractPID(head, OUT);
    // Extract Care Of lines where we can find a definite match.
    extractCareOf(head, OUT);
    let pointer = head.next;
    // If a the user puts the unit type and number first, excluding ones that can also be
    // interpreted as facility types, on the first line, make sure we pick it up.
    if (pointer && isUnitAbbr(pointer.value) && !isFacilityType(pointer.value)) {
        OUT.unitAbbr = pointer;
        pointer = pointer.next;
        const [ids, next] = consumeIds(pointer, true);
        OUT.unitNum = ids;
        pointer = next;
    }
    // If the very first token is not a number or code, then the first line of our address must be
    // the facility type, facility name, or an accidental leading unit number. Repeat ad-nauseam.
    if (pointer &&
        (!isLikelyFinalLine(pointer) || (!newlineCount(head) && !OUT.care.length)) &&
        !isStreetPrefix(pointer?.value) &&
        (isOnlyIds(pointer) || !isNumberOrCode(pointer) || (pointer && (isOrdinal(pointer.value))))) {
        pointer = extractFacility(pointer, OUT);
    }
    while (!isLikelyFinalLine(pointer) &&
        findNextNewLine(pointer) &&
        !isStreetPrefix(pointer?.value) &&
        (isOnlyIds(pointer) || !isNumberOrCode(pointer) || (pointer && (isOrdinal(pointer.value))))) {
        pointer = extractFacility(pointer, OUT);
    }
    // If a facility list leads, and the user puts the unit number first on a second line, make sure we pick it up.
    if (pointer && isUnitAbbr(pointer.value)) {
        OUT.unitAbbr = pointer;
        pointer = pointer.next;
        const [ids, next] = consumeIds(pointer, true);
        OUT.unitNum = ids;
        pointer = next;
    }
    let isFinalLine = isLikelyFinalLine(pointer);
    // If we have a single letter street name and no street suffix (ugh) ex: 300 H, BENICIA, CA 94510
    if (isFinalLine && OUT.pinNum.length > 1 && OUT.pinNum[OUT.pinNum.length - 1].value.length === 1 && OUT.pinNum[OUT.pinNum.length - 1].alphas === 1) {
        const token = OUT.pinNum.pop();
        token && OUT.streetName.push(token);
        OUT.number = OUT.pinNum;
        OUT.pinNum = [];
    }
    // Consume house number
    while (pointer && !isFinalLine) {
        // If we're on the second line, move on!
        if (OUT.number.length && pointer.prev && isNewlineSep(pointer.prev)) {
            isFinalLine = true;
            break;
        }
        // Stop consuming house number values when a directional or street name is encountered.
        const val = pointer.value;
        if (pointer.alphas > 2 || (pointer.alphas >= 2 && !pointer.decimals) || isOrdinal(val) || isDirectional(val) || isUnitAbbr(val) || isStreetType(val)) {
            break;
        }
        // Save this token as part of the house number.
        // Alphas are always upper case for house numbers.
        OUT.number.push(pointer);
        pointer = pointer.next;
    }
    // Consume directional if available
    if (pointer && !isFinalLine && isDirectional(pointer.value)) {
        OUT.streetPreDir = pointer;
        pointer = pointer.next;
    }
    // Consume street prefix if available
    if (pointer && !isFinalLine && isStreetPrefix(pointer.value)) {
        OUT.streetType = pointer;
        pointer = pointer.next;
    }
    // // Sometimes street prefixes use two tokens.
    // if (pointer && !isFinalLine && isStreetPrefix(pointer.value + ' ' + pointer.next?.value)) {
    //   OUT.streetType = pointer;
    //   pointer = pointer.next?.next || null;
    // }
    // Consume street name until encounter street type, unit abbreviation, or another directional.
    while (pointer && !isFinalLine) {
        // If we're on the second line, move on!
        if (OUT.streetName.length && pointer.prev && isNewlineSep(pointer.prev)) {
            isFinalLine = true;
            break;
        }
        // Addresses with a specified facility type, that is not an urbanization, should never nave street names.
        if (OUT.facilityType && !isUrbanization(OUT.facilityType.value)) {
            break;
        }
        // A pound sign separator in the street name means we've moved on to a new segment.
        if (pointer.prev && pointer.prev.separator === '#') {
            break;
        }
        // If we're not told where the "city state zip" line starts, we need to make a choice when to stop and start consuming city names.
        // If this is the case, and we encounter something that looks like a unit number, move on to the next step.
        if (OUT.streetName.length && !findNextNewLine(pointer) && hasStateUnit(pointer) && (isNumberOrCode(pointer) || isStreetType(pointer.value))) {
            break;
        }
        // Account for "Directional" Streets (ex: South St.)
        if (OUT.streetPreDir && !OUT.streetName.length && isStreetType(pointer.value) && !isStreetPrefix(pointer.value) && !hasLaterStreetType(pointer, true)) {
            OUT.streetName = [OUT.streetPreDir];
            OUT.streetPreDir = null;
            break;
        }
        // If we have a single letter street name and no street suffix (ugh) ex: 300 H Apt: 111, BENICIA, CA 94510
        if (OUT.number.length > 1 &&
            OUT.number[OUT.number.length - 1].value.length === 1 &&
            OUT.number[OUT.number.length - 1].alphas === 1 &&
            (isUnitAbbr(pointer.value) || isStreetType(pointer.value))) {
            const token = OUT.number.pop();
            token && OUT.streetName.push(token);
            break;
        }
        // If we have a street name, and we're at an enumerable entry, move on.
        if (OUT.streetName.length && ((isStreetType(pointer.value) && !hasLaterStreetType(pointer, true)) || isUnitAbbr(pointer.value) || isDirectional(pointer.value))) {
            break;
        }
        OUT.streetName.push(pointer);
        pointer = pointer.next;
    }
    const working = {
        streetType: null,
        unitAbbr: null,
        streetPostDir: null,
    };
    while (pointer && !isFinalLine) {
        // If we're on the second line, move on to the city parser!
        if (pointer.prev && isNewlineSep(pointer.prev)) {
            isFinalLine = isLikelyFinalLine(pointer);
            break;
        }
        // If is a street type, save it and move on.
        if (isStreetType(pointer.value)) {
            if (working.streetType) {
                OUT.streetName.push(working.streetType);
            }
            working.streetType = pointer;
        }
        // If is a unit abbreviation, deal with duplicates if street isn't done and save.
        else if (isUnitAbbr(pointer.value)) {
            if ((OUT.unitAbbr || hasLaterStreetType(pointer)) && working.unitAbbr) {
                OUT.streetName.push(working.unitAbbr);
            }
            working.unitAbbr = pointer;
        }
        // If is a post directional, deal with duplicates if street isn't done and save.
        else if (isDirectional(pointer.value) && !working.unitAbbr) {
            if (working.streetPostDir && working.streetType === null) {
                OUT.streetName.push(working.streetPostDir);
            }
            working.streetPostDir = pointer;
        }
        // If we didn't find any of these things, we must be moving on to the unit number!
        else {
            break;
        }
        // If we found one of these tokens, move on to the next one to check.
        pointer = pointer.next;
    }
    // Save what we've found to the OUT. Don't overwrite the unitAbbr if we already have one from a previous line.
    OUT.streetType = working.streetType || OUT.streetType;
    OUT.streetPostDir = working.streetPostDir || OUT.streetPostDir;
    OUT.unitAbbr = OUT.unitAbbr || working.unitAbbr;
    working.streetPostDir = null;
    working.unitAbbr = null;
    working.streetType = null;
    // If we have a no street information, already have unit info, and have tokens left in this line
    // then we're looking at the second line of a facility style address. Store the rest of this in
    // the street name (typically a department, university name, etc) and move on.
    if (OUT.unitAbbr && !OUT.streetName.length && findNextNewLine(pointer)) {
        while (pointer && !isFinalLine) {
            if (pointer.prev && isNewlineSep(pointer.prev)) {
                isFinalLine = isLikelyFinalLine(pointer);
                break;
            }
            OUT.streetName.push(pointer);
            pointer = pointer?.next;
        }
    }
    else {
        // Consume unit num until encounter street type, unit abbreviation, or another directional.
        // Unit numbers can be single letters "S", numbers "123", numerical "13th", etc.
        let tossOnNextUnitNum = false;
        const hasFutureNewline = !!findNextNewLine(pointer);
        const init = pointer?.prev;
        while (pointer && !isFinalLine) {
            // If we're on the second line, move on to the city parser!
            if (pointer.prev && pointer.prev !== init && isNewlineSep(pointer.prev)) {
                isFinalLine = isLikelyFinalLine(pointer);
                break;
            }
            if (isFacilityType(pointer.value) && !isUnitAbbr(pointer.value)) {
                OUT.facilityType = pointer;
                pointer = pointer.next;
                continue;
            }
            // If this is a unit abbr as a type (ex: "Floor", "Penthouse"), save it and move on.
            if (isUnitAbbr(pointer.value)) {
                const oldUnitAbbr = OUT.unitAbbr;
                OUT.unitAbbr = pointer;
                pointer = pointer.next;
                // If is a unit abbr, and we've already found a unit abbreviation, be prepared to toss our old unit num.
                if (oldUnitAbbr !== OUT.unitAbbr) {
                    // break;
                    tossOnNextUnitNum = true;
                    continue;
                }
                OUT.unitNum = [];
                continue;
            }
            // If this is a directional, push the abbreviation to the unit number path.
            // Ex: East and West buildings on a campus "25 Sierra St Apt #123 East"
            if (isDirectional(pointer.value) && (!hasFutureNewline || isNewlineSep(pointer))) {
                pointer.value = toDirectional(pointer.value);
                pointer.alphas = pointer.value.length;
                OUT.unitNum.push(pointer);
                pointer = pointer.next;
                continue;
            }
            // If we're not told where the "city state zip" line starts, we need to make a choice when to stop and start consuming city names.
            // Most of the time, we'll just be left with unit numbers at this point
            if (!hasFutureNewline && !isNumberOrCode(pointer)) {
                break;
            }
            if (tossOnNextUnitNum) {
                OUT.unitNum = [];
                tossOnNextUnitNum = false;
            }
            OUT.unitNum.push(pointer);
            pointer = pointer.next;
        }
    }
    // Consume city name until encounter a state abbreviation or a number (presumably a zip code).
    while (pointer) {
        if (!pointer.separator && (isNumberOrCode(pointer) || isLastState(pointer))) {
            break;
        }
        OUT.city.push(pointer);
        pointer = pointer.next;
    }
    // Consume State if available
    if (pointer && isState(pointer.value)) {
        OUT.state = pointer;
        pointer = pointer.next;
    }
    // If we're at the end and we have a string with no alphas, its a zip code.
    if (pointer && pointer.alphas === 0) {
        OUT.zip = pointer;
        pointer = pointer.next;
    }
    // If we're at the end and we have a string with no alphas...again, then its a zip+4 code.
    if (pointer && pointer.alphas === 0) {
        OUT.zip4 = pointer;
        pointer = pointer.next;
    }
    // Common Error Corrections! Order is important here.
    // Some streets have the street type as a *prefix* not a *type*. Catch these. Ignore for "directional" streets (ex: South St.)
    if (!OUT.streetType && isStreetType(OUT.streetName[0]?.value) && (isNumberOrCode(OUT.streetName[1]) || (OUT.streetName[1]?.value || '').toLowerCase() === 'of')) {
        OUT.streetType = OUT.streetName.shift();
    }
    // Another error case. If we don't have a street type, and the street name *is* a type,
    // save it as the type value. Ex: 100 Lake APT 200
    if (!OUT.streetType && OUT.streetName.length === 1 && isStreetType(OUT.streetName[0].value)) {
        OUT.streetType = OUT.streetName[0];
        OUT.streetName = [];
    }
    // If we don't have a street type or unit abbreviation, check to make sure
    // the unit number didn't accidentally get appended to the street name.
    // This is an error case where we try to do the less likely bad thing.
    if (OUT.streetName.length && !OUT.streetType && !OUT.streetPostDir && !OUT.unitAbbr) {
        if (isNumerical(OUT.streetName[OUT.streetName.length - 1].value)) {
            OUT.unitNum.push(OUT.streetName.pop());
        }
    }
    // When we have a city name that contains a street type (ex '211 OLIVER ST BUENA VISTA 31803'), don't
    // pull the city name into the street name by accident.
    if (OUT.streetType && OUT.streetName.length && !OUT.city.length && OUT.unitNum.length === 1 && OUT.unitNum[0].value.length === 5 && !OUT.unitNum[0].alphas) {
        let streetType = null;
        const streetName = [];
        const city = [];
        for (const token of OUT.streetName) {
            if (isStreetType(token.value) && !streetType) {
                streetType = token;
            }
            else {
                streetType ? city.push(token) : streetName.push(token);
            }
        }
        if (streetType) {
            city.push(OUT.streetType);
            OUT.streetType = streetType;
            OUT.streetName = streetName;
            OUT.city = city;
            OUT.zip = OUT.unitNum[0];
            OUT.unitNum = [];
        }
    }
    // If we have no street name, and the last character of the houseNum is a single character,
    // This must be a single letter street name! Ex: 123 H St.
    if (!OUT.streetName.length && OUT.number.length > 1) {
        const working = [];
        do {
            const token = OUT.number.pop();
            if (working.length && !token.separator) {
                OUT.number.push(token);
                break;
            }
            working.unshift(token);
        } while (OUT.number.length);
        OUT.streetName = working;
    }
    // AAAAAaaaaand another. If no street number, but we have a unit number, and the street type
    // is not one of our special standalone street designators (just 'PO' right now for PO Boxes),
    // then the input must have listed the street number after the street name.
    // Ex: S St 305, Sacramento CA, but not PO Box 1337
    if (!OUT.number.length && ((OUT.unitNum.length === 1 && !OUT.unitAbbr) || (OUT.unitNum.length > 1 && !OUT.facilityType))) {
        OUT.number.push(OUT.unitNum.pop());
    }
    // If we don't have an explicit unit abbr, and the unit number is not a... number,
    // then it must be a mis-ordered company name field.
    if (!OUT.unitAbbr && !OUT.care.length && OUT.unitNum.length) {
        let hasCode = false;
        for (const token of OUT.unitNum) {
            let isCode = false;
            if (isOrdinal(token.value)) {
                isCode = false;
            }
            else {
                isCode = isNumberOrCode(token);
            }
            hasCode = hasCode || isCode;
        }
        if (!hasCode) {
            OUT.care = OUT.unitNum;
            OUT.unitNum = [];
        }
    }
    // Fix split PO Box numbers. If a PO Box has been provided, we can assume that the more common human
    // error will be to add extra spaces or separators instead of providing un-delineated additional PINs.
    if (toFacilityType(OUT.facilityType?.value || '') === FacilityType.PO && toUnitAbbr(OUT.unitAbbr?.value || '') === UnitAbbr.BOX && OUT.unitNum.length > 1) {
        const first = OUT.unitNum.shift();
        first.separator = null;
        for (const token of OUT.unitNum) {
            first.value += token.value;
        }
        OUT.unitNum = [first];
    }
    // If we have a non explicitly named facility type, and no care-of field or a pin of an
    // unknown type, promote the arbitrary "facility" name to the care-of line.
    if (!OUT.facilityType && OUT.facility.length && !OUT.care.length) {
        OUT.care = OUT.facility;
        OUT.facility = [];
    }
    if (OUT.care.length) {
        const last = OUT.care[OUT.care.length - 1];
        if (last && (last.value.toUpperCase() === 'LIMITED' || last.value.toUpperCase() === 'LTD')) {
            OUT.care.pop();
        }
    }
    const lastNum = OUT.number[OUT.number.length - 1];
    if (OUT.number.length > 1 && lastNum && (!lastNum.prev.separator || lastNum.decimals === 0)) {
        OUT.unitNum.push(OUT.number.pop());
    }
    if (OUT.facilityType && toFacilityType(OUT.facilityType?.value) === FacilityType.PO) {
        OUT.unitAbbr = {
            value: UnitAbbr.BOX,
            prev: OUT.facilityType,
            next: OUT.facilityType.next,
            decimals: 0,
            alphas: 3,
            separator: null,
            isEOL: OUT.facilityType.isEOL,
        };
        OUT.facilityType.next = OUT.unitAbbr;
    }
    // CORRECTION! For ordinal unit numbers appearing after street name, like "20th Floor"
    // if (OUT.facility.length === 1 && isUnitAbbr(OUT.facility[0].value) && OUT.pinNum.length && !OUT.unitAbbr && !OUT.unitNum.length) {
    //   OUT.unitAbbr = OUT.care[0];
    //   OUT.unitNum = OUT.pinNum;
    //   OUT.care = [];
    //   OUT.pinNum = [];
    // }
    return toSitus(OUT);
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvcGFyc2VyL2luZGV4LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxPQUFPLEVBQUUsWUFBWSxFQUFFLGNBQWMsRUFBVSxvQkFBb0IsRUFBc0IsU0FBUyxFQUFFLFFBQVEsRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBRWhKLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxhQUFhLEVBQUUsYUFBYSxFQUFFLE1BQU0sd0JBQXdCLENBQUM7QUFDekYsT0FBTyxFQUFFLGNBQWMsRUFBRSxjQUFjLEVBQUMsY0FBYyxFQUFFLE1BQU0seUJBQXlCLENBQUM7QUFDeEYsT0FBTyxFQUFFLE9BQU8sRUFBQyxPQUFPLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQztBQUNuRCxPQUFPLEVBQUUsY0FBYyxFQUFDLFlBQVksRUFBRSxnQkFBZ0IsRUFBRSxZQUFZLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUNwRyxPQUFPLEVBQUUsVUFBVSxFQUFDLFVBQVUsRUFBRSxjQUFjLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUM1RSxPQUFPLEVBQ0wsZUFBZSxFQUNmLGtCQUFrQixFQUNsQixZQUFZLEVBRVosTUFBTSxFQUNOLGdCQUFnQixFQUNoQixZQUFZLEVBQ1osY0FBYyxFQUNkLFlBQVksRUFFWixRQUFRLEdBQ1QsTUFBTSxnQkFBZ0IsQ0FBQztBQUN4QixPQUFPLEVBQUUsV0FBVyxFQUFFLFNBQVMsRUFBRSxpQkFBaUIsRUFBRSxnQkFBZ0IsRUFBRSxjQUFjLEVBQUMsY0FBYyxFQUFFLE1BQU0sWUFBWSxDQUFDO0FBRXhILFNBQVMsaUJBQWlCLENBQUMsR0FBVztJQUNwQyxPQUFPLEdBQUcsQ0FBQyxPQUFPLENBQUMsS0FBSyxFQUFFLEVBQUUsQ0FBQyxDQUFDO0FBQ2hDLENBQUM7QUF5QkQsU0FBUyxVQUFVLENBQUMsS0FBWSxFQUFFLFdBQVcsR0FBRyxLQUFLLEVBQUUsSUFBSSxHQUFHLEtBQUssRUFBRSxNQUFNLEdBQUcsS0FBSyxFQUFFLFFBQVEsR0FBRyxLQUFLO0lBQ25HLElBQUksS0FBSyxHQUFHLEtBQUssQ0FBQyxLQUFLLENBQUM7SUFDeEIsSUFBSSxLQUFLLENBQUMsSUFBSSxFQUFFLFNBQVMsRUFBRSxDQUFDO1FBQUMsT0FBTztJQUFDLENBQUM7SUFDdEMsSUFBSSxhQUFhLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQztRQUFDLEtBQUssR0FBRyxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUMsaUJBQWlCLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLGFBQWEsQ0FBQyxLQUFLLENBQUMsQ0FBQyxJQUFJLEtBQUssQ0FBQztJQUFDLENBQUM7SUFDL0csSUFBSSxJQUFJLElBQUksVUFBVSxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUM7UUFBQyxLQUFLLEdBQUcsY0FBYyxDQUFDLEtBQUssQ0FBQyxJQUFJLEtBQUssQ0FBQztJQUFDLENBQUM7SUFDMUUsSUFBSSxNQUFNLElBQUksWUFBWSxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUM7UUFBQyxLQUFLLEdBQUcsZ0JBQWdCLENBQUMsS0FBSyxDQUFDLElBQUksS0FBSyxDQUFDO0lBQUMsQ0FBQztJQUNoRixLQUFLLEdBQUcsUUFBUSxDQUFDLENBQUMsQ0FBQyxjQUFjLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLGNBQWMsQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUNqRSxLQUFLLENBQUMsS0FBSyxHQUFHLEtBQUssQ0FBQztBQUN0QixDQUFDO0FBRUQsU0FBUyxPQUFPLENBQUMsS0FBbUI7SUFDbEMsTUFBTSxNQUFNLEdBQVksRUFBRSxDQUFDO0lBQzNCLE9BQU8sS0FBSyxFQUFFLENBQUM7UUFDYixNQUFNLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ25CLEtBQUssR0FBRyxLQUFLLENBQUMsSUFBSSxDQUFDO0lBQ3JCLENBQUM7SUFDRCxPQUFPLE1BQU0sQ0FBQztBQUNoQixDQUFDO0FBRUQsTUFBTSxNQUFNLEdBQUcsQ0FBQyxLQUFzQixFQUFFLEdBQUcsS0FBZ0IsRUFBRSxFQUFFO0lBQzdELE1BQU0sR0FBRyxHQUFHLEVBQUUsQ0FBQztJQUNmLE1BQU0sTUFBTSxHQUFZLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUM7SUFFdkUsS0FBSyxNQUFNLEtBQUssSUFBSSxNQUFNLEVBQUUsQ0FBQztRQUMzQixVQUFVLENBQUMsS0FBSyxFQUFFLEdBQUcsS0FBSyxDQUFDLENBQUM7UUFDNUIsSUFBSSxDQUFDLFlBQVksQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLElBQUksY0FBYyxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDO1lBQzlELEtBQUssQ0FBQyxLQUFLLEdBQUcsY0FBYyxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsSUFBSSxLQUFLLENBQUMsS0FBSyxDQUFDO1FBQzNELENBQUM7UUFDRCxHQUFHLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUN0QixJQUFJLENBQUMsS0FBSyxLQUFLLE1BQU0sQ0FBQyxNQUFNLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxJQUFJLEtBQUssQ0FBQyxTQUFTLEtBQUssR0FBRyxDQUFDLEVBQUUsQ0FBQztZQUNyRSxJQUFJLEtBQUssQ0FBQyxLQUFLLElBQUksQ0FBQyxLQUFLLENBQUMsU0FBUyxFQUFFLENBQUM7Z0JBQ3BDLEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7Z0JBQ2YsU0FBUztZQUNYLENBQUM7WUFDRCxRQUFRLEtBQUssQ0FBQyxTQUFTLEVBQUUsQ0FBQztnQkFDeEIsS0FBSyxHQUFHO29CQUFFLEdBQUcsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7b0JBQUMsTUFBTTtnQkFDakMsS0FBSyxHQUFHO29CQUFFLEdBQUcsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7b0JBQUMsTUFBTTtnQkFDL0IsS0FBSyxHQUFHO29CQUFFLEdBQUcsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7b0JBQUMsTUFBTTtnQkFDakMsS0FBSyxHQUFHO29CQUFFLEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7b0JBQUMsTUFBTTtnQkFDaEMsS0FBSyxHQUFHO29CQUFFLEdBQUcsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7b0JBQUMsTUFBTTtnQkFDL0IsS0FBSyxHQUFHO29CQUFFLEdBQUcsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7b0JBQUMsTUFBTTtnQkFDL0IsT0FBTyxDQUFDLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUN6QixDQUFDO1FBQ0gsQ0FBQztJQUNILENBQUM7SUFDRCxPQUFPLEdBQUcsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUM7QUFDN0IsQ0FBQyxDQUFDO0FBRUYsU0FBUyxjQUFjLENBQUMsT0FBcUI7SUFDM0MsT0FBTztRQUNMLElBQUksRUFBRSxNQUFNLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxJQUFJLElBQUk7UUFDbEMsUUFBUSxFQUFFLElBQUk7UUFDZCxZQUFZLEVBQUUsSUFBSTtRQUNsQixPQUFPLEVBQUUsSUFBSTtRQUNiLE1BQU0sRUFBRSxJQUFJO1FBRVosTUFBTSxFQUFFLElBQUk7UUFFWixZQUFZLEVBQUUsSUFBSTtRQUNsQixVQUFVLEVBQUUsSUFBSTtRQUNoQixVQUFVLEVBQUUsSUFBSTtRQUNoQixhQUFhLEVBQUUsSUFBSTtRQUVuQixRQUFRLEVBQUUsSUFBSTtRQUNkLE9BQU8sRUFBRSxJQUFJO1FBRWIsSUFBSSxFQUFFLElBQUk7UUFDVixLQUFLLEVBQUUsSUFBSTtRQUNYLEdBQUcsRUFBRSxJQUFJO1FBQ1QsSUFBSSxFQUFFLElBQUk7UUFDVixPQUFPLEVBQUUsT0FBTyxDQUFDLE9BQU87S0FDekIsQ0FBQztBQUNKLENBQUM7QUFFRCxTQUFTLE9BQU8sQ0FBQyxPQUFxQjtJQUNwQyxNQUFNLEdBQUcsR0FBVztRQUNsQixJQUFJLEVBQUUsSUFBSTtRQUNWLFFBQVEsRUFBRSxJQUFJO1FBQ2QsWUFBWSxFQUFFLElBQUk7UUFDbEIsT0FBTyxFQUFFLElBQUk7UUFDYixNQUFNLEVBQUUsSUFBSTtRQUVaLE1BQU0sRUFBRSxJQUFJO1FBRVosWUFBWSxFQUFFLElBQUk7UUFDbEIsVUFBVSxFQUFFLElBQUk7UUFDaEIsVUFBVSxFQUFFLElBQUk7UUFDaEIsYUFBYSxFQUFFLElBQUk7UUFFbkIsUUFBUSxFQUFFLElBQUk7UUFDZCxPQUFPLEVBQUUsSUFBSTtRQUViLElBQUksRUFBRSxJQUFJO1FBQ1YsS0FBSyxFQUFFLElBQUk7UUFDWCxHQUFHLEVBQUUsSUFBSTtRQUNULElBQUksRUFBRSxJQUFJO1FBQ1YsT0FBTyxFQUFFLElBQUk7S0FDZCxDQUFDO0lBRUYsR0FBRyxDQUFDLElBQUksR0FBRyxNQUFNLENBQUMsT0FBTyxDQUFDLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxLQUFLLENBQUMsSUFBSSxJQUFJLENBQUM7SUFDakUsR0FBRyxDQUFDLFFBQVEsR0FBRyxNQUFNLENBQUMsT0FBTyxDQUFDLFFBQVEsRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxJQUFJLENBQUMsSUFBSSxJQUFJLENBQUM7SUFDekUsR0FBRyxDQUFDLFlBQVksR0FBRyxPQUFPLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQyxjQUFjLENBQUMsT0FBTyxDQUFDLFlBQVksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDO0lBQzVGLEdBQUcsQ0FBQyxPQUFPLEdBQUcsT0FBTyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsV0FBVyxFQUF3QixDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUM7SUFDakcsR0FBRyxDQUFDLE1BQU0sR0FBRyxNQUFNLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLE1BQU0sRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxJQUFJLENBQUMsQ0FBQyxXQUFXLEVBQUUsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDO0lBRTdHLEdBQUcsQ0FBQyxNQUFNLEdBQUcsaUJBQWlCLENBQUMsaUJBQWlCLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxNQUFNLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUMsQ0FBQyxJQUFJLElBQUksQ0FBQztJQUUxRyxHQUFHLENBQUMsWUFBWSxHQUFHLE9BQU8sQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLGFBQWEsQ0FBQyxPQUFPLENBQUMsWUFBWSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUM7SUFDM0YsR0FBRyxDQUFDLFVBQVUsR0FBRyxpQkFBaUIsQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLFVBQVUsRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQyxJQUFJLElBQUksQ0FBQztJQUNoRyxHQUFHLENBQUMsVUFBVSxHQUFHLE9BQU8sQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLFlBQVksQ0FBQyxPQUFPLENBQUMsVUFBVSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUM7SUFDcEYsR0FBRyxDQUFDLGFBQWEsR0FBRyxPQUFPLENBQUMsYUFBYSxDQUFDLENBQUMsQ0FBQyxhQUFhLENBQUMsT0FBTyxDQUFDLGFBQWEsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDO0lBRTlGLEdBQUcsQ0FBQyxRQUFRLEdBQUcsT0FBTyxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsVUFBVSxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQztJQUM1RSxHQUFHLENBQUMsT0FBTyxHQUFHLGdCQUFnQixDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsSUFBSSxJQUFJLENBQUM7SUFFeEQsR0FBRyxDQUFDLElBQUksR0FBRyxNQUFNLENBQUMsT0FBTyxDQUFDLElBQUksRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxLQUFLLENBQUMsSUFBSSxJQUFJLENBQUM7SUFDbkUsR0FBRyxDQUFDLEtBQUssR0FBRyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDO0lBQ2hFLEdBQUcsQ0FBQyxHQUFHLEdBQUcsT0FBTyxDQUFDLEdBQUcsRUFBRSxLQUFLLElBQUksSUFBSSxDQUFDO0lBQ3JDLEdBQUcsQ0FBQyxJQUFJLEdBQUcsT0FBTyxDQUFDLElBQUksRUFBRSxLQUFLLElBQUksSUFBSSxDQUFDO0lBRXZDLEdBQUcsQ0FBQyxPQUFPLEdBQUcsT0FBTyxDQUFDLE9BQU8sQ0FBQyxDQUFDLG1GQUFtRjtJQUVsSCxJQUFJLEdBQUcsQ0FBQyxZQUFZLEtBQUssWUFBWSxDQUFDLEVBQUUsSUFBSSxHQUFHLENBQUMsUUFBUSxLQUFLLFFBQVEsQ0FBQyxHQUFHLEVBQUUsQ0FBQztRQUMxRSxHQUFHLENBQUMsT0FBTyxHQUFHLEdBQUcsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLElBQUksRUFBRSxFQUFFLENBQUMsQ0FBQyxXQUFXLEVBQUUsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDO0lBQ2pGLENBQUM7SUFFRCxPQUFPLEdBQUcsQ0FBQztBQUNiLENBQUM7QUFFRCxTQUFTLFVBQVUsQ0FBQyxPQUFxQixFQUFFLFdBQVcsR0FBRyxLQUFLO0lBQzVELE1BQU0sR0FBRyxHQUFHLEVBQUUsQ0FBQztJQUNmLE9BQU8sT0FBTyxJQUFJLGNBQWMsQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDO1FBQzFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7UUFDbEIsT0FBTyxHQUFHLE9BQU8sQ0FBQyxJQUFJLENBQUM7UUFDdkIsSUFBSSxXQUFXLElBQUksT0FBTyxFQUFFLElBQUksSUFBSSxDQUFDLGdCQUFnQixDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDO1lBQUMsTUFBTTtRQUFDLENBQUM7UUFDL0UsSUFBSSxPQUFPLEVBQUUsSUFBSSxJQUFJLFlBQVksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQztZQUFDLE1BQU07UUFBQyxDQUFDO0lBQzdELENBQUM7SUFDRCxPQUFPLENBQUUsR0FBRyxFQUFFLE9BQU8sQ0FBRSxDQUFDO0FBQzFCLENBQUM7QUFFRCxTQUFTLFdBQVcsQ0FBQyxPQUFxQjtJQUN4QyxNQUFNLEdBQUcsR0FBRyxFQUFFLENBQUM7SUFDZixPQUFPLE9BQU8sRUFBRSxDQUFDO1FBQ2YsR0FBRyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUNsQixPQUFPLEdBQUcsT0FBTyxDQUFDLElBQUksQ0FBQztRQUN2QixJQUFJLE9BQU8sRUFBRSxJQUFJLElBQUksWUFBWSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDO1lBQUMsTUFBTTtRQUFDLENBQUM7SUFDN0QsQ0FBQztJQUNELE9BQU8sQ0FBRSxHQUFHLEVBQUUsT0FBTyxDQUFFLENBQUM7QUFDMUIsQ0FBQztBQUVELFNBQVMsaUJBQWlCLENBQUMsT0FBcUI7SUFDOUMsSUFBSSxVQUFVLEdBQUcsS0FBSyxDQUFDO0lBQ3ZCLElBQUksU0FBUyxHQUFHLEtBQUssQ0FBQztJQUN0QixPQUFPLE9BQU8sRUFBRSxDQUFDO1FBQ2YsSUFBSSxZQUFZLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxJQUFJLFVBQVUsQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQztZQUFDLFVBQVUsR0FBRyxJQUFJLENBQUM7UUFBQyxDQUFDO1FBQ3BGLElBQUksY0FBYyxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDO1lBQUMsU0FBUyxHQUFHLElBQUksQ0FBQztRQUFDLENBQUM7UUFDeEQsSUFBSSxVQUFVLElBQUksU0FBUyxFQUFFLENBQUM7WUFBQyxPQUFPLEtBQUssQ0FBQztRQUFDLENBQUM7UUFFOUMsSUFBSSxPQUFPLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxJQUFJLE9BQU8sQ0FBQyxJQUFJLElBQUksT0FBTyxDQUFDLElBQUksQ0FBQyxNQUFNLEtBQUssQ0FBQyxJQUFJLE9BQU8sQ0FBQyxJQUFJLENBQUMsUUFBUSxLQUFLLENBQUMsRUFBRSxDQUFDO1lBQ3ZHLE9BQU8sSUFBSSxDQUFDO1FBQ2QsQ0FBQztRQUVELElBQUksWUFBWSxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUM7WUFBQyxPQUFPLEtBQUssQ0FBQztRQUFDLENBQUM7UUFDNUMsT0FBTyxHQUFHLE9BQU8sQ0FBQyxJQUFJLENBQUM7SUFDekIsQ0FBQztJQUNELE9BQU8sSUFBSSxDQUFDO0FBQ2QsQ0FBQztBQUVELFNBQVMsV0FBVyxDQUFDLE9BQXFCO0lBQ3hDLElBQUksQ0FBQyxPQUFPLEVBQUUsQ0FBQztRQUFDLE9BQU8sS0FBSyxDQUFDO0lBQUMsQ0FBQztJQUMvQixJQUFJLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDO1FBQUMsT0FBTyxLQUFLLENBQUM7SUFBQyxDQUFDO0lBQzlDLE9BQU8sR0FBRyxPQUFPLENBQUMsSUFBSSxDQUFDO0lBQ3ZCLE9BQU8sT0FBTyxFQUFFLENBQUM7UUFDZixJQUFJLE9BQU8sQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQztZQUFDLE9BQU8sS0FBSyxDQUFDO1FBQUMsQ0FBQztRQUM3QyxPQUFPLEdBQUcsT0FBTyxDQUFDLElBQUksQ0FBQztJQUN6QixDQUFDO0lBQ0QsT0FBTyxJQUFJLENBQUM7QUFDZCxDQUFDO0FBRUQsU0FBUyxTQUFTLENBQUMsT0FBcUI7SUFDdEMsT0FBTyxPQUFPLEVBQUUsQ0FBQztRQUNmLElBQUksQ0FBQyxjQUFjLENBQUMsT0FBTyxDQUFDLElBQUksU0FBUyxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsSUFBSSxhQUFhLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxJQUFJLFlBQVksQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLElBQUksVUFBVSxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDO1lBQUMsT0FBTyxLQUFLLENBQUM7UUFBQyxDQUFDO1FBQ3ZLLElBQUksWUFBWSxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUM7WUFBQyxNQUFNO1FBQUMsQ0FBQztRQUNyQyxPQUFPLEdBQUcsT0FBTyxDQUFDLElBQUksQ0FBQztJQUN6QixDQUFDO0lBQ0QsT0FBTyxJQUFJLENBQUM7QUFDZCxDQUFDO0FBRUQsU0FBUyxnQkFBZ0IsQ0FBQyxJQUFVLEVBQUUsR0FBaUI7SUFDckQsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQztRQUFDLE9BQU8sS0FBSyxDQUFDO0lBQUMsQ0FBQztJQUNqQyxJQUFJLE9BQU8sR0FBaUIsSUFBSSxDQUFDLElBQUksQ0FBQztJQUN0QyxPQUFPLE9BQU8sQ0FBQyxJQUFJLEVBQUUsQ0FBQztRQUNwQixPQUFPLEdBQUcsT0FBTyxDQUFDLElBQUksQ0FBQztJQUN6QixDQUFDO0lBRUQsSUFBSSxXQUFXLEdBQUcsRUFBRSxDQUFDO0lBQ3JCLE9BQU8sT0FBTyxLQUFLLElBQUksRUFBRSxDQUFDO1FBQ3hCLElBQUksTUFBTSxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUM7WUFBQyxNQUFNO1FBQUMsQ0FBQyxDQUFDLHdCQUF3QjtRQUN4RCxJQUFJLFlBQVksQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDO1lBQUMsTUFBTTtRQUFDLENBQUM7UUFDckMsV0FBVyxHQUFHLENBQUUsT0FBTyxDQUFDLEtBQUssRUFBRSxXQUFXLENBQUUsQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBRXZFLDZGQUE2RjtRQUM3RixJQUFJLE9BQU8sQ0FBQyxXQUFXLENBQUMsSUFBSSxZQUFZLENBQUMsV0FBVyxDQUFDLElBQUksVUFBVSxDQUFDLFdBQVcsQ0FBQyxFQUFFLENBQUM7WUFBQyxTQUFTO1FBQUMsQ0FBQztRQUUvRixNQUFNLE9BQU8sR0FBRyxTQUFTLENBQUMsV0FBVyxDQUFDLENBQUM7UUFDdkMsSUFBSSxDQUFDLE9BQU8sRUFBRSxDQUFDO1lBQUMsT0FBTyxHQUFHLE9BQU8sQ0FBQyxJQUFJLENBQUM7WUFBQyxTQUFTO1FBQUMsQ0FBQztRQUVuRCxNQUFNLElBQUksR0FBRyxjQUFjLENBQUMsT0FBTyxDQUFDLENBQUM7UUFDckMsSUFBSSxDQUFDLElBQUksRUFBRSxDQUFDO1lBQUMsT0FBTyxHQUFHLE9BQU8sQ0FBQyxJQUFJLENBQUM7WUFBQyxTQUFTO1FBQUMsQ0FBQztRQUVoRCxJQUFJLE9BQU8sS0FBSyxPQUFPLENBQUMsR0FBRyxJQUFJLElBQUksQ0FBQyxXQUFXLEtBQUssT0FBTyxDQUFDLEdBQUcsRUFBRSxDQUFDO1lBQ2hFLEdBQUcsQ0FBQyxPQUFPLEdBQUcsT0FBTyxDQUFDLEdBQUcsQ0FBQztZQUMxQixPQUFPLENBQUMsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUM7WUFDekIsT0FBTyxLQUFLLENBQUM7UUFDZixDQUFDO1FBRUQsNkRBQTZEO1FBQzdELElBQUksT0FBTyxLQUFLLE9BQU8sQ0FBQyxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLEtBQUssSUFBSyxPQUFPLENBQUMsSUFBYyxFQUFFLEtBQUssRUFBRSxXQUFXLEVBQUUsS0FBSyxLQUFLLEVBQUUsQ0FBQztZQUM5RyxPQUFPLEtBQUssQ0FBQztRQUNmLENBQUM7UUFFRCxPQUFPLENBQUMsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUM7UUFDekIsR0FBRyxDQUFDLElBQUksR0FBRyxPQUFPLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQzlCLEdBQUcsQ0FBQyxPQUFPLEdBQUcsT0FBTyxDQUFDO1FBQ3RCLE9BQU8sSUFBSSxDQUFDO0lBQ2QsQ0FBQztJQUVELE9BQU8sS0FBSyxDQUFDO0FBQ2YsQ0FBQztBQUVELHdEQUF3RDtBQUN4RCxrREFBa0Q7QUFDbEQsTUFBTSxZQUFZLEdBQUcsSUFBSSxHQUFHLENBQUMsQ0FBRSxZQUFZLEVBQUUsU0FBUyxFQUFFLFVBQVUsRUFBRSxLQUFLLENBQUUsQ0FBQyxDQUFDO0FBQzdFLE1BQU0sYUFBYSxHQUFHLElBQUksR0FBRyxDQUFDLENBQUMsa0JBQWtCLENBQUMsQ0FBQyxDQUFDLENBQUMsMkJBQTJCO0FBQ2hGLFNBQVMsYUFBYSxDQUFDLElBQVUsRUFBRSxHQUFpQjtJQUNsRCxJQUFJLFNBQVMsR0FBaUIsSUFBSSxDQUFDLElBQUksQ0FBQztJQUN4QyxJQUFJLE9BQU8sR0FBaUIsSUFBSSxDQUFDLElBQUksQ0FBQztJQUN0QyxJQUFJLEdBQUcsR0FBWSxFQUFFLENBQUM7SUFDdEIsSUFBSSxVQUFVLEdBQUcsS0FBSyxDQUFDO0lBQ3ZCLElBQUksZUFBZSxHQUFHLEtBQUssQ0FBQztJQUM1QixJQUFJLGlCQUFpQixHQUFHLEtBQUssQ0FBQztJQUM5QixJQUFJLGtCQUFrQixHQUFHLEtBQUssQ0FBQztJQUMvQixJQUFJLGFBQWEsR0FBRyxLQUFLLENBQUM7SUFFMUIsT0FBTyxPQUFPLEVBQUUsQ0FBQztRQUNmLGtHQUFrRztRQUNsRyxJQUFJLENBQUMsVUFBVSxJQUFJLENBQUMsT0FBTyxDQUFDLE1BQU0sSUFBSSxPQUFPLENBQUMsUUFBUSxFQUFFLENBQUM7WUFDdkQsT0FBTztRQUNULENBQUM7UUFFRCwrRkFBK0Y7YUFDMUYsSUFBSSxPQUFPLENBQUMsU0FBUyxLQUFLLEdBQUcsSUFBSSxPQUFPLENBQUMsSUFBSSxDQUFDLFNBQVMsS0FBSyxHQUFHLEVBQUUsQ0FBQztZQUFDLENBQUMsQ0FBQztRQUFDLENBQUM7YUFDdkUsSUFBSSxjQUFjLENBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQztZQUNqQyxhQUFhLEdBQUcsSUFBSSxDQUFDO1FBQ3ZCLENBQUM7YUFDSSxJQUFJLFlBQVksQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLFNBQVMsRUFBRSxDQUFDO1lBQ2hFLGVBQWUsR0FBRyxJQUFJLENBQUM7UUFDekIsQ0FBQzthQUNJLElBQUksY0FBYyxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsU0FBUyxFQUFFLENBQUM7WUFDbEUsaUJBQWlCLEdBQUcsSUFBSSxDQUFDO1FBQzNCLENBQUM7YUFDSSxJQUFJLFlBQVksQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxXQUFXLEVBQUUsQ0FBQyxFQUFFLENBQUM7WUFDdkQsa0JBQWtCLEdBQUcsSUFBSSxDQUFDO1FBQzVCLENBQUM7UUFFRCxVQUFVLEdBQUcsSUFBSSxDQUFDO1FBQ2xCLEdBQUcsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7UUFFbEIsSUFBSSxhQUFhLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFDLEVBQUUsQ0FBQztZQUNyRSxrQkFBa0IsR0FBRyxJQUFJLENBQUM7WUFDMUIsT0FBTyxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUM7UUFDdkIsQ0FBQztRQUVELGlEQUFpRDtRQUNqRCxJQUFJLFlBQVksQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDO1lBQzFCLG1EQUFtRDtZQUNuRCxJQUFJLENBQUMsQ0FBQyxDQUFDLGVBQWUsSUFBSSxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsZUFBZSxJQUFJLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxrQkFBa0IsSUFBSSxDQUFDLGVBQWUsQ0FBQyxDQUFDLElBQUksQ0FBQyxpQkFBaUIsRUFBRSxDQUFDO2dCQUFDLE1BQU07WUFBQyxDQUFDO1lBQy9KLFNBQVMsR0FBRyxPQUFPLENBQUMsSUFBSSxDQUFDO1lBQ3pCLGlCQUFpQixHQUFHLEtBQUssQ0FBQztZQUMxQixlQUFlLEdBQUcsS0FBSyxDQUFDO1lBQ3hCLGtCQUFrQixHQUFHLEtBQUssQ0FBQztZQUMzQixHQUFHLEdBQUcsRUFBRSxDQUFDO1FBQ1gsQ0FBQztRQUVELE9BQU8sR0FBRyxPQUFPLENBQUMsSUFBSSxDQUFDO0lBQ3pCLENBQUM7SUFFRCxvR0FBb0c7SUFDcEcsSUFBSSxTQUFTLElBQUksQ0FBQyxDQUFDLENBQUMsZUFBZSxJQUFJLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxlQUFlLElBQUksQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLGtCQUFrQixJQUFJLENBQUMsZUFBZSxDQUFDLENBQUMsSUFBSSxDQUFDLGlCQUFpQixFQUFFLENBQUM7UUFDakssU0FBUyxDQUFDLElBQUksQ0FBQyxJQUFJLEdBQUcsT0FBTyxFQUFFLElBQUksSUFBSSxJQUFJLENBQUM7UUFDNUMsU0FBUyxDQUFDLElBQUksQ0FBQyxLQUFLLEdBQUcsT0FBTyxFQUFFLEtBQUssSUFBSSxLQUFLLENBQUM7UUFDL0MsT0FBTyxFQUFFLElBQUksSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsSUFBSSxHQUFHLFNBQVMsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUN0RCxHQUFHLENBQUMsSUFBSSxHQUFHLEdBQUcsQ0FBQztJQUNqQixDQUFDO0FBQ0gsQ0FBQztBQUVELFNBQVMsVUFBVSxDQUFDLElBQVUsRUFBRSxHQUFpQjtJQUMvQywrREFBK0Q7SUFDL0QsSUFBSSxPQUFPLEdBQWlCLElBQUksQ0FBQyxJQUFJLENBQUM7SUFDdEMsT0FBTyxPQUFPLEVBQUUsQ0FBQztRQUNmLDhDQUE4QztRQUM5QyxJQUFJLE9BQU8sSUFBSSxvQkFBb0IsQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLFdBQVcsRUFBRSxDQUFDLEVBQUUsQ0FBQztZQUNqRSxNQUFNLEdBQUcsR0FBRyxPQUFPLENBQUM7WUFDcEIsT0FBTyxHQUFHLE9BQU8sQ0FBQyxJQUFJLENBQUM7WUFDdkIsTUFBTSxDQUFFLEdBQUcsRUFBRSxJQUFJLENBQUUsR0FBRyxXQUFXLENBQUMsT0FBTyxDQUFDLENBQUM7WUFDM0MsSUFBSSxHQUFHLENBQUMsTUFBTSxLQUFLLENBQUMsRUFBRSxDQUFDO2dCQUFDLFNBQVM7WUFBQyxDQUFDO1lBRW5DLHNGQUFzRjtZQUN0RixvRUFBb0U7WUFDcEUsSUFBSSxHQUFHLENBQUMsS0FBSyxDQUFDLFdBQVcsRUFBRSxLQUFLLElBQUksSUFBSSxpQkFBaUIsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDO2dCQUMvRCxTQUFTO1lBQ1gsQ0FBQztZQUVELEdBQUcsQ0FBQyxPQUFPLEdBQUcsR0FBRyxDQUFDO1lBQ2xCLEdBQUcsQ0FBQyxNQUFNLEdBQUcsR0FBRyxDQUFDO1lBQ2pCLE9BQU8sR0FBRyxJQUFJLENBQUM7WUFFZiwwREFBMEQ7WUFDMUQsR0FBRyxDQUFDLElBQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDO1lBQ3JCLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsRUFBRSxDQUFDO2dCQUM3QyxHQUFHLENBQUMsSUFBSSxDQUFDLFNBQVMsR0FBRyxJQUFJLEVBQUUsSUFBSSxFQUFFLFNBQVMsSUFBSSxJQUFJLENBQUM7Z0JBQ25ELEdBQUcsQ0FBQyxJQUFJLENBQUMsS0FBSyxHQUFHLElBQUksRUFBRSxJQUFJLEVBQUUsS0FBSyxJQUFJLEtBQUssQ0FBQztZQUM5QyxDQUFDO1lBRUQsSUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksR0FBRyxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDL0IsU0FBUztRQUNYLENBQUM7UUFDRCxPQUFPLEdBQUcsT0FBTyxDQUFDLElBQUksQ0FBQztJQUN6QixDQUFDO0FBQ0gsQ0FBQztBQUVELFNBQVMsZUFBZSxDQUFDLE9BQXFCLEVBQUUsR0FBaUI7SUFDL0QsSUFBSSxRQUFRLEdBQVksRUFBRSxDQUFDO0lBQzNCLElBQUksWUFBWSxHQUFpQixJQUFJLENBQUM7SUFDdEMsSUFBSSxNQUFNLEdBQVksRUFBRSxDQUFDO0lBQ3pCLElBQUksTUFBTSxHQUFZLEVBQUUsQ0FBQztJQUN6QixJQUFJLFFBQVEsR0FBaUIsSUFBSSxDQUFDO0lBQ2xDLElBQUksT0FBTyxHQUFZLEVBQUUsQ0FBQztJQUMxQixZQUFZLEVBQUUsT0FBTyxPQUFPLEVBQUUsQ0FBQztRQUM3Qiw4REFBOEQ7UUFDOUQsSUFBSSxDQUFDLFlBQVksSUFBSSxjQUFjLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUM7WUFDbkQsWUFBWSxHQUFHLE9BQU8sQ0FBQztZQUN2QixPQUFPLEdBQUcsT0FBTyxDQUFDLElBQUksQ0FBQztRQUN6QixDQUFDO1FBRUQseUZBQXlGO2FBQ3BGLElBQUksVUFBVSxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDO1lBQ25DLE1BQU0sWUFBWSxHQUFpQixRQUFRLENBQUM7WUFDNUMsUUFBUSxHQUFHLE9BQU8sQ0FBQztZQUNuQixPQUFPLEdBQUcsT0FBTyxDQUFDLElBQUksQ0FBQztZQUV2Qix3REFBd0Q7WUFDeEQsTUFBTSxDQUFFLEdBQUcsRUFBRSxJQUFJLENBQUUsR0FBRyxVQUFVLENBQUMsT0FBTyxDQUFDLENBQUM7WUFFMUMsdUZBQXVGO1lBQ3ZGLElBQUksQ0FBQyxHQUFHLENBQUMsTUFBTSxFQUFFLENBQUM7Z0JBQ2hCLFFBQVEsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7Z0JBQ3hCLFFBQVEsR0FBRyxZQUFZLENBQUM7WUFDMUIsQ0FBQztpQkFDSSxDQUFDO2dCQUNKLE9BQU8sR0FBRyxHQUFHLENBQUM7Z0JBQ2QsT0FBTyxHQUFHLElBQUksQ0FBQztZQUNqQixDQUFDO1FBQ0gsQ0FBQztRQUVELDJFQUEyRTthQUN0RSxJQUFJLGNBQWMsQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDO1lBQ2pDLDRIQUE0SDtZQUM1SCxNQUFNLFlBQVksR0FBRyxDQUFDLENBQUMsQ0FBQyxZQUFZLElBQUksQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUM7WUFFeEQsMkJBQTJCO1lBQzNCLE1BQU0sQ0FBRSxHQUFHLEVBQUUsSUFBSSxDQUFFLEdBQUcsVUFBVSxDQUFDLE9BQU8sRUFBRSxZQUFZLENBQUMsQ0FBQztZQUV4RCxrRUFBa0U7WUFDbEUsSUFBSSxNQUFNLEdBQUcsS0FBSyxDQUFDO1lBQ25CLEtBQUssTUFBTSxFQUFFLElBQUksR0FBRyxFQUFFLENBQUM7Z0JBQ3JCLElBQUksRUFBRSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQztvQkFDekIsTUFBTSxHQUFHLElBQUksQ0FBQztvQkFDZCxNQUFNO2dCQUNSLENBQUM7WUFDSCxDQUFDO1lBRUQsSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDO2dCQUNaLFFBQVEsR0FBRyxDQUFFLEdBQUcsUUFBUSxFQUFFLEdBQUcsR0FBRyxDQUFFLENBQUM7WUFDckMsQ0FBQztpQkFDSSxJQUFJLFlBQVksRUFBRSxDQUFDO2dCQUN0QixNQUFNLEdBQUcsR0FBRyxDQUFDO1lBQ2YsQ0FBQztpQkFDSSxDQUFDO2dCQUNKLE1BQU0sR0FBRyxHQUFHLENBQUM7WUFDZixDQUFDO1lBQ0QsT0FBTyxHQUFHLElBQUksQ0FBQztRQUNqQixDQUFDO1FBRUQsc0VBQXNFO1FBQ3RFLGlGQUFpRjtRQUNqRiw0REFBNEQ7YUFDdkQsQ0FBQztZQUNKLFFBQVEsR0FBRyxDQUFFLEdBQUcsUUFBUSxFQUFFLEdBQUcsTUFBTSxFQUFFLEdBQUcsTUFBTSxFQUFFLE9BQU8sQ0FBRSxDQUFDO1lBQzFELE1BQU0sR0FBRyxFQUFFLENBQUM7WUFDWixNQUFNLEdBQUcsRUFBRSxDQUFDO1lBQ1osT0FBTyxHQUFHLE9BQU8sQ0FBQyxJQUFJLENBQUM7UUFDekIsQ0FBQztRQUVELHNHQUFzRztRQUN0RyxJQUFJLE9BQU8sSUFBSSxZQUFZLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUM7WUFBQyxNQUFNLFlBQVksQ0FBQztRQUFDLENBQUM7SUFDcEUsQ0FBQztJQUVELElBQUksR0FBRyxDQUFDLE1BQU0sQ0FBQyxNQUFNLElBQUksTUFBTSxDQUFDLE1BQU0sSUFBSSxDQUFDLEdBQUcsQ0FBQyxPQUFPLEVBQUUsQ0FBQztRQUN2RCxHQUFHLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxHQUFHLEdBQUcsQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUNuQyxDQUFDO0lBQ0QsSUFBSSxHQUFHLENBQUMsWUFBWSxJQUFJLFlBQVksRUFBRSxDQUFDO1FBQ3JDLEdBQUcsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxZQUFZLENBQUMsQ0FBQztJQUN0QyxDQUFDO0lBRUQsSUFBSSxHQUFHLENBQUMsTUFBTSxDQUFDLE1BQU0sSUFBSSxNQUFNLENBQUMsTUFBTSxJQUFJLENBQUMsR0FBRyxDQUFDLE9BQU8sRUFBRSxDQUFDO1FBQ3ZELEdBQUcsQ0FBQyxNQUFNLEdBQUcsR0FBRyxDQUFDLE1BQU0sQ0FBQztJQUMxQixDQUFDO0lBRUQscUZBQXFGO0lBQ3JGLElBQUksQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLE1BQU0sSUFBSSxDQUFDLEdBQUcsQ0FBQyxZQUFZLElBQUksUUFBUSxDQUFDLE1BQU0sRUFBRSxDQUFDO1FBQzdELEdBQUcsQ0FBQyxJQUFJLEdBQUcsQ0FBRSxHQUFHLEdBQUcsQ0FBQyxRQUFRLEVBQUUsR0FBRyxDQUFDLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUUsQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFZLENBQUM7UUFDL0YsR0FBRyxDQUFDLFFBQVEsR0FBRyxFQUFFLENBQUM7UUFDbEIsR0FBRyxDQUFDLE1BQU0sR0FBRyxHQUFHLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUM7SUFDN0MsQ0FBQztJQUVELDBGQUEwRjtJQUMxRixJQUFJLFFBQVEsQ0FBQyxNQUFNLEVBQUUsQ0FBQztRQUNwQixNQUFNLElBQUksR0FBRyxHQUFHLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxRQUFRLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDO1FBQ25ELElBQUksSUFBSSxDQUFDLElBQUksQ0FBQyxTQUFTLEdBQUcsR0FBRyxDQUFDLENBQUM7SUFDakMsQ0FBQztJQUVELEdBQUcsQ0FBQyxRQUFRLEdBQUcsQ0FBRSxHQUFHLEdBQUcsQ0FBQyxRQUFRLEVBQUUsR0FBRyxRQUFRLENBQUUsQ0FBQztJQUNoRCxHQUFHLENBQUMsWUFBWSxHQUFHLFlBQVksSUFBSSxHQUFHLENBQUMsWUFBWSxDQUFDO0lBQ3BELEdBQUcsQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDO0lBQ2pELEdBQUcsQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDO0lBRWpELEdBQUcsQ0FBQyxRQUFRLEdBQUcsUUFBUSxJQUFJLEdBQUcsQ0FBQyxRQUFRLENBQUM7SUFDeEMsR0FBRyxDQUFDLE9BQU8sR0FBRyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUM7SUFFckQsd0hBQXdIO0lBQ3hILElBQUksQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLE1BQU0sSUFBSSxHQUFHLENBQUMsWUFBWSxJQUFJLEdBQUcsQ0FBQyxNQUFNLENBQUMsTUFBTSxJQUFJLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxNQUFNLEVBQUUsQ0FBQztRQUN0RixHQUFHLENBQUMsUUFBUSxHQUFHLEdBQUcsQ0FBQyxNQUFNLENBQUM7UUFDMUIsR0FBRyxDQUFDLE1BQU0sR0FBRyxFQUFFLENBQUM7SUFDbEIsQ0FBQztJQUVELE9BQU8sT0FBTyxDQUFDO0FBQ2pCLENBQUM7QUFFRCxNQUFNLFVBQVUsS0FBSyxDQUFDLEdBQUcsS0FBZTtJQUN0QyxNQUFNLE9BQU8sR0FBRyxLQUFLLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUNqRCxNQUFNLElBQUksR0FBRyxRQUFRLENBQUMsT0FBTyxDQUFDLENBQUM7SUFFL0IsTUFBTSxHQUFHLEdBQWlCO1FBQ3hCLElBQUksRUFBRSxFQUFFO1FBQ1IsUUFBUSxFQUFFLEVBQUU7UUFDWixZQUFZLEVBQUUsSUFBSTtRQUNsQixNQUFNLEVBQUUsRUFBRTtRQUVWLFlBQVksRUFBRSxJQUFJO1FBQ2xCLFVBQVUsRUFBRSxFQUFFO1FBQ2QsVUFBVSxFQUFFLElBQUk7UUFDaEIsYUFBYSxFQUFFLElBQUk7UUFFbkIsT0FBTyxFQUFFLElBQUk7UUFDYixNQUFNLEVBQUUsRUFBRTtRQUNWLFFBQVEsRUFBRSxJQUFJO1FBQ2QsT0FBTyxFQUFFLEVBQUU7UUFFWCxJQUFJLEVBQUUsRUFBRTtRQUNSLEtBQUssRUFBRSxJQUFJO1FBQ1gsR0FBRyxFQUFFLElBQUk7UUFDVCxJQUFJLEVBQUUsSUFBSTtRQUNWLE9BQU8sRUFBRSxPQUFPLENBQUMsR0FBRztLQUNyQixDQUFDO0lBRUYsdUVBQXVFO0lBQ3ZFLElBQUksZ0JBQWdCLENBQUMsSUFBSSxFQUFFLEdBQUcsQ0FBQyxFQUFFLENBQUM7UUFDaEMsT0FBTyxjQUFjLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDN0IsQ0FBQztJQUVELG1EQUFtRDtJQUNuRCxtREFBbUQ7SUFDbkQsVUFBVSxDQUFDLElBQUksRUFBRSxHQUFHLENBQUMsQ0FBQztJQUV0Qiw0REFBNEQ7SUFDNUQsYUFBYSxDQUFDLElBQUksRUFBRSxHQUFHLENBQUMsQ0FBQztJQUV6QixJQUFJLE9BQU8sR0FBaUIsSUFBSSxDQUFDLElBQUksQ0FBQztJQUV0QyxxRkFBcUY7SUFDckYsNkVBQTZFO0lBQzdFLElBQUksT0FBTyxJQUFJLFVBQVUsQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxjQUFjLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUM7UUFDM0UsR0FBRyxDQUFDLFFBQVEsR0FBRyxPQUFPLENBQUM7UUFDdkIsT0FBTyxHQUFHLE9BQU8sQ0FBQyxJQUFJLENBQUM7UUFDdkIsTUFBTSxDQUFFLEdBQUcsRUFBRSxJQUFJLENBQUUsR0FBRyxVQUFVLENBQUMsT0FBTyxFQUFFLElBQUksQ0FBQyxDQUFDO1FBQ2hELEdBQUcsQ0FBQyxPQUFPLEdBQUcsR0FBRyxDQUFDO1FBQ2xCLE9BQU8sR0FBRyxJQUFJLENBQUM7SUFDakIsQ0FBQztJQUVELDhGQUE4RjtJQUM5Riw2RkFBNkY7SUFDN0YsSUFDRSxPQUFPO1FBQ1AsQ0FBQyxDQUFDLGlCQUFpQixDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQzFFLENBQUMsY0FBYyxDQUFDLE9BQU8sRUFBRSxLQUFLLENBQUM7UUFDL0IsQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxjQUFjLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxPQUFPLElBQUksQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUMzRixDQUFDO1FBQ0QsT0FBTyxHQUFHLGVBQWUsQ0FBQyxPQUFPLEVBQUUsR0FBRyxDQUFDLENBQUM7SUFDMUMsQ0FBQztJQUVELE9BQ0UsQ0FBQyxpQkFBaUIsQ0FBQyxPQUFPLENBQUM7UUFDM0IsZUFBZSxDQUFDLE9BQU8sQ0FBQztRQUN4QixDQUFDLGNBQWMsQ0FBQyxPQUFPLEVBQUUsS0FBSyxDQUFDO1FBQy9CLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsY0FBYyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsT0FBTyxJQUFJLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFDM0YsQ0FBQztRQUNELE9BQU8sR0FBRyxlQUFlLENBQUMsT0FBTyxFQUFFLEdBQUcsQ0FBQyxDQUFDO0lBQzFDLENBQUM7SUFFRCwrR0FBK0c7SUFDL0csSUFBSSxPQUFPLElBQUksVUFBVSxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDO1FBQ3pDLEdBQUcsQ0FBQyxRQUFRLEdBQUcsT0FBTyxDQUFDO1FBQ3ZCLE9BQU8sR0FBRyxPQUFPLENBQUMsSUFBSSxDQUFDO1FBQ3ZCLE1BQU0sQ0FBRSxHQUFHLEVBQUUsSUFBSSxDQUFFLEdBQUcsVUFBVSxDQUFDLE9BQU8sRUFBRSxJQUFJLENBQUMsQ0FBQztRQUNoRCxHQUFHLENBQUMsT0FBTyxHQUFHLEdBQUcsQ0FBQztRQUNsQixPQUFPLEdBQUcsSUFBSSxDQUFDO0lBQ2pCLENBQUM7SUFDRCxJQUFJLFdBQVcsR0FBRyxpQkFBaUIsQ0FBQyxPQUFPLENBQUMsQ0FBQztJQUU3QyxpR0FBaUc7SUFDakcsSUFBSSxXQUFXLElBQUksR0FBRyxDQUFDLE1BQU0sQ0FBQyxNQUFNLEdBQUcsQ0FBQyxJQUFJLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLE1BQU0sS0FBSyxDQUFDLElBQUksR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQyxNQUFNLEtBQUssQ0FBQyxFQUFFLENBQUM7UUFDbkosTUFBTSxLQUFLLEdBQUcsR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLEVBQUUsQ0FBQztRQUMvQixLQUFLLElBQUksR0FBRyxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDcEMsR0FBRyxDQUFDLE1BQU0sR0FBRyxHQUFHLENBQUMsTUFBTSxDQUFDO1FBQ3hCLEdBQUcsQ0FBQyxNQUFNLEdBQUcsRUFBRSxDQUFDO0lBQ2xCLENBQUM7SUFFRCx1QkFBdUI7SUFDdkIsT0FBTyxPQUFPLElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUMvQix3Q0FBd0M7UUFDeEMsSUFBSSxHQUFHLENBQUMsTUFBTSxDQUFDLE1BQU0sSUFBSSxPQUFPLENBQUMsSUFBSSxJQUFJLFlBQVksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQztZQUFDLFdBQVcsR0FBRyxJQUFJLENBQUM7WUFBQyxNQUFNO1FBQUMsQ0FBQztRQUVuRyx1RkFBdUY7UUFDdkYsTUFBTSxHQUFHLEdBQUcsT0FBTyxDQUFDLEtBQUssQ0FBQztRQUMxQixJQUFJLE9BQU8sQ0FBQyxNQUFNLEdBQUcsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLE1BQU0sSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLElBQUksU0FBUyxDQUFDLEdBQUcsQ0FBQyxJQUFJLGFBQWEsQ0FBQyxHQUFHLENBQUMsSUFBSSxVQUFVLENBQUMsR0FBRyxDQUFDLElBQUksWUFBWSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUM7WUFDckosTUFBTTtRQUNSLENBQUM7UUFFRCwrQ0FBK0M7UUFDL0Msa0RBQWtEO1FBQ2xELEdBQUcsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBRXpCLE9BQU8sR0FBRyxPQUFPLENBQUMsSUFBSSxDQUFDO0lBQ3pCLENBQUM7SUFFRCxtQ0FBbUM7SUFDbkMsSUFBSSxPQUFPLElBQUksQ0FBQyxXQUFXLElBQUksYUFBYSxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDO1FBQzVELEdBQUcsQ0FBQyxZQUFZLEdBQUcsT0FBTyxDQUFDO1FBQzNCLE9BQU8sR0FBRyxPQUFPLENBQUMsSUFBSSxDQUFDO0lBQ3pCLENBQUM7SUFFRCxxQ0FBcUM7SUFDckMsSUFBSSxPQUFPLElBQUksQ0FBQyxXQUFXLElBQUksY0FBYyxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDO1FBQzdELEdBQUcsQ0FBQyxVQUFVLEdBQUcsT0FBTyxDQUFDO1FBQ3pCLE9BQU8sR0FBRyxPQUFPLENBQUMsSUFBSSxDQUFDO0lBQ3pCLENBQUM7SUFFRCwrQ0FBK0M7SUFDL0MsOEZBQThGO0lBQzlGLDhCQUE4QjtJQUM5QiwwQ0FBMEM7SUFDMUMsSUFBSTtJQUVKLDhGQUE4RjtJQUM5RixPQUFPLE9BQU8sSUFBSSxDQUFDLFdBQVcsRUFBRSxDQUFDO1FBQy9CLHdDQUF3QztRQUN4QyxJQUFJLEdBQUcsQ0FBQyxVQUFVLENBQUMsTUFBTSxJQUFJLE9BQU8sQ0FBQyxJQUFJLElBQUksWUFBWSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDO1lBQUMsV0FBVyxHQUFHLElBQUksQ0FBQztZQUFDLE1BQU07UUFBQyxDQUFDO1FBRXZHLHlHQUF5RztRQUN6RyxJQUFJLEdBQUcsQ0FBQyxZQUFZLElBQUksQ0FBQyxjQUFjLENBQUMsR0FBRyxDQUFDLFlBQVksQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDO1lBQUMsTUFBTTtRQUFDLENBQUM7UUFFM0UsbUZBQW1GO1FBQ25GLElBQUksT0FBTyxDQUFDLElBQUksSUFBSSxPQUFPLENBQUMsSUFBSSxDQUFDLFNBQVMsS0FBSyxHQUFHLEVBQUUsQ0FBQztZQUFDLE1BQU07UUFBQyxDQUFDO1FBRTlELGtJQUFrSTtRQUNsSSwyR0FBMkc7UUFDM0csSUFBSSxHQUFHLENBQUMsVUFBVSxDQUFDLE1BQU0sSUFBSSxDQUFDLGVBQWUsQ0FBQyxPQUFPLENBQUMsSUFBSSxZQUFZLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxjQUFjLENBQUMsT0FBTyxDQUFDLElBQUksWUFBWSxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFLENBQUM7WUFDNUksTUFBTTtRQUNSLENBQUM7UUFFRCxvREFBb0Q7UUFDcEQsSUFBSSxHQUFHLENBQUMsWUFBWSxJQUFJLENBQUMsR0FBRyxDQUFDLFVBQVUsQ0FBQyxNQUFNLElBQUksWUFBWSxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxPQUFPLEVBQUUsSUFBSSxDQUFDLEVBQUUsQ0FBQztZQUN0SixHQUFHLENBQUMsVUFBVSxHQUFHLENBQUMsR0FBRyxDQUFDLFlBQVksQ0FBQyxDQUFDO1lBQ3BDLEdBQUcsQ0FBQyxZQUFZLEdBQUcsSUFBSSxDQUFDO1lBQ3hCLE1BQU07UUFDUixDQUFDO1FBRUQsMEdBQTBHO1FBQzFHLElBQ0UsR0FBRyxDQUFDLE1BQU0sQ0FBQyxNQUFNLEdBQUcsQ0FBQztZQUNyQixHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxNQUFNLEtBQUssQ0FBQztZQUNwRCxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDLE1BQU0sS0FBSyxDQUFDO1lBQzlDLENBQUMsVUFBVSxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsSUFBSSxZQUFZLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQzFELENBQUM7WUFDRCxNQUFNLEtBQUssR0FBRyxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsRUFBRSxDQUFDO1lBQy9CLEtBQUssSUFBSSxHQUFHLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUNwQyxNQUFNO1FBQ1IsQ0FBQztRQUVELHVFQUF1RTtRQUN2RSxJQUFJLEdBQUcsQ0FBQyxVQUFVLENBQUMsTUFBTSxJQUFJLENBQUMsQ0FBQyxZQUFZLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsa0JBQWtCLENBQUMsT0FBTyxFQUFFLElBQUksQ0FBQyxDQUFDLElBQUksVUFBVSxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsSUFBSSxhQUFhLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUUsQ0FBQztZQUNoSyxNQUFNO1FBQ1IsQ0FBQztRQUVELEdBQUcsQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQzdCLE9BQU8sR0FBRyxPQUFPLENBQUMsSUFBSSxDQUFDO0lBQ3pCLENBQUM7SUFXRCxNQUFNLE9BQU8sR0FBbUI7UUFDOUIsVUFBVSxFQUFFLElBQUk7UUFDaEIsUUFBUSxFQUFFLElBQUk7UUFDZCxhQUFhLEVBQUUsSUFBSTtLQUNwQixDQUFDO0lBRUYsT0FBTyxPQUFPLElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUMvQiwyREFBMkQ7UUFDM0QsSUFBSSxPQUFPLENBQUMsSUFBSSxJQUFJLFlBQVksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQztZQUFDLFdBQVcsR0FBRyxpQkFBaUIsQ0FBQyxPQUFPLENBQUMsQ0FBQztZQUFDLE1BQU07UUFBQyxDQUFDO1FBRXBHLDRDQUE0QztRQUM1QyxJQUFJLFlBQVksQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQztZQUNoQyxJQUFJLE9BQU8sQ0FBQyxVQUFVLEVBQUUsQ0FBQztnQkFDdkIsR0FBRyxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLFVBQVUsQ0FBQyxDQUFDO1lBQzFDLENBQUM7WUFDRCxPQUFPLENBQUMsVUFBVSxHQUFHLE9BQU8sQ0FBQztRQUMvQixDQUFDO1FBRUQsaUZBQWlGO2FBQzVFLElBQUksVUFBVSxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDO1lBQ25DLElBQUksQ0FBQyxHQUFHLENBQUMsUUFBUSxJQUFJLGtCQUFrQixDQUFDLE9BQU8sQ0FBQyxDQUFDLElBQUksT0FBTyxDQUFDLFFBQVEsRUFBRSxDQUFDO2dCQUN0RSxHQUFHLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLENBQUM7WUFDeEMsQ0FBQztZQUNELE9BQU8sQ0FBQyxRQUFRLEdBQUcsT0FBTyxDQUFDO1FBQzdCLENBQUM7UUFFRCxnRkFBZ0Y7YUFDM0UsSUFBSSxhQUFhLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLFFBQVEsRUFBRSxDQUFDO1lBQzNELElBQUksT0FBTyxDQUFDLGFBQWEsSUFBSSxPQUFPLENBQUMsVUFBVSxLQUFLLElBQUksRUFBRSxDQUFDO2dCQUN6RCxHQUFHLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsYUFBYSxDQUFDLENBQUM7WUFDN0MsQ0FBQztZQUNELE9BQU8sQ0FBQyxhQUFhLEdBQUcsT0FBTyxDQUFDO1FBQ2xDLENBQUM7UUFFRCxrRkFBa0Y7YUFDN0UsQ0FBQztZQUNKLE1BQU07UUFDUixDQUFDO1FBRUQscUVBQXFFO1FBQ3JFLE9BQU8sR0FBRyxPQUFPLENBQUMsSUFBSSxDQUFDO0lBQ3pCLENBQUM7SUFDRCw4R0FBOEc7SUFDOUcsR0FBRyxDQUFDLFVBQVUsR0FBRyxPQUFPLENBQUMsVUFBVSxJQUFJLEdBQUcsQ0FBQyxVQUFVLENBQUM7SUFDdEQsR0FBRyxDQUFDLGFBQWEsR0FBRyxPQUFPLENBQUMsYUFBYSxJQUFJLEdBQUcsQ0FBQyxhQUFhLENBQUM7SUFDL0QsR0FBRyxDQUFDLFFBQVEsR0FBRyxHQUFHLENBQUMsUUFBUSxJQUFJLE9BQU8sQ0FBQyxRQUFRLENBQUM7SUFDaEQsT0FBTyxDQUFDLGFBQWEsR0FBRyxJQUFJLENBQUM7SUFDN0IsT0FBTyxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUM7SUFDeEIsT0FBTyxDQUFDLFVBQVUsR0FBRyxJQUFJLENBQUM7SUFFMUIsZ0dBQWdHO0lBQ2hHLCtGQUErRjtJQUMvRiw4RUFBOEU7SUFDOUUsSUFBSSxHQUFHLENBQUMsUUFBUSxJQUFJLENBQUMsR0FBRyxDQUFDLFVBQVUsQ0FBQyxNQUFNLElBQUksZUFBZSxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUM7UUFDdkUsT0FBTyxPQUFPLElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQztZQUMvQixJQUFJLE9BQU8sQ0FBQyxJQUFJLElBQUksWUFBWSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDO2dCQUFDLFdBQVcsR0FBRyxpQkFBaUIsQ0FBQyxPQUFPLENBQUMsQ0FBQztnQkFBQyxNQUFNO1lBQUMsQ0FBQztZQUNwRyxHQUFHLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztZQUM3QixPQUFPLEdBQUcsT0FBTyxFQUFFLElBQUksQ0FBQztRQUMxQixDQUFDO0lBQ0gsQ0FBQztTQUVJLENBQUM7UUFDSiwyRkFBMkY7UUFDM0YsZ0ZBQWdGO1FBQ2hGLElBQUksaUJBQWlCLEdBQUcsS0FBSyxDQUFDO1FBQzlCLE1BQU0sZ0JBQWdCLEdBQUcsQ0FBQyxDQUFDLGVBQWUsQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUNwRCxNQUFNLElBQUksR0FBRyxPQUFPLEVBQUUsSUFBSSxDQUFDO1FBQzNCLE9BQU8sT0FBTyxJQUFJLENBQUMsV0FBVyxFQUFFLENBQUM7WUFDL0IsMkRBQTJEO1lBQzNELElBQUksT0FBTyxDQUFDLElBQUksSUFBSSxPQUFPLENBQUMsSUFBSSxLQUFLLElBQUksSUFBSSxZQUFZLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUM7Z0JBQUMsV0FBVyxHQUFHLGlCQUFpQixDQUFDLE9BQU8sQ0FBQyxDQUFDO2dCQUFDLE1BQU07WUFBQyxDQUFDO1lBRTdILElBQUksY0FBYyxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQztnQkFDaEUsR0FBRyxDQUFDLFlBQVksR0FBRyxPQUFPLENBQUM7Z0JBQzNCLE9BQU8sR0FBRyxPQUFPLENBQUMsSUFBSSxDQUFDO2dCQUN2QixTQUFTO1lBQ1gsQ0FBQztZQUVELG9GQUFvRjtZQUNwRixJQUFJLFVBQVUsQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQztnQkFDOUIsTUFBTSxXQUFXLEdBQWlCLEdBQUcsQ0FBQyxRQUFRLENBQUM7Z0JBQy9DLEdBQUcsQ0FBQyxRQUFRLEdBQUcsT0FBTyxDQUFDO2dCQUN2QixPQUFPLEdBQUcsT0FBTyxDQUFDLElBQUksQ0FBQztnQkFDdkIsd0dBQXdHO2dCQUN4RyxJQUFJLFdBQVcsS0FBSyxHQUFHLENBQUMsUUFBUSxFQUFFLENBQUM7b0JBQ2pDLFNBQVM7b0JBQ1QsaUJBQWlCLEdBQUcsSUFBSSxDQUFDO29CQUN6QixTQUFTO2dCQUNYLENBQUM7Z0JBRUQsR0FBRyxDQUFDLE9BQU8sR0FBRyxFQUFFLENBQUM7Z0JBQ2pCLFNBQVM7WUFDWCxDQUFDO1lBRUQsMkVBQTJFO1lBQzNFLHVFQUF1RTtZQUN2RSxJQUFJLGFBQWEsQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDLGdCQUFnQixJQUFJLFlBQVksQ0FBQyxPQUFPLENBQUMsQ0FBQyxFQUFFLENBQUM7Z0JBQ2pGLE9BQU8sQ0FBQyxLQUFLLEdBQUcsYUFBYSxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQztnQkFDN0MsT0FBTyxDQUFDLE1BQU0sR0FBRyxPQUFPLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQztnQkFDdEMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7Z0JBQzFCLE9BQU8sR0FBRyxPQUFPLENBQUMsSUFBSSxDQUFDO2dCQUN2QixTQUFTO1lBQ1gsQ0FBQztZQUVELGtJQUFrSTtZQUNsSSx1RUFBdUU7WUFDdkUsSUFBSSxDQUFDLGdCQUFnQixJQUFJLENBQUMsY0FBYyxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUM7Z0JBQ2xELE1BQU07WUFDUixDQUFDO1lBRUQsSUFBSSxpQkFBaUIsRUFBRSxDQUFDO2dCQUN0QixHQUFHLENBQUMsT0FBTyxHQUFHLEVBQUUsQ0FBQztnQkFDakIsaUJBQWlCLEdBQUcsS0FBSyxDQUFDO1lBQzVCLENBQUM7WUFFRCxHQUFHLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztZQUUxQixPQUFPLEdBQUcsT0FBTyxDQUFDLElBQUksQ0FBQztRQUN6QixDQUFDO0lBQ0gsQ0FBQztJQUVELDhGQUE4RjtJQUM5RixPQUFPLE9BQU8sRUFBRSxDQUFDO1FBQ2YsSUFBSSxDQUFDLE9BQU8sQ0FBQyxTQUFTLElBQUksQ0FBQyxjQUFjLENBQUMsT0FBTyxDQUFDLElBQUksV0FBVyxDQUFDLE9BQU8sQ0FBQyxDQUFDLEVBQUUsQ0FBQztZQUM1RSxNQUFNO1FBQ1IsQ0FBQztRQUNELEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQ3ZCLE9BQU8sR0FBRyxPQUFPLENBQUMsSUFBSSxDQUFDO0lBQ3pCLENBQUM7SUFFRCw2QkFBNkI7SUFDN0IsSUFBSSxPQUFPLElBQUksT0FBTyxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDO1FBQ3RDLEdBQUcsQ0FBQyxLQUFLLEdBQUcsT0FBTyxDQUFDO1FBQ3BCLE9BQU8sR0FBRyxPQUFPLENBQUMsSUFBSSxDQUFDO0lBQ3pCLENBQUM7SUFFRCwyRUFBMkU7SUFDM0UsSUFBSSxPQUFPLElBQUksT0FBTyxDQUFDLE1BQU0sS0FBSyxDQUFDLEVBQUUsQ0FBQztRQUNwQyxHQUFHLENBQUMsR0FBRyxHQUFHLE9BQU8sQ0FBQztRQUNsQixPQUFPLEdBQUcsT0FBTyxDQUFDLElBQUksQ0FBQztJQUN6QixDQUFDO0lBRUQsMEZBQTBGO0lBQzFGLElBQUksT0FBTyxJQUFJLE9BQU8sQ0FBQyxNQUFNLEtBQUssQ0FBQyxFQUFFLENBQUM7UUFDcEMsR0FBRyxDQUFDLElBQUksR0FBRyxPQUFPLENBQUM7UUFDbkIsT0FBTyxHQUFHLE9BQU8sQ0FBQyxJQUFJLENBQUM7SUFDekIsQ0FBQztJQUVELHFEQUFxRDtJQUVyRCw4SEFBOEg7SUFDOUgsSUFBSSxDQUFDLEdBQUcsQ0FBQyxVQUFVLElBQUksWUFBWSxDQUFDLEdBQUcsQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLEVBQUUsS0FBSyxDQUFDLElBQUksQ0FBQyxjQUFjLENBQUMsR0FBRyxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsRUFBRSxLQUFLLElBQUksRUFBRSxDQUFDLENBQUMsV0FBVyxFQUFFLEtBQUssSUFBSSxDQUFDLEVBQUUsQ0FBQztRQUNoSyxHQUFHLENBQUMsVUFBVSxHQUFHLEdBQUcsQ0FBQyxVQUFVLENBQUMsS0FBSyxFQUFXLENBQUM7SUFDbkQsQ0FBQztJQUVELHVGQUF1RjtJQUN2RixrREFBa0Q7SUFDbEQsSUFBSSxDQUFDLEdBQUcsQ0FBQyxVQUFVLElBQUksR0FBRyxDQUFDLFVBQVUsQ0FBQyxNQUFNLEtBQUssQ0FBQyxJQUFJLFlBQVksQ0FBQyxHQUFHLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUM7UUFDNUYsR0FBRyxDQUFDLFVBQVUsR0FBRyxHQUFHLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ25DLEdBQUcsQ0FBQyxVQUFVLEdBQUcsRUFBRSxDQUFDO0lBQ3RCLENBQUM7SUFFRCwwRUFBMEU7SUFDMUUsdUVBQXVFO0lBQ3ZFLHNFQUFzRTtJQUN0RSxJQUFJLEdBQUcsQ0FBQyxVQUFVLENBQUMsTUFBTSxJQUFJLENBQUMsR0FBRyxDQUFDLFVBQVUsSUFBSSxDQUFDLEdBQUcsQ0FBQyxhQUFhLElBQUksQ0FBQyxHQUFHLENBQUMsUUFBUSxFQUFFLENBQUM7UUFDcEYsSUFBSSxXQUFXLENBQUMsR0FBRyxDQUFDLFVBQVUsQ0FBQyxHQUFHLENBQUMsVUFBVSxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDO1lBQ2pFLEdBQUcsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxVQUFVLENBQUMsR0FBRyxFQUFXLENBQUMsQ0FBQztRQUNsRCxDQUFDO0lBQ0gsQ0FBQztJQUVELHFHQUFxRztJQUNyRyx1REFBdUQ7SUFDdkQsSUFBSSxHQUFHLENBQUMsVUFBVSxJQUFJLEdBQUcsQ0FBQyxVQUFVLENBQUMsTUFBTSxJQUFJLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxNQUFNLElBQUksR0FBRyxDQUFDLE9BQU8sQ0FBQyxNQUFNLEtBQUssQ0FBQyxJQUFJLEdBQUcsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLE1BQU0sS0FBSyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLE1BQU0sRUFBRSxDQUFDO1FBQzNKLElBQUksVUFBVSxHQUFpQixJQUFJLENBQUM7UUFDcEMsTUFBTSxVQUFVLEdBQVksRUFBRSxDQUFDO1FBQy9CLE1BQU0sSUFBSSxHQUFZLEVBQUUsQ0FBQztRQUN6QixLQUFLLE1BQU0sS0FBSyxJQUFJLEdBQUcsQ0FBQyxVQUFVLEVBQUUsQ0FBQztZQUNuQyxJQUFJLFlBQVksQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxVQUFVLEVBQUUsQ0FBQztnQkFDN0MsVUFBVSxHQUFHLEtBQUssQ0FBQztZQUNyQixDQUFDO2lCQUNJLENBQUM7Z0JBQ0osVUFBVSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQ3pELENBQUM7UUFDSCxDQUFDO1FBQ0QsSUFBSSxVQUFVLEVBQUUsQ0FBQztZQUNmLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLFVBQVUsQ0FBQyxDQUFDO1lBQzFCLEdBQUcsQ0FBQyxVQUFVLEdBQUcsVUFBVSxDQUFDO1lBQzVCLEdBQUcsQ0FBQyxVQUFVLEdBQUcsVUFBVSxDQUFDO1lBQzVCLEdBQUcsQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDO1lBQ2hCLEdBQUcsQ0FBQyxHQUFHLEdBQUcsR0FBRyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUN6QixHQUFHLENBQUMsT0FBTyxHQUFHLEVBQUUsQ0FBQztRQUNuQixDQUFDO0lBQ0gsQ0FBQztJQUVELDJGQUEyRjtJQUMzRiwwREFBMEQ7SUFDMUQsSUFBSSxDQUFDLEdBQUcsQ0FBQyxVQUFVLENBQUMsTUFBTSxJQUFJLEdBQUcsQ0FBQyxNQUFNLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRSxDQUFDO1FBQ3BELE1BQU0sT0FBTyxHQUFZLEVBQUUsQ0FBQztRQUM1QixHQUFHLENBQUM7WUFDRixNQUFNLEtBQUssR0FBRyxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsRUFBVyxDQUFDO1lBQ3hDLElBQUksT0FBTyxDQUFDLE1BQU0sSUFBSSxDQUFDLEtBQUssQ0FBQyxTQUFTLEVBQUUsQ0FBQztnQkFDdkMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7Z0JBQ3ZCLE1BQU07WUFDUixDQUFDO1lBQ0QsT0FBTyxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUN6QixDQUFDLFFBQVEsR0FBRyxDQUFDLE1BQU0sQ0FBQyxNQUFNLEVBQUU7UUFDNUIsR0FBRyxDQUFDLFVBQVUsR0FBRyxPQUFPLENBQUM7SUFDM0IsQ0FBQztJQUVELDRGQUE0RjtJQUM1Riw4RkFBOEY7SUFDOUYsMkVBQTJFO0lBQzNFLG1EQUFtRDtJQUNuRCxJQUFJLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxNQUFNLElBQUksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsTUFBTSxLQUFLLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsTUFBTSxHQUFHLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxZQUFZLENBQUMsQ0FBQyxFQUFFLENBQUM7UUFDekgsR0FBRyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxHQUFHLEVBQVcsQ0FBQyxDQUFDO0lBQzlDLENBQUM7SUFFRCxrRkFBa0Y7SUFDbEYsb0RBQW9EO0lBQ3BELElBQUksQ0FBQyxHQUFHLENBQUMsUUFBUSxJQUFJLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxNQUFNLElBQUksR0FBRyxDQUFDLE9BQU8sQ0FBQyxNQUFNLEVBQUUsQ0FBQztRQUM1RCxJQUFJLE9BQU8sR0FBRyxLQUFLLENBQUM7UUFDcEIsS0FBSyxNQUFNLEtBQUssSUFBSSxHQUFHLENBQUMsT0FBTyxFQUFFLENBQUM7WUFDaEMsSUFBSSxNQUFNLEdBQUcsS0FBSyxDQUFDO1lBQ25CLElBQUksU0FBUyxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDO2dCQUFDLE1BQU0sR0FBRyxLQUFLLENBQUM7WUFBQyxDQUFDO2lCQUMxQyxDQUFDO2dCQUFDLE1BQU0sR0FBRyxjQUFjLENBQUMsS0FBSyxDQUFDLENBQUM7WUFBQyxDQUFDO1lBQ3hDLE9BQU8sR0FBRyxPQUFPLElBQUksTUFBTSxDQUFDO1FBQzlCLENBQUM7UUFDRCxJQUFJLENBQUMsT0FBTyxFQUFFLENBQUM7WUFDYixHQUFHLENBQUMsSUFBSSxHQUFHLEdBQUcsQ0FBQyxPQUFPLENBQUM7WUFDdkIsR0FBRyxDQUFDLE9BQU8sR0FBRyxFQUFFLENBQUM7UUFDbkIsQ0FBQztJQUNILENBQUM7SUFFRCxvR0FBb0c7SUFDcEcsc0dBQXNHO0lBQ3RHLElBQUksY0FBYyxDQUFDLEdBQUcsQ0FBQyxZQUFZLEVBQUUsS0FBSyxJQUFJLEVBQUUsQ0FBQyxLQUFLLFlBQVksQ0FBQyxFQUFFLElBQUksVUFBVSxDQUFDLEdBQUcsQ0FBQyxRQUFRLEVBQUUsS0FBSyxJQUFJLEVBQUUsQ0FBQyxLQUFLLFFBQVEsQ0FBQyxHQUFHLElBQUksR0FBRyxDQUFDLE9BQU8sQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFLENBQUM7UUFDMUosTUFBTSxLQUFLLEdBQUcsR0FBRyxDQUFDLE9BQU8sQ0FBQyxLQUFLLEVBQVcsQ0FBQztRQUMzQyxLQUFLLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQztRQUN2QixLQUFLLE1BQU0sS0FBSyxJQUFJLEdBQUcsQ0FBQyxPQUFPLEVBQUUsQ0FBQztZQUNoQyxLQUFLLENBQUMsS0FBSyxJQUFJLEtBQUssQ0FBQyxLQUFLLENBQUM7UUFDN0IsQ0FBQztRQUNELEdBQUcsQ0FBQyxPQUFPLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUN4QixDQUFDO0lBRUQsdUZBQXVGO0lBQ3ZGLDJFQUEyRTtJQUMzRSxJQUFJLENBQUMsR0FBRyxDQUFDLFlBQVksSUFBSSxHQUFHLENBQUMsUUFBUSxDQUFDLE1BQU0sSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUM7UUFDakUsR0FBRyxDQUFDLElBQUksR0FBRyxHQUFHLENBQUMsUUFBUSxDQUFDO1FBQ3hCLEdBQUcsQ0FBQyxRQUFRLEdBQUcsRUFBRSxDQUFDO0lBQ3BCLENBQUM7SUFFRCxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUM7UUFDcEIsTUFBTSxJQUFJLEdBQUcsR0FBRyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQztRQUMzQyxJQUFJLElBQUksSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsV0FBVyxFQUFFLEtBQUssU0FBUyxJQUFJLElBQUksQ0FBQyxLQUFLLENBQUMsV0FBVyxFQUFFLEtBQUssS0FBSyxDQUFDLEVBQUUsQ0FBQztZQUMzRixHQUFHLENBQUMsSUFBSSxDQUFDLEdBQUcsRUFBRSxDQUFDO1FBQ2pCLENBQUM7SUFDSCxDQUFDO0lBRUQsTUFBTSxPQUFPLEdBQUcsR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQztJQUNsRCxJQUFJLEdBQUcsQ0FBQyxNQUFNLENBQUMsTUFBTSxHQUFHLENBQUMsSUFBSSxPQUFPLElBQUksQ0FBQyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsU0FBUyxJQUFJLE9BQU8sQ0FBQyxRQUFRLEtBQUssQ0FBQyxDQUFDLEVBQUUsQ0FBQztRQUM1RixHQUFHLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsRUFBVyxDQUFDLENBQUM7SUFDOUMsQ0FBQztJQUVELElBQUksR0FBRyxDQUFDLFlBQVksSUFBSSxjQUFjLENBQUMsR0FBRyxDQUFDLFlBQVksRUFBRSxLQUFLLENBQUMsS0FBSyxZQUFZLENBQUMsRUFBRSxFQUFFLENBQUM7UUFDcEYsR0FBRyxDQUFDLFFBQVEsR0FBRztZQUNiLEtBQUssRUFBRSxRQUFRLENBQUMsR0FBRztZQUNuQixJQUFJLEVBQUUsR0FBRyxDQUFDLFlBQVk7WUFDdEIsSUFBSSxFQUFFLEdBQUcsQ0FBQyxZQUFZLENBQUMsSUFBSTtZQUMzQixRQUFRLEVBQUUsQ0FBQztZQUNYLE1BQU0sRUFBRSxDQUFDO1lBQ1QsU0FBUyxFQUFFLElBQUk7WUFDZixLQUFLLEVBQUUsR0FBRyxDQUFDLFlBQVksQ0FBQyxLQUFLO1NBQzlCLENBQUM7UUFDRixHQUFHLENBQUMsWUFBWSxDQUFDLElBQUksR0FBRyxHQUFHLENBQUMsUUFBUSxDQUFDO0lBQ3ZDLENBQUM7SUFFRCxzRkFBc0Y7SUFDdEYscUlBQXFJO0lBQ3JJLGdDQUFnQztJQUNoQyw4QkFBOEI7SUFDOUIsbUJBQW1CO0lBQ25CLHFCQUFxQjtJQUNyQixJQUFJO0lBRUosT0FBTyxPQUFPLENBQUMsR0FBRyxDQUFDLENBQUM7QUFDdEIsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvdW50cnksIEZhY2lsaXR5VHlwZSwgZ2V0Q291bnRyeURlc2MsIElTaXR1cywgaXNQZXJzb25hbElkZW50aWZpZXIsIFBlcnNvbmFsSWRlbnRpZmllciwgdG9Db3VudHJ5LCBVbml0QWJiciB9IGZyb20gJ0B1bml2ZXJzZS9tb2RlbHMnO1xuXG5pbXBvcnQgeyBkaXJlY3Rpb25hbFN0cmluZywgaXNEaXJlY3Rpb25hbCwgdG9EaXJlY3Rpb25hbCB9IGZyb20gJy4uL2RhdGEvRGlyZWN0aW9uYWwuanMnO1xuaW1wb3J0IHsgaXNGYWNpbGl0eVR5cGUsIGlzVXJiYW5pemF0aW9uLHRvRmFjaWxpdHlUeXBlIH0gZnJvbSAnLi4vZGF0YS9GYWNpbGl0eVR5cGUuanMnO1xuaW1wb3J0IHsgaXNTdGF0ZSx0b1N0YXRlIH0gZnJvbSAnLi4vZGF0YS9TdGF0ZS5qcyc7XG5pbXBvcnQgeyBpc1N0cmVldFByZWZpeCxpc1N0cmVldFR5cGUsIHN0cmVldFR5cGVTdHJpbmcsIHRvU3RyZWV0VHlwZSB9IGZyb20gJy4uL2RhdGEvU3RyZWV0VHlwZS5qcyc7XG5pbXBvcnQgeyBpc1VuaXRBYmJyLHRvVW5pdEFiYnIsIHVuaXRBYmJyU3RyaW5nIH0gZnJvbSAnLi4vZGF0YS9Vbml0QWJici5qcyc7XG5pbXBvcnQge1xuICBmaW5kTmV4dE5ld0xpbmUsXG4gIGhhc0xhdGVyU3RyZWV0VHlwZSxcbiAgaGFzU3RhdGVVbml0LFxuICBIZWFkLFxuICBpc0hlYWQsXG4gIGlzSHlwaGVuYXRlZENvZGUsXG4gIGlzTmV3bGluZVNlcCxcbiAgaXNOdW1iZXJPckNvZGUsXG4gIG5ld2xpbmVDb3VudCxcbiAgVG9rZW4sXG4gIHRva2VuaXplLFxufSBmcm9tICcuL3Rva2VuaXplci5qcyc7XG5pbXBvcnQgeyBpc051bWVyaWNhbCwgaXNPcmRpbmFsLCBub3JtYWxpemVIb3VzZU51bSwgbm9ybWFsaXplVW5pdE51bSwgb3JkZXJUb09yZGluYWwsb3JkaW5hbFRvT3JkZXIgfSBmcm9tICcuL3V0aWxzLmpzJztcblxuZnVuY3Rpb24gc3RyaXBMZWFkaW5nWmVyb3Moc3RyOiBzdHJpbmcpIHtcbiAgcmV0dXJuIHN0ci5yZXBsYWNlKC9eMCsvLCAnJyk7XG59XG5cbmludGVyZmFjZSBXb3JraW5nU2l0dXMge1xuICBjYXJlOiBUb2tlbltdO1xuICBmYWNpbGl0eTogVG9rZW5bXTtcbiAgZmFjaWxpdHlUeXBlOiBUb2tlbiB8IG51bGw7XG4gIG51bWJlcjogVG9rZW5bXTtcblxuICBzdHJlZXRQcmVEaXI6IFRva2VuIHwgbnVsbDtcbiAgc3RyZWV0TmFtZTogVG9rZW5bXTtcbiAgc3RyZWV0VHlwZTogVG9rZW4gfCBudWxsO1xuICBzdHJlZXRQb3N0RGlyOiBUb2tlbiB8IG51bGw7XG5cbiAgcGluVHlwZTogVG9rZW4gfCBudWxsO1xuICBwaW5OdW06IFRva2VuW107XG4gIHVuaXRBYmJyOiBUb2tlbiB8IG51bGw7XG4gIHVuaXROdW06IFRva2VuW107XG5cbiAgY2l0eTogVG9rZW5bXTtcbiAgc3RhdGU6IFRva2VuIHwgbnVsbDtcbiAgemlwOiBUb2tlbiB8IG51bGw7XG4gIHppcDQ6IFRva2VuIHwgbnVsbDtcbiAgY291bnRyeTogQ291bnRyeTtcbn1cblxuZnVuY3Rpb24gZXhwYW5kQWJicih0b2tlbjogVG9rZW4sIGRpcmVjdGlvbmFsID0gZmFsc2UsIHVuaXQgPSBmYWxzZSwgc3RyZWV0ID0gZmFsc2UsIG9yZGluYWxzID0gZmFsc2UpOiB2b2lkIHtcbiAgbGV0IHZhbHVlID0gdG9rZW4udmFsdWU7XG4gIGlmICh0b2tlbi5wcmV2Py5zZXBhcmF0b3IpIHsgcmV0dXJuOyB9XG4gIGlmIChpc0RpcmVjdGlvbmFsKHZhbHVlKSkgeyB2YWx1ZSA9IChkaXJlY3Rpb25hbCA/IGRpcmVjdGlvbmFsU3RyaW5nKHZhbHVlKSA6IHRvRGlyZWN0aW9uYWwodmFsdWUpKSB8fCB2YWx1ZTsgfVxuICBpZiAodW5pdCAmJiBpc1VuaXRBYmJyKHZhbHVlKSkgeyB2YWx1ZSA9IHVuaXRBYmJyU3RyaW5nKHZhbHVlKSB8fCB2YWx1ZTsgfVxuICBpZiAoc3RyZWV0ICYmIGlzU3RyZWV0VHlwZSh2YWx1ZSkpIHsgdmFsdWUgPSBzdHJlZXRUeXBlU3RyaW5nKHZhbHVlKSB8fCB2YWx1ZTsgfVxuICB2YWx1ZSA9IG9yZGluYWxzID8gb3JkZXJUb09yZGluYWwodmFsdWUpIDogb3JkaW5hbFRvT3JkZXIodmFsdWUpO1xuICB0b2tlbi52YWx1ZSA9IHZhbHVlO1xufVxuXG5mdW5jdGlvbiBmbGF0dGVuKHRva2VuOiBUb2tlbiB8IG51bGwpOiBUb2tlbltdIHtcbiAgY29uc3QgdG9rZW5zOiBUb2tlbltdID0gW107XG4gIHdoaWxlICh0b2tlbikge1xuICAgIHRva2Vucy5wdXNoKHRva2VuKTtcbiAgICB0b2tlbiA9IHRva2VuLm5leHQ7XG4gIH1cbiAgcmV0dXJuIHRva2Vucztcbn1cblxuY29uc3QgY29uY2F0ID0gKGlucHV0OiBUb2tlbltdIHwgVG9rZW4sIC4uLmZsYWdzOiBib29sZWFuW10pID0+IHtcbiAgY29uc3Qgb3V0ID0gW107XG4gIGNvbnN0IHRva2VuczogVG9rZW5bXSA9ICFBcnJheS5pc0FycmF5KGlucHV0KSA/IGZsYXR0ZW4oaW5wdXQpIDogaW5wdXQ7XG5cbiAgZm9yIChjb25zdCB0b2tlbiBvZiB0b2tlbnMpIHtcbiAgICBleHBhbmRBYmJyKHRva2VuLCAuLi5mbGFncyk7XG4gICAgaWYgKCFpc1N0cmVldFR5cGUodG9rZW4udmFsdWUpICYmIGlzRmFjaWxpdHlUeXBlKHRva2VuLnZhbHVlKSkge1xuICAgICAgdG9rZW4udmFsdWUgPSB0b0ZhY2lsaXR5VHlwZSh0b2tlbi52YWx1ZSkgfHwgdG9rZW4udmFsdWU7XG4gICAgfVxuICAgIG91dC5wdXNoKHRva2VuLnZhbHVlKTtcbiAgICBpZiAoKHRva2VuICE9PSB0b2tlbnNbdG9rZW5zLmxlbmd0aCAtIDFdIHx8IHRva2VuLnNlcGFyYXRvciA9PT0gJy4nKSkge1xuICAgICAgaWYgKHRva2VuLmlzRU9MICYmICF0b2tlbi5zZXBhcmF0b3IpIHtcbiAgICAgICAgb3V0LnB1c2goJ1xcbicpO1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cbiAgICAgIHN3aXRjaCAodG9rZW4uc2VwYXJhdG9yKSB7XG4gICAgICAgIGNhc2UgJyMnOiBvdXQucHVzaCgnICMgJyk7IGJyZWFrO1xuICAgICAgICBjYXNlICcuJzogb3V0LnB1c2goJy4nKTsgYnJlYWs7XG4gICAgICAgIGNhc2UgJyYnOiBvdXQucHVzaCgnICYgJyk7IGJyZWFrO1xuICAgICAgICBjYXNlICcsJzogb3V0LnB1c2goJywgJyk7IGJyZWFrO1xuICAgICAgICBjYXNlICctJzogb3V0LnB1c2goJy0nKTsgYnJlYWs7XG4gICAgICAgIGNhc2UgJy8nOiBvdXQucHVzaCgnLycpOyBicmVhaztcbiAgICAgICAgZGVmYXVsdDogb3V0LnB1c2goJyAnKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgcmV0dXJuIG91dC5qb2luKCcnKS50cmltKCk7XG59O1xuXG5mdW5jdGlvbiB0b0ZvcmVpZ25TaXR1cyh3b3JraW5nOiBXb3JraW5nU2l0dXMpOiBJU2l0dXMge1xuICByZXR1cm4ge1xuICAgIGNhcmU6IGNvbmNhdCh3b3JraW5nLmNhcmUpIHx8IG51bGwsXG4gICAgZmFjaWxpdHk6IG51bGwsXG4gICAgZmFjaWxpdHlUeXBlOiBudWxsLFxuICAgIHBpblR5cGU6IG51bGwsXG4gICAgcGluTnVtOiBudWxsLFxuXG4gICAgbnVtYmVyOiBudWxsLFxuXG4gICAgc3RyZWV0UHJlRGlyOiBudWxsLFxuICAgIHN0cmVldE5hbWU6IG51bGwsXG4gICAgc3RyZWV0VHlwZTogbnVsbCxcbiAgICBzdHJlZXRQb3N0RGlyOiBudWxsLFxuXG4gICAgdW5pdEFiYnI6IG51bGwsXG4gICAgdW5pdE51bTogbnVsbCxcblxuICAgIGNpdHk6IG51bGwsXG4gICAgc3RhdGU6IG51bGwsXG4gICAgemlwOiBudWxsLFxuICAgIHppcDQ6IG51bGwsXG4gICAgY291bnRyeTogd29ya2luZy5jb3VudHJ5LFxuICB9O1xufVxuXG5mdW5jdGlvbiB0b1NpdHVzKHdvcmtpbmc6IFdvcmtpbmdTaXR1cyk6IElTaXR1cyB7XG4gIGNvbnN0IE9VVDogSVNpdHVzID0ge1xuICAgIGNhcmU6IG51bGwsXG4gICAgZmFjaWxpdHk6IG51bGwsXG4gICAgZmFjaWxpdHlUeXBlOiBudWxsLFxuICAgIHBpblR5cGU6IG51bGwsXG4gICAgcGluTnVtOiBudWxsLFxuXG4gICAgbnVtYmVyOiBudWxsLFxuXG4gICAgc3RyZWV0UHJlRGlyOiBudWxsLFxuICAgIHN0cmVldE5hbWU6IG51bGwsXG4gICAgc3RyZWV0VHlwZTogbnVsbCxcbiAgICBzdHJlZXRQb3N0RGlyOiBudWxsLFxuXG4gICAgdW5pdEFiYnI6IG51bGwsXG4gICAgdW5pdE51bTogbnVsbCxcblxuICAgIGNpdHk6IG51bGwsXG4gICAgc3RhdGU6IG51bGwsXG4gICAgemlwOiBudWxsLFxuICAgIHppcDQ6IG51bGwsXG4gICAgY291bnRyeTogbnVsbCxcbiAgfTtcblxuICBPVVQuY2FyZSA9IGNvbmNhdCh3b3JraW5nLmNhcmUsIHRydWUsIHRydWUsIHRydWUsIGZhbHNlKSB8fCBudWxsO1xuICBPVVQuZmFjaWxpdHkgPSBjb25jYXQod29ya2luZy5mYWNpbGl0eSwgdHJ1ZSwgdHJ1ZSwgZmFsc2UsIHRydWUpIHx8IG51bGw7XG4gIE9VVC5mYWNpbGl0eVR5cGUgPSB3b3JraW5nLmZhY2lsaXR5VHlwZSA/IHRvRmFjaWxpdHlUeXBlKHdvcmtpbmcuZmFjaWxpdHlUeXBlLnZhbHVlKSA6IG51bGw7XG4gIE9VVC5waW5UeXBlID0gd29ya2luZy5waW5UeXBlID8gd29ya2luZy5waW5UeXBlLnZhbHVlLnRvVXBwZXJDYXNlKCkgYXMgUGVyc29uYWxJZGVudGlmaWVyIDogbnVsbDtcbiAgT1VULnBpbk51bSA9IGNvbmNhdCh3b3JraW5nLnBpbk51bSkgPyBjb25jYXQod29ya2luZy5waW5OdW0sIGZhbHNlLCBmYWxzZSwgZmFsc2UsIHRydWUpLnRvVXBwZXJDYXNlKCkgOiBudWxsO1xuXG4gIE9VVC5udW1iZXIgPSBub3JtYWxpemVIb3VzZU51bShzdHJpcExlYWRpbmdaZXJvcyhjb25jYXQod29ya2luZy5udW1iZXIsIHRydWUsIHRydWUsIHRydWUsIHRydWUpKSkgfHwgbnVsbDtcblxuICBPVVQuc3RyZWV0UHJlRGlyID0gd29ya2luZy5zdHJlZXRQcmVEaXIgPyB0b0RpcmVjdGlvbmFsKHdvcmtpbmcuc3RyZWV0UHJlRGlyLnZhbHVlKSA6IG51bGw7XG4gIE9VVC5zdHJlZXROYW1lID0gc3RyaXBMZWFkaW5nWmVyb3MoY29uY2F0KHdvcmtpbmcuc3RyZWV0TmFtZSwgZmFsc2UsIHRydWUsIHRydWUsIHRydWUpKSB8fCBudWxsO1xuICBPVVQuc3RyZWV0VHlwZSA9IHdvcmtpbmcuc3RyZWV0VHlwZSA/IHRvU3RyZWV0VHlwZSh3b3JraW5nLnN0cmVldFR5cGUudmFsdWUpIDogbnVsbDtcbiAgT1VULnN0cmVldFBvc3REaXIgPSB3b3JraW5nLnN0cmVldFBvc3REaXIgPyB0b0RpcmVjdGlvbmFsKHdvcmtpbmcuc3RyZWV0UG9zdERpci52YWx1ZSkgOiBudWxsO1xuXG4gIE9VVC51bml0QWJiciA9IHdvcmtpbmcudW5pdEFiYnIgPyB0b1VuaXRBYmJyKHdvcmtpbmcudW5pdEFiYnIudmFsdWUpIDogbnVsbDtcbiAgT1VULnVuaXROdW0gPSBub3JtYWxpemVVbml0TnVtKHdvcmtpbmcudW5pdE51bSkgfHwgbnVsbDtcblxuICBPVVQuY2l0eSA9IGNvbmNhdCh3b3JraW5nLmNpdHksIHRydWUsIGZhbHNlLCBmYWxzZSwgZmFsc2UpIHx8IG51bGw7XG4gIE9VVC5zdGF0ZSA9IHdvcmtpbmcuc3RhdGUgPyB0b1N0YXRlKHdvcmtpbmcuc3RhdGUudmFsdWUpIDogbnVsbDtcbiAgT1VULnppcCA9IHdvcmtpbmcuemlwPy52YWx1ZSB8fCBudWxsO1xuICBPVVQuemlwNCA9IHdvcmtpbmcuemlwND8udmFsdWUgfHwgbnVsbDtcblxuICBPVVQuY291bnRyeSA9IHdvcmtpbmcuY291bnRyeTsgLy8gV2UgY2F0Y2ggZm9yZWlnbiBhZGRyZXNzZXMgZWFybHkuIEV2ZXJ5dGhpbmcgdGhhdCBtYWtlcyBpdCB0aGlzIGZhciB3aWxsIGJlIFVTQS5cblxuICBpZiAoT1VULmZhY2lsaXR5VHlwZSA9PT0gRmFjaWxpdHlUeXBlLlBPICYmIE9VVC51bml0QWJiciA9PT0gVW5pdEFiYnIuQk9YKSB7XG4gICAgT1VULnVuaXROdW0gPSBPVVQudW5pdE51bSA/IE9VVC51bml0TnVtLnJlcGxhY2UoLyAvZywgJycpLnRvVXBwZXJDYXNlKCkgOiBudWxsO1xuICB9XG5cbiAgcmV0dXJuIE9VVDtcbn1cblxuZnVuY3Rpb24gY29uc3VtZUlkcyhwb2ludGVyOiBUb2tlbiB8IG51bGwsIGh5cGhlbnNPbmx5ID0gZmFsc2UpOiBbVG9rZW5bXSwgVG9rZW4gfCBudWxsXSB7XG4gIGNvbnN0IGlkcyA9IFtdO1xuICB3aGlsZSAocG9pbnRlciAmJiBpc051bWJlck9yQ29kZShwb2ludGVyKSkge1xuICAgIGlkcy5wdXNoKHBvaW50ZXIpO1xuICAgIHBvaW50ZXIgPSBwb2ludGVyLm5leHQ7XG4gICAgaWYgKGh5cGhlbnNPbmx5ICYmIHBvaW50ZXI/LnByZXYgJiYgIWlzSHlwaGVuYXRlZENvZGUocG9pbnRlci5wcmV2KSkgeyBicmVhazsgfVxuICAgIGlmIChwb2ludGVyPy5wcmV2ICYmIGlzTmV3bGluZVNlcChwb2ludGVyLnByZXYpKSB7IGJyZWFrOyB9XG4gIH1cbiAgcmV0dXJuIFsgaWRzLCBwb2ludGVyIF07XG59XG5cbmZ1bmN0aW9uIGNvbnN1bWVMaW5lKHBvaW50ZXI6IFRva2VuIHwgbnVsbCk6IFtUb2tlbltdLCBUb2tlbiB8IG51bGxdIHtcbiAgY29uc3QgaWRzID0gW107XG4gIHdoaWxlIChwb2ludGVyKSB7XG4gICAgaWRzLnB1c2gocG9pbnRlcik7XG4gICAgcG9pbnRlciA9IHBvaW50ZXIubmV4dDtcbiAgICBpZiAocG9pbnRlcj8ucHJldiAmJiBpc05ld2xpbmVTZXAocG9pbnRlci5wcmV2KSkgeyBicmVhazsgfVxuICB9XG4gIHJldHVybiBbIGlkcywgcG9pbnRlciBdO1xufVxuXG5mdW5jdGlvbiBpc0xpa2VseUZpbmFsTGluZShwb2ludGVyOiBUb2tlbiB8IG51bGwpOiBib29sZWFuIHtcbiAgbGV0IGZvdW5kVG9rZW4gPSBmYWxzZTtcbiAgbGV0IGZvdW5kQ29kZSA9IGZhbHNlO1xuICB3aGlsZSAocG9pbnRlcikge1xuICAgIGlmIChpc1N0cmVldFR5cGUocG9pbnRlci52YWx1ZSkgfHwgaXNVbml0QWJicihwb2ludGVyLnZhbHVlKSkgeyBmb3VuZFRva2VuID0gdHJ1ZTsgfVxuICAgIGlmIChpc051bWJlck9yQ29kZShwb2ludGVyLnZhbHVlKSkgeyBmb3VuZENvZGUgPSB0cnVlOyB9XG4gICAgaWYgKGZvdW5kVG9rZW4gJiYgZm91bmRDb2RlKSB7IHJldHVybiBmYWxzZTsgfVxuXG4gICAgaWYgKGlzU3RhdGUocG9pbnRlci52YWx1ZSkgJiYgcG9pbnRlci5uZXh0ICYmIHBvaW50ZXIubmV4dC5hbHBoYXMgPT09IDAgJiYgcG9pbnRlci5uZXh0LmRlY2ltYWxzID09PSA1KSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG5cbiAgICBpZiAoaXNOZXdsaW5lU2VwKHBvaW50ZXIpKSB7IHJldHVybiBmYWxzZTsgfVxuICAgIHBvaW50ZXIgPSBwb2ludGVyLm5leHQ7XG4gIH1cbiAgcmV0dXJuIHRydWU7XG59XG5cbmZ1bmN0aW9uIGlzTGFzdFN0YXRlKHBvaW50ZXI6IFRva2VuIHwgbnVsbCk6IGJvb2xlYW4ge1xuICBpZiAoIXBvaW50ZXIpIHsgcmV0dXJuIGZhbHNlOyB9XG4gIGlmICghaXNTdGF0ZShwb2ludGVyLnZhbHVlKSkgeyByZXR1cm4gZmFsc2U7IH1cbiAgcG9pbnRlciA9IHBvaW50ZXIubmV4dDtcbiAgd2hpbGUgKHBvaW50ZXIpIHtcbiAgICBpZiAoaXNTdGF0ZShwb2ludGVyLnZhbHVlKSkgeyByZXR1cm4gZmFsc2U7IH1cbiAgICBwb2ludGVyID0gcG9pbnRlci5uZXh0O1xuICB9XG4gIHJldHVybiB0cnVlO1xufVxuXG5mdW5jdGlvbiBpc09ubHlJZHMocG9pbnRlcjogVG9rZW4gfCBudWxsKTogYm9vbGVhbiB7XG4gIHdoaWxlIChwb2ludGVyKSB7XG4gICAgaWYgKCFpc051bWJlck9yQ29kZShwb2ludGVyKSB8fCBpc09yZGluYWwocG9pbnRlci52YWx1ZSkgfHwgaXNEaXJlY3Rpb25hbChwb2ludGVyLnZhbHVlKSB8fCBpc1N0cmVldFR5cGUocG9pbnRlci52YWx1ZSkgfHwgaXNVbml0QWJicihwb2ludGVyLnZhbHVlKSkgeyByZXR1cm4gZmFsc2U7IH1cbiAgICBpZiAoaXNOZXdsaW5lU2VwKHBvaW50ZXIpKSB7IGJyZWFrOyB9XG4gICAgcG9pbnRlciA9IHBvaW50ZXIubmV4dDtcbiAgfVxuICByZXR1cm4gdHJ1ZTtcbn1cblxuZnVuY3Rpb24gaXNGb3JlaWduQWRkcmVzcyhoZWFkOiBIZWFkLCBvdXQ6IFdvcmtpbmdTaXR1cyk6IGJvb2xlYW4ge1xuICBpZiAoIWhlYWQubmV4dCkgeyByZXR1cm4gZmFsc2U7IH1cbiAgbGV0IHBvaW50ZXI6IFRva2VuIHwgSGVhZCA9IGhlYWQubmV4dDtcbiAgd2hpbGUgKHBvaW50ZXIubmV4dCkge1xuICAgIHBvaW50ZXIgPSBwb2ludGVyLm5leHQ7XG4gIH1cblxuICBsZXQgY291bnRyeVRlc3QgPSAnJztcbiAgd2hpbGUgKHBvaW50ZXIgIT09IGhlYWQpIHtcbiAgICBpZiAoaXNIZWFkKHBvaW50ZXIpKSB7IGJyZWFrOyB9IC8vIE1vc3RseSBmb3IgVHlwZXNjcmlwdFxuICAgIGlmIChpc05ld2xpbmVTZXAocG9pbnRlcikpIHsgYnJlYWs7IH1cbiAgICBjb3VudHJ5VGVzdCA9IFsgcG9pbnRlci52YWx1ZSwgY291bnRyeVRlc3QgXS5maWx0ZXIoQm9vbGVhbikuam9pbignICcpO1xuXG4gICAgLy8gRG9uJ3QgaW50ZXJwcmV0IHBhcnRpYWwgYWRkcmVzc2VzIGVuZGluZyBpbiBhIHN0YW5kYXJkIGRhdGEgYWJicmV2aWF0aW9uIHZhbHVlIGFzIGZvcmVpZ24uXG4gICAgaWYgKHRvU3RhdGUoY291bnRyeVRlc3QpIHx8IHRvU3RyZWV0VHlwZShjb3VudHJ5VGVzdCkgfHwgdG9Vbml0QWJicihjb3VudHJ5VGVzdCkpIHsgY29udGludWU7IH1cblxuICAgIGNvbnN0IGNvdW50cnkgPSB0b0NvdW50cnkoY291bnRyeVRlc3QpO1xuICAgIGlmICghY291bnRyeSkgeyBwb2ludGVyID0gcG9pbnRlci5wcmV2OyBjb250aW51ZTsgfVxuXG4gICAgY29uc3QgZGVzYyA9IGdldENvdW50cnlEZXNjKGNvdW50cnkpO1xuICAgIGlmICghZGVzYykgeyBwb2ludGVyID0gcG9pbnRlci5wcmV2OyBjb250aW51ZTsgfVxuXG4gICAgaWYgKGNvdW50cnkgPT09IENvdW50cnkuVVNBIHx8IGRlc2Muc292ZXJlaWdudHkgPT09IENvdW50cnkuVVNBKSB7XG4gICAgICBvdXQuY291bnRyeSA9IENvdW50cnkuVVNBO1xuICAgICAgcG9pbnRlci5wcmV2Lm5leHQgPSBudWxsO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIC8vIEhhbmRsZSBjb3JuZXIgY2FzZSB3aXRoIGFkZHJlc3NlcyB0aGF0IGVuZCB3aXRoIFwiRGVsIE1hclwiLlxuICAgIGlmIChjb3VudHJ5ID09PSBDb3VudHJ5Lk1BUiAmJiAhcG9pbnRlci5wcmV2LmlzRU9MICYmIChwb2ludGVyLnByZXYgYXMgVG9rZW4pPy52YWx1ZT8udG9Mb3dlckNhc2UoKSA9PT0gJ2RlbCcpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICBwb2ludGVyLnByZXYubmV4dCA9IG51bGw7XG4gICAgb3V0LmNhcmUgPSBmbGF0dGVuKGhlYWQubmV4dCk7XG4gICAgb3V0LmNvdW50cnkgPSBjb3VudHJ5O1xuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgcmV0dXJuIGZhbHNlO1xufVxuXG4vLyBFeHRyYWN0IGNhcmUtb2YgbGluZXMgd2hlcmUgd2UgaGF2ZSBhIGRlZmluaXRlIG1hdGNoLlxuLy8gVE9ETzogQWRkIG1vcmUgZGVmaW5pdGl2ZSBjb21wYW55IHR5cGVzIGhlcmUuLi5cbmNvbnN0IENvbXBhbnlUeXBlcyA9IG5ldyBTZXQoWyAnVU5JVkVSU0lUWScsICdDT0xMRUdFJywgJ1NFUlZJQ0VTJywgJ1RBVycgXSk7XG5jb25zdCBXZWxsS25vd25DYXJlID0gbmV3IFNldChbJ0dFTkVSQUwgREVMSVZFUlknXSk7IC8vIFNwZWNpYWwgUG9zdCBPZmZpY2UgVGVybVxuZnVuY3Rpb24gZXh0cmFjdENhcmVPZihoZWFkOiBIZWFkLCBvdXQ6IFdvcmtpbmdTaXR1cyk6IHZvaWQge1xuICBsZXQgbGluZVN0YXJ0OiBUb2tlbiB8IG51bGwgPSBoZWFkLm5leHQ7XG4gIGxldCBwb2ludGVyOiBUb2tlbiB8IG51bGwgPSBoZWFkLm5leHQ7XG4gIGxldCBPVVQ6IFRva2VuW10gPSBbXTtcbiAgbGV0IGZvdW5kU3RhcnQgPSBmYWxzZTtcbiAgbGV0IGZvdW5kU3RyZWV0VHlwZSA9IGZhbHNlO1xuICBsZXQgZm91bmRGYWNpbGl0eVR5cGUgPSBmYWxzZTtcbiAgbGV0IGZvdW5kRGVmaW5pdGVNYXRjaCA9IGZhbHNlO1xuICBsZXQgaGFzQ29kZVRva2VucyA9IGZhbHNlO1xuXG4gIHdoaWxlIChwb2ludGVyKSB7XG4gICAgLy8gSWYgdGhlIGZpcnN0IHZhbHVlIGlzIGEgc3RyYWlnaHQgbnVtYmVyLCB0aGlzIGlzIGxpa2VseSBub3QgYSBjYXJlIG9mIGxpbmUsIGl0cyBhIHN0cmVldCEgU2tpcC5cbiAgICBpZiAoIWZvdW5kU3RhcnQgJiYgIXBvaW50ZXIuYWxwaGFzICYmIHBvaW50ZXIuZGVjaW1hbHMpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBJZiB0aGlzIGlzIGEgUElOIFR5cGUsIGNvbGxlY3QgYWNjb3JkaW5nbHkuIElnbm9yZSBwaW5zIHNlcGFyYXRlZCBieSAnJicgKGV4OiBBICYgTSBMaXF1b3JzKVxuICAgIGVsc2UgaWYgKHBvaW50ZXIuc2VwYXJhdG9yID09PSAnJicgfHwgcG9pbnRlci5wcmV2LnNlcGFyYXRvciA9PT0gJyYnKSB7IDE7IH1cbiAgICBlbHNlIGlmIChpc051bWJlck9yQ29kZShwb2ludGVyKSkge1xuICAgICAgaGFzQ29kZVRva2VucyA9IHRydWU7XG4gICAgfVxuICAgIGVsc2UgaWYgKGlzU3RyZWV0VHlwZShwb2ludGVyLnZhbHVlKSAmJiAhcG9pbnRlci5wcmV2LnNlcGFyYXRvcikge1xuICAgICAgZm91bmRTdHJlZXRUeXBlID0gdHJ1ZTtcbiAgICB9XG4gICAgZWxzZSBpZiAoaXNGYWNpbGl0eVR5cGUocG9pbnRlci52YWx1ZSkgJiYgIXBvaW50ZXIucHJldi5zZXBhcmF0b3IpIHtcbiAgICAgIGZvdW5kRmFjaWxpdHlUeXBlID0gdHJ1ZTtcbiAgICB9XG4gICAgZWxzZSBpZiAoQ29tcGFueVR5cGVzLmhhcyhwb2ludGVyLnZhbHVlLnRvVXBwZXJDYXNlKCkpKSB7XG4gICAgICBmb3VuZERlZmluaXRlTWF0Y2ggPSB0cnVlO1xuICAgIH1cblxuICAgIGZvdW5kU3RhcnQgPSB0cnVlO1xuICAgIE9VVC5wdXNoKHBvaW50ZXIpO1xuXG4gICAgaWYgKFdlbGxLbm93bkNhcmUuaGFzKE9VVC5tYXAocCA9PiBwLnZhbHVlKS5qb2luKCcgJykudG9VcHBlckNhc2UoKSkpIHtcbiAgICAgIGZvdW5kRGVmaW5pdGVNYXRjaCA9IHRydWU7XG4gICAgICBwb2ludGVyLmlzRU9MID0gdHJ1ZTtcbiAgICB9XG5cbiAgICAvLyBJZiB3ZSBqdXN0IGZpbmlzaGVkIGEgbGluZSwgY2hlY2sgaWYgaXMgdmFsaWQuXG4gICAgaWYgKGlzTmV3bGluZVNlcChwb2ludGVyKSkge1xuICAgICAgLy8gSWYgdGhpcyBsaW5lIGlzIGEgZGVmaW5pdGUgY2FyZS1vZiBtYXRjaCwgYnJlYWshXG4gICAgICBpZiAoKCghZm91bmRTdHJlZXRUeXBlICYmICFoYXNDb2RlVG9rZW5zKSB8fCAoZm91bmRTdHJlZXRUeXBlICYmICFoYXNDb2RlVG9rZW5zKSB8fCAoZm91bmREZWZpbml0ZU1hdGNoICYmICFmb3VuZFN0cmVldFR5cGUpKSAmJiAhZm91bmRGYWNpbGl0eVR5cGUpIHsgYnJlYWs7IH1cbiAgICAgIGxpbmVTdGFydCA9IHBvaW50ZXIubmV4dDtcbiAgICAgIGZvdW5kRmFjaWxpdHlUeXBlID0gZmFsc2U7XG4gICAgICBmb3VuZFN0cmVldFR5cGUgPSBmYWxzZTtcbiAgICAgIGZvdW5kRGVmaW5pdGVNYXRjaCA9IGZhbHNlO1xuICAgICAgT1VUID0gW107XG4gICAgfVxuXG4gICAgcG9pbnRlciA9IHBvaW50ZXIubmV4dDtcbiAgfVxuXG4gIC8vIElmIHRoaXMgbGluZSBpcyBhIGRlZmluaXRlIGNhcmUtb2YgbWF0Y2gsIHNwbGljZSBpdCBvdXQgb2YgdGhlIGxpbmtlZCBsaXN0IGFuZCByZXR1cm4gdGhlIHRva2VucyFcbiAgaWYgKGxpbmVTdGFydCAmJiAoKCFmb3VuZFN0cmVldFR5cGUgJiYgIWhhc0NvZGVUb2tlbnMpIHx8IChmb3VuZFN0cmVldFR5cGUgJiYgIWhhc0NvZGVUb2tlbnMpIHx8IChmb3VuZERlZmluaXRlTWF0Y2ggJiYgIWZvdW5kU3RyZWV0VHlwZSkpICYmICFmb3VuZEZhY2lsaXR5VHlwZSkge1xuICAgIGxpbmVTdGFydC5wcmV2Lm5leHQgPSBwb2ludGVyPy5uZXh0IHx8IG51bGw7XG4gICAgbGluZVN0YXJ0LnByZXYuaXNFT0wgPSBwb2ludGVyPy5pc0VPTCB8fCBmYWxzZTtcbiAgICBwb2ludGVyPy5uZXh0ICYmIChwb2ludGVyLm5leHQucHJldiA9IGxpbmVTdGFydC5wcmV2KTtcbiAgICBvdXQuY2FyZSA9IE9VVDtcbiAgfVxufVxuXG5mdW5jdGlvbiBleHRyYWN0UElEKGhlYWQ6IEhlYWQsIG91dDogV29ya2luZ1NpdHVzKSB7XG4gIC8vIEV4dHJhY3Qgd2VsbCBrbm93IFBJRCB0eXBlcyBpZiB3ZSBjYW4gZmluZCBhIGRlZmluaXRlIG1hdGNoLlxuICBsZXQgcG9pbnRlcjogVG9rZW4gfCBudWxsID0gaGVhZC5uZXh0O1xuICB3aGlsZSAocG9pbnRlcikge1xuICAgIC8vIElmIHRoaXMgaXMgYSBQSU4gVHlwZSwgY29sbGVjdCBhY2NvcmRpbmdseS5cbiAgICBpZiAocG9pbnRlciAmJiBpc1BlcnNvbmFsSWRlbnRpZmllcihwb2ludGVyLnZhbHVlLnRvVXBwZXJDYXNlKCkpKSB7XG4gICAgICBjb25zdCBwaWQgPSBwb2ludGVyO1xuICAgICAgcG9pbnRlciA9IHBvaW50ZXIubmV4dDtcbiAgICAgIGNvbnN0IFsgaWRzLCBuZXh0IF0gPSBjb25zdW1lTGluZShwb2ludGVyKTtcbiAgICAgIGlmIChpZHMubGVuZ3RoID09PSAwKSB7IGNvbnRpbnVlOyB9XG5cbiAgICAgIC8vIFRoZXJlIGlzIGFtYmlndWl0eSBiZXR3ZWVuIHRoZSBcIk1TXCIgYWJicmV2aWF0aW9uIGZvciBcIk1haWwgU3RvcFwiIGFuZCBcIk1pc3Npc3NpcHBpXCIuXG4gICAgICAvLyBFbnN1cmUgd2UncmUgbm90IGFjY2lkZW50YWxseSBzY29vcGluZyB1cCB0aGUgc3RhdGUgYW5kIHppcCBoZXJlLlxuICAgICAgaWYgKHBpZC52YWx1ZS50b1VwcGVyQ2FzZSgpID09PSAnTVMnICYmIGlzTGlrZWx5RmluYWxMaW5lKHBpZCkpIHtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG5cbiAgICAgIG91dC5waW5UeXBlID0gcGlkO1xuICAgICAgb3V0LnBpbk51bSA9IGlkcztcbiAgICAgIHBvaW50ZXIgPSBuZXh0O1xuXG4gICAgICAvLyBTcGxpY2UgdGhlIGVudGlyZSBQSU4gc3RhdGVtZW50IG91dCBvZiB0aGUgbGlua2VkIGxpc3QuXG4gICAgICBwaWQucHJldi5uZXh0ID0gbmV4dDtcbiAgICAgIGlmICghaXNIZWFkKHBpZC5wcmV2KSAmJiAhaXNIZWFkKG5leHQ/LnByZXYpKSB7XG4gICAgICAgIHBpZC5wcmV2LnNlcGFyYXRvciA9IG5leHQ/LnByZXY/LnNlcGFyYXRvciB8fCBudWxsO1xuICAgICAgICBwaWQucHJldi5pc0VPTCA9IG5leHQ/LnByZXY/LmlzRU9MIHx8IGZhbHNlO1xuICAgICAgfVxuXG4gICAgICBuZXh0ICYmIChuZXh0LnByZXYgPSBwaWQucHJldik7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG4gICAgcG9pbnRlciA9IHBvaW50ZXIubmV4dDtcbiAgfVxufVxuXG5mdW5jdGlvbiBleHRyYWN0RmFjaWxpdHkocG9pbnRlcjogVG9rZW4gfCBudWxsLCBvdXQ6IFdvcmtpbmdTaXR1cykge1xuICBsZXQgZmFjaWxpdHk6IFRva2VuW10gPSBbXTtcbiAgbGV0IGZhY2lsaXR5VHlwZTogVG9rZW4gfCBudWxsID0gbnVsbDtcbiAgbGV0IG51bWJlcjogVG9rZW5bXSA9IFtdO1xuICBsZXQgcGluTnVtOiBUb2tlbltdID0gW107XG4gIGxldCB1bml0QWJicjogVG9rZW4gfCBudWxsID0gbnVsbDtcbiAgbGV0IHVuaXROdW06IFRva2VuW10gPSBbXTtcbiAgZmFjaWxpdHlMaW5lOiB3aGlsZSAocG9pbnRlcikge1xuICAgIC8vIElmIGlzIGEga25vd24gZmFjaWxpdHkgdHlwZSwgc2F2ZSB0aGlzIGFzIGEgc3RhbmRhcmQgdmFsdWUuXG4gICAgaWYgKCFmYWNpbGl0eVR5cGUgJiYgdG9GYWNpbGl0eVR5cGUocG9pbnRlci52YWx1ZSkpIHtcbiAgICAgIGZhY2lsaXR5VHlwZSA9IHBvaW50ZXI7XG4gICAgICBwb2ludGVyID0gcG9pbnRlci5uZXh0O1xuICAgIH1cblxuICAgIC8vIElmIGlzIGEgdW5pdCBhYmJyZXZpYXRpb24gdGhlbiBzb21lb25lIHB1dCB0aGUgdW5pdCBvbiB0aGUgZmFjaWxpdHkgbGluZSEgQWNjb21tb2RhdGUuXG4gICAgZWxzZSBpZiAodG9Vbml0QWJicihwb2ludGVyLnZhbHVlKSkge1xuICAgICAgY29uc3QgcHJldlVuaXRBYmJyOiBUb2tlbiB8IG51bGwgPSB1bml0QWJicjtcbiAgICAgIHVuaXRBYmJyID0gcG9pbnRlcjtcbiAgICAgIHBvaW50ZXIgPSBwb2ludGVyLm5leHQ7XG5cbiAgICAgIC8vIENvbnN1bWUgaWRlbnRpZmllcnMgdW50aWwgdGhlcmUgYXJlIG5vIG1vcmUgdW5pdCBpZHMuXG4gICAgICBjb25zdCBbIGlkcywgbmV4dCBdID0gY29uc3VtZUlkcyhwb2ludGVyKTtcblxuICAgICAgLy8gSWYgdGhlcmUgaXMgbm8gdmFsaWQgdW5pdE51bSwgdGhlbiB0aGlzIHVuaXQgYWJiciBtdXN0IGJlIHBhcnQgb2YgdGhlIGZhY2lsaXR5IG5hbWUuXG4gICAgICBpZiAoIWlkcy5sZW5ndGgpIHtcbiAgICAgICAgZmFjaWxpdHkucHVzaCh1bml0QWJicik7XG4gICAgICAgIHVuaXRBYmJyID0gcHJldlVuaXRBYmJyO1xuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgIHVuaXROdW0gPSBpZHM7XG4gICAgICAgIHBvaW50ZXIgPSBuZXh0O1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIElmIHdlJ3ZlIGZvdW5kIGEgbnVtYmVyIG9yIGNvZGUsIHByZXNlcnZlIGl0LiBUaGlzIHdpbGwgbmV2ZXIgcnVuIGZpcnN0LlxuICAgIGVsc2UgaWYgKGlzTnVtYmVyT3JDb2RlKHBvaW50ZXIpKSB7XG4gICAgICAvLyBXZSBvbmx5IGdldCBvbmUgKG5vbi1oeXBoZW5hdGVkKSBudW1iZXIgaWRlbnRpZmllciBmb3IgZW51bWVyYXRlZCBmYWNpbGl0aWVzLiBFdmVyeXRoaW5nIGZvbGxvd2luZyBtdXN0IGJlIGEgdW5pdCBvciBQSU4uXG4gICAgICBjb25zdCBpc0ZpbmROdW1iZXIgPSAhIShmYWNpbGl0eVR5cGUgJiYgIW51bWJlci5sZW5ndGgpO1xuXG4gICAgICAvLyBGZXRjaCBhbGwgb3VyIGlkIHRva2Vucy5cbiAgICAgIGNvbnN0IFsgaWRzLCBuZXh0IF0gPSBjb25zdW1lSWRzKHBvaW50ZXIsIGlzRmluZE51bWJlcik7XG5cbiAgICAgIC8vIFRvIHN0b3JlIGFzIGEgbnVtYmVyIG9yIHBpbiwgaXQgbXVzdCBhY3R1YWxseSBjb250YWluIGEgbnVtYmVyIVxuICAgICAgbGV0IGhhc051bSA9IGZhbHNlO1xuICAgICAgZm9yIChjb25zdCBpZCBvZiBpZHMpIHtcbiAgICAgICAgaWYgKGlkLnZhbHVlLm1hdGNoKC9cXGQvKSkge1xuICAgICAgICAgIGhhc051bSA9IHRydWU7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgaWYgKCFoYXNOdW0pIHtcbiAgICAgICAgZmFjaWxpdHkgPSBbIC4uLmZhY2lsaXR5LCAuLi5pZHMgXTtcbiAgICAgIH1cbiAgICAgIGVsc2UgaWYgKGlzRmluZE51bWJlcikge1xuICAgICAgICBudW1iZXIgPSBpZHM7XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgcGluTnVtID0gaWRzO1xuICAgICAgfVxuICAgICAgcG9pbnRlciA9IG5leHQ7XG4gICAgfVxuXG4gICAgLy8gT3RoZXJ3aXNlLCB0aGlzIGlzIHBhcnQgb2YgdGhlIGZhY2lsaXR5IG5hbWUuIFNhdmUgYW5kIGNvbnRpbnVlIG9uLlxuICAgIC8vIElmIHdlIGFscmVhZHkgaGF2ZSBhIG51bWJlciBnb2luZywgaXQgd2FzIGFjdHVhbGx5IHBhcnR5IG9mIHRoZSBmYWNpbGl0eSBuYW1lLlxuICAgIC8vIERvbid0IG92ZXJ3cml0ZSBleHBsaWNpdGx5IG5hbWVkIFBJTnMgZGlzY292ZXJlZCBlYXJsaWVyLlxuICAgIGVsc2Uge1xuICAgICAgZmFjaWxpdHkgPSBbIC4uLmZhY2lsaXR5LCAuLi5udW1iZXIsIC4uLnBpbk51bSwgcG9pbnRlciBdO1xuICAgICAgbnVtYmVyID0gW107XG4gICAgICBwaW5OdW0gPSBbXTtcbiAgICAgIHBvaW50ZXIgPSBwb2ludGVyLm5leHQ7XG4gICAgfVxuXG4gICAgLy8gSWYgdGhpcyBpcyB0aGUgZmlyc3QgdG9rZW4gb24gYSBuZXcgbGluZSwgYnJlYWsuIEZhY2lsaXR5IHN0cmluZ3MgbXVzdCBhbHdheXMgYmUgb24gdGhlIGZpcnN0IGxpbmUuXG4gICAgaWYgKHBvaW50ZXIgJiYgaXNOZXdsaW5lU2VwKHBvaW50ZXIucHJldikpIHsgYnJlYWsgZmFjaWxpdHlMaW5lOyB9XG4gIH1cblxuICBpZiAob3V0LnBpbk51bS5sZW5ndGggJiYgcGluTnVtLmxlbmd0aCAmJiAhb3V0LnBpblR5cGUpIHtcbiAgICBvdXQuZmFjaWxpdHkucHVzaCguLi5vdXQucGluTnVtKTtcbiAgfVxuICBpZiAob3V0LmZhY2lsaXR5VHlwZSAmJiBmYWNpbGl0eVR5cGUpIHtcbiAgICBvdXQuZmFjaWxpdHkucHVzaChvdXQuZmFjaWxpdHlUeXBlKTtcbiAgfVxuXG4gIGlmIChvdXQubnVtYmVyLmxlbmd0aCAmJiBudW1iZXIubGVuZ3RoICYmICFvdXQucGluVHlwZSkge1xuICAgIG91dC5waW5OdW0gPSBvdXQubnVtYmVyO1xuICB9XG5cbiAgLy8gUHJvbW90ZSB0aGUgcHJldmlvdXMgZmFjaWxpdHkgbmFtZSB0byB0aGUgY2FyZSBsaW5lIGlmIGl0IGlzbid0IGFscmVhZHkgc3BlY2lmaWVkLlxuICBpZiAoIW91dC5jYXJlLmxlbmd0aCAmJiAhb3V0LmZhY2lsaXR5VHlwZSAmJiBmYWNpbGl0eS5sZW5ndGgpIHtcbiAgICBvdXQuY2FyZSA9IFsgLi4ub3V0LmZhY2lsaXR5LCAuLi4oIW91dC5waW5UeXBlID8gb3V0LnBpbk51bSA6IFtdKSBdLmZpbHRlcihCb29sZWFuKSBhcyBUb2tlbltdO1xuICAgIG91dC5mYWNpbGl0eSA9IFtdO1xuICAgIG91dC5waW5OdW0gPSBvdXQucGluVHlwZSA/IG91dC5waW5OdW0gOiBbXTtcbiAgfVxuXG4gIC8vIElmIHdlJ3ZlIGFkZGVkIG5ldyBmYWNpbGl0eSBzdHJpbmdzICh3ZSBtYXkgZmluZCBtdWx0aXBsZS4uLikgYWRkIGEgY29tbWEgdG8gZGVsaW5lYXRlLlxuICBpZiAoZmFjaWxpdHkubGVuZ3RoKSB7XG4gICAgY29uc3QgbGFzdCA9IG91dC5mYWNpbGl0eVtvdXQuZmFjaWxpdHkubGVuZ3RoIC0gMV07XG4gICAgbGFzdCAmJiAobGFzdC5zZXBhcmF0b3IgPSAnLCcpO1xuICB9XG5cbiAgb3V0LmZhY2lsaXR5ID0gWyAuLi5vdXQuZmFjaWxpdHksIC4uLmZhY2lsaXR5IF07XG4gIG91dC5mYWNpbGl0eVR5cGUgPSBmYWNpbGl0eVR5cGUgfHwgb3V0LmZhY2lsaXR5VHlwZTtcbiAgb3V0Lm51bWJlciA9IG51bWJlci5sZW5ndGggPyBudW1iZXIgOiBvdXQubnVtYmVyO1xuICBvdXQucGluTnVtID0gcGluTnVtLmxlbmd0aCA/IHBpbk51bSA6IG91dC5waW5OdW07XG5cbiAgb3V0LnVuaXRBYmJyID0gdW5pdEFiYnIgfHwgb3V0LnVuaXRBYmJyO1xuICBvdXQudW5pdE51bSA9IHVuaXROdW0ubGVuZ3RoID8gdW5pdE51bSA6IG91dC51bml0TnVtO1xuXG4gIC8vIElmIHdlIGhhdmUgYSBmYWNpbGl0eSB0eXBlIGFuZCBudW1iZXIsIGJ1dCBubyBmYWNpbGl0eSBuYW1lLCB1c2UgdGhlIG51bWJlciBhcyB0aGUgZmFjaWxpdHkgbmFtZSDigJMgaXRzIG1vcmUgYWNjdXJhdGUuXG4gIGlmICghb3V0LmNhcmUubGVuZ3RoICYmIG91dC5mYWNpbGl0eVR5cGUgJiYgb3V0Lm51bWJlci5sZW5ndGggJiYgIW91dC5mYWNpbGl0eS5sZW5ndGgpIHtcbiAgICBvdXQuZmFjaWxpdHkgPSBvdXQubnVtYmVyO1xuICAgIG91dC5udW1iZXIgPSBbXTtcbiAgfVxuXG4gIHJldHVybiBwb2ludGVyO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gcGFyc2UoLi4ubGluZXM6IHN0cmluZ1tdKTogSVNpdHVzIHtcbiAgY29uc3QgYWRkcmVzcyA9IGxpbmVzLmZpbHRlcihCb29sZWFuKS5qb2luKCdcXG4nKTtcbiAgY29uc3QgaGVhZCA9IHRva2VuaXplKGFkZHJlc3MpO1xuXG4gIGNvbnN0IE9VVDogV29ya2luZ1NpdHVzID0ge1xuICAgIGNhcmU6IFtdLFxuICAgIGZhY2lsaXR5OiBbXSxcbiAgICBmYWNpbGl0eVR5cGU6IG51bGwsXG4gICAgbnVtYmVyOiBbXSxcblxuICAgIHN0cmVldFByZURpcjogbnVsbCxcbiAgICBzdHJlZXROYW1lOiBbXSxcbiAgICBzdHJlZXRUeXBlOiBudWxsLFxuICAgIHN0cmVldFBvc3REaXI6IG51bGwsXG5cbiAgICBwaW5UeXBlOiBudWxsLFxuICAgIHBpbk51bTogW10sXG4gICAgdW5pdEFiYnI6IG51bGwsXG4gICAgdW5pdE51bTogW10sXG5cbiAgICBjaXR5OiBbXSxcbiAgICBzdGF0ZTogbnVsbCxcbiAgICB6aXA6IG51bGwsXG4gICAgemlwNDogbnVsbCxcbiAgICBjb3VudHJ5OiBDb3VudHJ5LlVTQSxcbiAgfTtcblxuICAvLyBUZXN0IGlmIHRoaXMgaXMgYSBmb3JlaWduIGFkZHJlc3MuIElmIHllcywgd2Ugc2hvcnQgY2lyY3VpdCBxdWlja2x5LlxuICBpZiAoaXNGb3JlaWduQWRkcmVzcyhoZWFkLCBPVVQpKSB7XG4gICAgcmV0dXJuIHRvRm9yZWlnblNpdHVzKE9VVCk7XG4gIH1cblxuICAvLyBFeHRyYWN0IFBJRHMgd2hlcmUgd2UgY2FuIGZpbmQgYSBkZWZpbml0ZSBtYXRjaC5cbiAgLy8gRG8gdGhpcyBiZWZvcmUgZXh0cmFjdGluZyBvYnZpb3VzIENhcmUtT2YgbGluZXMuXG4gIGV4dHJhY3RQSUQoaGVhZCwgT1VUKTtcblxuICAvLyBFeHRyYWN0IENhcmUgT2YgbGluZXMgd2hlcmUgd2UgY2FuIGZpbmQgYSBkZWZpbml0ZSBtYXRjaC5cbiAgZXh0cmFjdENhcmVPZihoZWFkLCBPVVQpO1xuXG4gIGxldCBwb2ludGVyOiBUb2tlbiB8IG51bGwgPSBoZWFkLm5leHQ7XG5cbiAgLy8gSWYgYSB0aGUgdXNlciBwdXRzIHRoZSB1bml0IHR5cGUgYW5kIG51bWJlciBmaXJzdCwgZXhjbHVkaW5nIG9uZXMgdGhhdCBjYW4gYWxzbyBiZVxuICAvLyBpbnRlcnByZXRlZCBhcyBmYWNpbGl0eSB0eXBlcywgb24gdGhlIGZpcnN0IGxpbmUsIG1ha2Ugc3VyZSB3ZSBwaWNrIGl0IHVwLlxuICBpZiAocG9pbnRlciAmJiBpc1VuaXRBYmJyKHBvaW50ZXIudmFsdWUpICYmICFpc0ZhY2lsaXR5VHlwZShwb2ludGVyLnZhbHVlKSkge1xuICAgIE9VVC51bml0QWJiciA9IHBvaW50ZXI7XG4gICAgcG9pbnRlciA9IHBvaW50ZXIubmV4dDtcbiAgICBjb25zdCBbIGlkcywgbmV4dCBdID0gY29uc3VtZUlkcyhwb2ludGVyLCB0cnVlKTtcbiAgICBPVVQudW5pdE51bSA9IGlkcztcbiAgICBwb2ludGVyID0gbmV4dDtcbiAgfVxuXG4gIC8vIElmIHRoZSB2ZXJ5IGZpcnN0IHRva2VuIGlzIG5vdCBhIG51bWJlciBvciBjb2RlLCB0aGVuIHRoZSBmaXJzdCBsaW5lIG9mIG91ciBhZGRyZXNzIG11c3QgYmVcbiAgLy8gdGhlIGZhY2lsaXR5IHR5cGUsIGZhY2lsaXR5IG5hbWUsIG9yIGFuIGFjY2lkZW50YWwgbGVhZGluZyB1bml0IG51bWJlci4gUmVwZWF0IGFkLW5hdXNlYW0uXG4gIGlmIChcbiAgICBwb2ludGVyICYmXG4gICAgKCFpc0xpa2VseUZpbmFsTGluZShwb2ludGVyKSB8fCAoIW5ld2xpbmVDb3VudChoZWFkKSAmJiAhT1VULmNhcmUubGVuZ3RoKSkgJiZcbiAgICAhaXNTdHJlZXRQcmVmaXgocG9pbnRlcj8udmFsdWUpICYmXG4gICAgKGlzT25seUlkcyhwb2ludGVyKSB8fCAhaXNOdW1iZXJPckNvZGUocG9pbnRlcikgfHwgKHBvaW50ZXIgJiYgKGlzT3JkaW5hbChwb2ludGVyLnZhbHVlKSkpKVxuICApIHtcbiAgICBwb2ludGVyID0gZXh0cmFjdEZhY2lsaXR5KHBvaW50ZXIsIE9VVCk7XG4gIH1cblxuICB3aGlsZSAoXG4gICAgIWlzTGlrZWx5RmluYWxMaW5lKHBvaW50ZXIpICYmXG4gICAgZmluZE5leHROZXdMaW5lKHBvaW50ZXIpICYmXG4gICAgIWlzU3RyZWV0UHJlZml4KHBvaW50ZXI/LnZhbHVlKSAmJlxuICAgIChpc09ubHlJZHMocG9pbnRlcikgfHwgIWlzTnVtYmVyT3JDb2RlKHBvaW50ZXIpIHx8IChwb2ludGVyICYmIChpc09yZGluYWwocG9pbnRlci52YWx1ZSkpKSlcbiAgKSB7XG4gICAgcG9pbnRlciA9IGV4dHJhY3RGYWNpbGl0eShwb2ludGVyLCBPVVQpO1xuICB9XG5cbiAgLy8gSWYgYSBmYWNpbGl0eSBsaXN0IGxlYWRzLCBhbmQgdGhlIHVzZXIgcHV0cyB0aGUgdW5pdCBudW1iZXIgZmlyc3Qgb24gYSBzZWNvbmQgbGluZSwgbWFrZSBzdXJlIHdlIHBpY2sgaXQgdXAuXG4gIGlmIChwb2ludGVyICYmIGlzVW5pdEFiYnIocG9pbnRlci52YWx1ZSkpIHtcbiAgICBPVVQudW5pdEFiYnIgPSBwb2ludGVyO1xuICAgIHBvaW50ZXIgPSBwb2ludGVyLm5leHQ7XG4gICAgY29uc3QgWyBpZHMsIG5leHQgXSA9IGNvbnN1bWVJZHMocG9pbnRlciwgdHJ1ZSk7XG4gICAgT1VULnVuaXROdW0gPSBpZHM7XG4gICAgcG9pbnRlciA9IG5leHQ7XG4gIH1cbiAgbGV0IGlzRmluYWxMaW5lID0gaXNMaWtlbHlGaW5hbExpbmUocG9pbnRlcik7XG5cbiAgLy8gSWYgd2UgaGF2ZSBhIHNpbmdsZSBsZXR0ZXIgc3RyZWV0IG5hbWUgYW5kIG5vIHN0cmVldCBzdWZmaXggKHVnaCkgZXg6IDMwMCBILCBCRU5JQ0lBLCBDQSA5NDUxMFxuICBpZiAoaXNGaW5hbExpbmUgJiYgT1VULnBpbk51bS5sZW5ndGggPiAxICYmIE9VVC5waW5OdW1bT1VULnBpbk51bS5sZW5ndGggLSAxXS52YWx1ZS5sZW5ndGggPT09IDEgJiYgT1VULnBpbk51bVtPVVQucGluTnVtLmxlbmd0aCAtIDFdLmFscGhhcyA9PT0gMSkge1xuICAgIGNvbnN0IHRva2VuID0gT1VULnBpbk51bS5wb3AoKTtcbiAgICB0b2tlbiAmJiBPVVQuc3RyZWV0TmFtZS5wdXNoKHRva2VuKTtcbiAgICBPVVQubnVtYmVyID0gT1VULnBpbk51bTtcbiAgICBPVVQucGluTnVtID0gW107XG4gIH1cblxuICAvLyBDb25zdW1lIGhvdXNlIG51bWJlclxuICB3aGlsZSAocG9pbnRlciAmJiAhaXNGaW5hbExpbmUpIHtcbiAgICAvLyBJZiB3ZSdyZSBvbiB0aGUgc2Vjb25kIGxpbmUsIG1vdmUgb24hXG4gICAgaWYgKE9VVC5udW1iZXIubGVuZ3RoICYmIHBvaW50ZXIucHJldiAmJiBpc05ld2xpbmVTZXAocG9pbnRlci5wcmV2KSkgeyBpc0ZpbmFsTGluZSA9IHRydWU7IGJyZWFrOyB9XG5cbiAgICAvLyBTdG9wIGNvbnN1bWluZyBob3VzZSBudW1iZXIgdmFsdWVzIHdoZW4gYSBkaXJlY3Rpb25hbCBvciBzdHJlZXQgbmFtZSBpcyBlbmNvdW50ZXJlZC5cbiAgICBjb25zdCB2YWwgPSBwb2ludGVyLnZhbHVlO1xuICAgIGlmIChwb2ludGVyLmFscGhhcyA+IDIgfHwgKHBvaW50ZXIuYWxwaGFzID49IDIgJiYgIXBvaW50ZXIuZGVjaW1hbHMpIHx8IGlzT3JkaW5hbCh2YWwpIHx8IGlzRGlyZWN0aW9uYWwodmFsKSB8fCBpc1VuaXRBYmJyKHZhbCkgfHwgaXNTdHJlZXRUeXBlKHZhbCkpIHtcbiAgICAgIGJyZWFrO1xuICAgIH1cblxuICAgIC8vIFNhdmUgdGhpcyB0b2tlbiBhcyBwYXJ0IG9mIHRoZSBob3VzZSBudW1iZXIuXG4gICAgLy8gQWxwaGFzIGFyZSBhbHdheXMgdXBwZXIgY2FzZSBmb3IgaG91c2UgbnVtYmVycy5cbiAgICBPVVQubnVtYmVyLnB1c2gocG9pbnRlcik7XG5cbiAgICBwb2ludGVyID0gcG9pbnRlci5uZXh0O1xuICB9XG5cbiAgLy8gQ29uc3VtZSBkaXJlY3Rpb25hbCBpZiBhdmFpbGFibGVcbiAgaWYgKHBvaW50ZXIgJiYgIWlzRmluYWxMaW5lICYmIGlzRGlyZWN0aW9uYWwocG9pbnRlci52YWx1ZSkpIHtcbiAgICBPVVQuc3RyZWV0UHJlRGlyID0gcG9pbnRlcjtcbiAgICBwb2ludGVyID0gcG9pbnRlci5uZXh0O1xuICB9XG5cbiAgLy8gQ29uc3VtZSBzdHJlZXQgcHJlZml4IGlmIGF2YWlsYWJsZVxuICBpZiAocG9pbnRlciAmJiAhaXNGaW5hbExpbmUgJiYgaXNTdHJlZXRQcmVmaXgocG9pbnRlci52YWx1ZSkpIHtcbiAgICBPVVQuc3RyZWV0VHlwZSA9IHBvaW50ZXI7XG4gICAgcG9pbnRlciA9IHBvaW50ZXIubmV4dDtcbiAgfVxuXG4gIC8vIC8vIFNvbWV0aW1lcyBzdHJlZXQgcHJlZml4ZXMgdXNlIHR3byB0b2tlbnMuXG4gIC8vIGlmIChwb2ludGVyICYmICFpc0ZpbmFsTGluZSAmJiBpc1N0cmVldFByZWZpeChwb2ludGVyLnZhbHVlICsgJyAnICsgcG9pbnRlci5uZXh0Py52YWx1ZSkpIHtcbiAgLy8gICBPVVQuc3RyZWV0VHlwZSA9IHBvaW50ZXI7XG4gIC8vICAgcG9pbnRlciA9IHBvaW50ZXIubmV4dD8ubmV4dCB8fCBudWxsO1xuICAvLyB9XG5cbiAgLy8gQ29uc3VtZSBzdHJlZXQgbmFtZSB1bnRpbCBlbmNvdW50ZXIgc3RyZWV0IHR5cGUsIHVuaXQgYWJicmV2aWF0aW9uLCBvciBhbm90aGVyIGRpcmVjdGlvbmFsLlxuICB3aGlsZSAocG9pbnRlciAmJiAhaXNGaW5hbExpbmUpIHtcbiAgICAvLyBJZiB3ZSdyZSBvbiB0aGUgc2Vjb25kIGxpbmUsIG1vdmUgb24hXG4gICAgaWYgKE9VVC5zdHJlZXROYW1lLmxlbmd0aCAmJiBwb2ludGVyLnByZXYgJiYgaXNOZXdsaW5lU2VwKHBvaW50ZXIucHJldikpIHsgaXNGaW5hbExpbmUgPSB0cnVlOyBicmVhazsgfVxuXG4gICAgLy8gQWRkcmVzc2VzIHdpdGggYSBzcGVjaWZpZWQgZmFjaWxpdHkgdHlwZSwgdGhhdCBpcyBub3QgYW4gdXJiYW5pemF0aW9uLCBzaG91bGQgbmV2ZXIgbmF2ZSBzdHJlZXQgbmFtZXMuXG4gICAgaWYgKE9VVC5mYWNpbGl0eVR5cGUgJiYgIWlzVXJiYW5pemF0aW9uKE9VVC5mYWNpbGl0eVR5cGUudmFsdWUpKSB7IGJyZWFrOyB9XG5cbiAgICAvLyBBIHBvdW5kIHNpZ24gc2VwYXJhdG9yIGluIHRoZSBzdHJlZXQgbmFtZSBtZWFucyB3ZSd2ZSBtb3ZlZCBvbiB0byBhIG5ldyBzZWdtZW50LlxuICAgIGlmIChwb2ludGVyLnByZXYgJiYgcG9pbnRlci5wcmV2LnNlcGFyYXRvciA9PT0gJyMnKSB7IGJyZWFrOyB9XG5cbiAgICAvLyBJZiB3ZSdyZSBub3QgdG9sZCB3aGVyZSB0aGUgXCJjaXR5IHN0YXRlIHppcFwiIGxpbmUgc3RhcnRzLCB3ZSBuZWVkIHRvIG1ha2UgYSBjaG9pY2Ugd2hlbiB0byBzdG9wIGFuZCBzdGFydCBjb25zdW1pbmcgY2l0eSBuYW1lcy5cbiAgICAvLyBJZiB0aGlzIGlzIHRoZSBjYXNlLCBhbmQgd2UgZW5jb3VudGVyIHNvbWV0aGluZyB0aGF0IGxvb2tzIGxpa2UgYSB1bml0IG51bWJlciwgbW92ZSBvbiB0byB0aGUgbmV4dCBzdGVwLlxuICAgIGlmIChPVVQuc3RyZWV0TmFtZS5sZW5ndGggJiYgIWZpbmROZXh0TmV3TGluZShwb2ludGVyKSAmJiBoYXNTdGF0ZVVuaXQocG9pbnRlcikgJiYgKGlzTnVtYmVyT3JDb2RlKHBvaW50ZXIpIHx8IGlzU3RyZWV0VHlwZShwb2ludGVyLnZhbHVlKSkpIHtcbiAgICAgIGJyZWFrO1xuICAgIH1cblxuICAgIC8vIEFjY291bnQgZm9yIFwiRGlyZWN0aW9uYWxcIiBTdHJlZXRzIChleDogU291dGggU3QuKVxuICAgIGlmIChPVVQuc3RyZWV0UHJlRGlyICYmICFPVVQuc3RyZWV0TmFtZS5sZW5ndGggJiYgaXNTdHJlZXRUeXBlKHBvaW50ZXIudmFsdWUpICYmICFpc1N0cmVldFByZWZpeChwb2ludGVyLnZhbHVlKSAmJiAhaGFzTGF0ZXJTdHJlZXRUeXBlKHBvaW50ZXIsIHRydWUpKSB7XG4gICAgICBPVVQuc3RyZWV0TmFtZSA9IFtPVVQuc3RyZWV0UHJlRGlyXTtcbiAgICAgIE9VVC5zdHJlZXRQcmVEaXIgPSBudWxsO1xuICAgICAgYnJlYWs7XG4gICAgfVxuXG4gICAgLy8gSWYgd2UgaGF2ZSBhIHNpbmdsZSBsZXR0ZXIgc3RyZWV0IG5hbWUgYW5kIG5vIHN0cmVldCBzdWZmaXggKHVnaCkgZXg6IDMwMCBIIEFwdDogMTExLCBCRU5JQ0lBLCBDQSA5NDUxMFxuICAgIGlmIChcbiAgICAgIE9VVC5udW1iZXIubGVuZ3RoID4gMSAmJlxuICAgICAgT1VULm51bWJlcltPVVQubnVtYmVyLmxlbmd0aCAtIDFdLnZhbHVlLmxlbmd0aCA9PT0gMSAmJlxuICAgICAgT1VULm51bWJlcltPVVQubnVtYmVyLmxlbmd0aCAtIDFdLmFscGhhcyA9PT0gMSAmJlxuICAgICAgKGlzVW5pdEFiYnIocG9pbnRlci52YWx1ZSkgfHwgaXNTdHJlZXRUeXBlKHBvaW50ZXIudmFsdWUpKVxuICAgICkge1xuICAgICAgY29uc3QgdG9rZW4gPSBPVVQubnVtYmVyLnBvcCgpO1xuICAgICAgdG9rZW4gJiYgT1VULnN0cmVldE5hbWUucHVzaCh0b2tlbik7XG4gICAgICBicmVhaztcbiAgICB9XG5cbiAgICAvLyBJZiB3ZSBoYXZlIGEgc3RyZWV0IG5hbWUsIGFuZCB3ZSdyZSBhdCBhbiBlbnVtZXJhYmxlIGVudHJ5LCBtb3ZlIG9uLlxuICAgIGlmIChPVVQuc3RyZWV0TmFtZS5sZW5ndGggJiYgKChpc1N0cmVldFR5cGUocG9pbnRlci52YWx1ZSkgJiYgIWhhc0xhdGVyU3RyZWV0VHlwZShwb2ludGVyLCB0cnVlKSkgfHwgaXNVbml0QWJicihwb2ludGVyLnZhbHVlKSB8fCBpc0RpcmVjdGlvbmFsKHBvaW50ZXIudmFsdWUpKSkge1xuICAgICAgYnJlYWs7XG4gICAgfVxuXG4gICAgT1VULnN0cmVldE5hbWUucHVzaChwb2ludGVyKTtcbiAgICBwb2ludGVyID0gcG9pbnRlci5uZXh0O1xuICB9XG5cbiAgLy8gQ29uc3VtZSBzdHJlZXQgdHlwZSwgdW5pdCBhYmJyLCBhbmQgZGlyZWN0aW9uYWwgaW4gdGhhdCBvcmRlciB1bnRpbCBubyBsb25nZXIgYXZhaWxhYmxlLlxuICAvLyBJZiBkdXBsaWNhdGUgdW5pdCBhYmJyZXZpYXRpb24gb3IgZGlyZWN0aW9uYWwgdG9rZW5zIGFwcGVhciBiZWZvcmUgYSBzdHJlZXQgdHlwZSwgYWRkIHRvXG4gIC8vIHRoZSBzdHJlZXQgbmFtZSBpbnN0ZWFkIG9mIG92ZXJ3cml0aW5nIHRoZSB2YWx1ZS5cbiAgaW50ZXJmYWNlIElXb3JraW5nVG9rZW5zIHtcbiAgICBzdHJlZXRUeXBlOiBUb2tlbiB8IG51bGw7XG4gICAgdW5pdEFiYnI6IFRva2VuIHwgbnVsbDtcbiAgICBzdHJlZXRQb3N0RGlyOiBUb2tlbiB8IG51bGw7XG4gIH1cblxuICBjb25zdCB3b3JraW5nOiBJV29ya2luZ1Rva2VucyA9IHtcbiAgICBzdHJlZXRUeXBlOiBudWxsLFxuICAgIHVuaXRBYmJyOiBudWxsLFxuICAgIHN0cmVldFBvc3REaXI6IG51bGwsXG4gIH07XG5cbiAgd2hpbGUgKHBvaW50ZXIgJiYgIWlzRmluYWxMaW5lKSB7XG4gICAgLy8gSWYgd2UncmUgb24gdGhlIHNlY29uZCBsaW5lLCBtb3ZlIG9uIHRvIHRoZSBjaXR5IHBhcnNlciFcbiAgICBpZiAocG9pbnRlci5wcmV2ICYmIGlzTmV3bGluZVNlcChwb2ludGVyLnByZXYpKSB7IGlzRmluYWxMaW5lID0gaXNMaWtlbHlGaW5hbExpbmUocG9pbnRlcik7IGJyZWFrOyB9XG5cbiAgICAvLyBJZiBpcyBhIHN0cmVldCB0eXBlLCBzYXZlIGl0IGFuZCBtb3ZlIG9uLlxuICAgIGlmIChpc1N0cmVldFR5cGUocG9pbnRlci52YWx1ZSkpIHtcbiAgICAgIGlmICh3b3JraW5nLnN0cmVldFR5cGUpIHtcbiAgICAgICAgT1VULnN0cmVldE5hbWUucHVzaCh3b3JraW5nLnN0cmVldFR5cGUpO1xuICAgICAgfVxuICAgICAgd29ya2luZy5zdHJlZXRUeXBlID0gcG9pbnRlcjtcbiAgICB9XG5cbiAgICAvLyBJZiBpcyBhIHVuaXQgYWJicmV2aWF0aW9uLCBkZWFsIHdpdGggZHVwbGljYXRlcyBpZiBzdHJlZXQgaXNuJ3QgZG9uZSBhbmQgc2F2ZS5cbiAgICBlbHNlIGlmIChpc1VuaXRBYmJyKHBvaW50ZXIudmFsdWUpKSB7XG4gICAgICBpZiAoKE9VVC51bml0QWJiciB8fCBoYXNMYXRlclN0cmVldFR5cGUocG9pbnRlcikpICYmIHdvcmtpbmcudW5pdEFiYnIpIHtcbiAgICAgICAgT1VULnN0cmVldE5hbWUucHVzaCh3b3JraW5nLnVuaXRBYmJyKTtcbiAgICAgIH1cbiAgICAgIHdvcmtpbmcudW5pdEFiYnIgPSBwb2ludGVyO1xuICAgIH1cblxuICAgIC8vIElmIGlzIGEgcG9zdCBkaXJlY3Rpb25hbCwgZGVhbCB3aXRoIGR1cGxpY2F0ZXMgaWYgc3RyZWV0IGlzbid0IGRvbmUgYW5kIHNhdmUuXG4gICAgZWxzZSBpZiAoaXNEaXJlY3Rpb25hbChwb2ludGVyLnZhbHVlKSAmJiAhd29ya2luZy51bml0QWJicikge1xuICAgICAgaWYgKHdvcmtpbmcuc3RyZWV0UG9zdERpciAmJiB3b3JraW5nLnN0cmVldFR5cGUgPT09IG51bGwpIHtcbiAgICAgICAgT1VULnN0cmVldE5hbWUucHVzaCh3b3JraW5nLnN0cmVldFBvc3REaXIpO1xuICAgICAgfVxuICAgICAgd29ya2luZy5zdHJlZXRQb3N0RGlyID0gcG9pbnRlcjtcbiAgICB9XG5cbiAgICAvLyBJZiB3ZSBkaWRuJ3QgZmluZCBhbnkgb2YgdGhlc2UgdGhpbmdzLCB3ZSBtdXN0IGJlIG1vdmluZyBvbiB0byB0aGUgdW5pdCBudW1iZXIhXG4gICAgZWxzZSB7XG4gICAgICBicmVhaztcbiAgICB9XG5cbiAgICAvLyBJZiB3ZSBmb3VuZCBvbmUgb2YgdGhlc2UgdG9rZW5zLCBtb3ZlIG9uIHRvIHRoZSBuZXh0IG9uZSB0byBjaGVjay5cbiAgICBwb2ludGVyID0gcG9pbnRlci5uZXh0O1xuICB9XG4gIC8vIFNhdmUgd2hhdCB3ZSd2ZSBmb3VuZCB0byB0aGUgT1VULiBEb24ndCBvdmVyd3JpdGUgdGhlIHVuaXRBYmJyIGlmIHdlIGFscmVhZHkgaGF2ZSBvbmUgZnJvbSBhIHByZXZpb3VzIGxpbmUuXG4gIE9VVC5zdHJlZXRUeXBlID0gd29ya2luZy5zdHJlZXRUeXBlIHx8IE9VVC5zdHJlZXRUeXBlO1xuICBPVVQuc3RyZWV0UG9zdERpciA9IHdvcmtpbmcuc3RyZWV0UG9zdERpciB8fCBPVVQuc3RyZWV0UG9zdERpcjtcbiAgT1VULnVuaXRBYmJyID0gT1VULnVuaXRBYmJyIHx8IHdvcmtpbmcudW5pdEFiYnI7XG4gIHdvcmtpbmcuc3RyZWV0UG9zdERpciA9IG51bGw7XG4gIHdvcmtpbmcudW5pdEFiYnIgPSBudWxsO1xuICB3b3JraW5nLnN0cmVldFR5cGUgPSBudWxsO1xuXG4gIC8vIElmIHdlIGhhdmUgYSBubyBzdHJlZXQgaW5mb3JtYXRpb24sIGFscmVhZHkgaGF2ZSB1bml0IGluZm8sIGFuZCBoYXZlIHRva2VucyBsZWZ0IGluIHRoaXMgbGluZVxuICAvLyB0aGVuIHdlJ3JlIGxvb2tpbmcgYXQgdGhlIHNlY29uZCBsaW5lIG9mIGEgZmFjaWxpdHkgc3R5bGUgYWRkcmVzcy4gU3RvcmUgdGhlIHJlc3Qgb2YgdGhpcyBpblxuICAvLyB0aGUgc3RyZWV0IG5hbWUgKHR5cGljYWxseSBhIGRlcGFydG1lbnQsIHVuaXZlcnNpdHkgbmFtZSwgZXRjKSBhbmQgbW92ZSBvbi5cbiAgaWYgKE9VVC51bml0QWJiciAmJiAhT1VULnN0cmVldE5hbWUubGVuZ3RoICYmIGZpbmROZXh0TmV3TGluZShwb2ludGVyKSkge1xuICAgIHdoaWxlIChwb2ludGVyICYmICFpc0ZpbmFsTGluZSkge1xuICAgICAgaWYgKHBvaW50ZXIucHJldiAmJiBpc05ld2xpbmVTZXAocG9pbnRlci5wcmV2KSkgeyBpc0ZpbmFsTGluZSA9IGlzTGlrZWx5RmluYWxMaW5lKHBvaW50ZXIpOyBicmVhazsgfVxuICAgICAgT1VULnN0cmVldE5hbWUucHVzaChwb2ludGVyKTtcbiAgICAgIHBvaW50ZXIgPSBwb2ludGVyPy5uZXh0O1xuICAgIH1cbiAgfVxuXG4gIGVsc2Uge1xuICAgIC8vIENvbnN1bWUgdW5pdCBudW0gdW50aWwgZW5jb3VudGVyIHN0cmVldCB0eXBlLCB1bml0IGFiYnJldmlhdGlvbiwgb3IgYW5vdGhlciBkaXJlY3Rpb25hbC5cbiAgICAvLyBVbml0IG51bWJlcnMgY2FuIGJlIHNpbmdsZSBsZXR0ZXJzIFwiU1wiLCBudW1iZXJzIFwiMTIzXCIsIG51bWVyaWNhbCBcIjEzdGhcIiwgZXRjLlxuICAgIGxldCB0b3NzT25OZXh0VW5pdE51bSA9IGZhbHNlO1xuICAgIGNvbnN0IGhhc0Z1dHVyZU5ld2xpbmUgPSAhIWZpbmROZXh0TmV3TGluZShwb2ludGVyKTtcbiAgICBjb25zdCBpbml0ID0gcG9pbnRlcj8ucHJldjtcbiAgICB3aGlsZSAocG9pbnRlciAmJiAhaXNGaW5hbExpbmUpIHtcbiAgICAgIC8vIElmIHdlJ3JlIG9uIHRoZSBzZWNvbmQgbGluZSwgbW92ZSBvbiB0byB0aGUgY2l0eSBwYXJzZXIhXG4gICAgICBpZiAocG9pbnRlci5wcmV2ICYmIHBvaW50ZXIucHJldiAhPT0gaW5pdCAmJiBpc05ld2xpbmVTZXAocG9pbnRlci5wcmV2KSkgeyBpc0ZpbmFsTGluZSA9IGlzTGlrZWx5RmluYWxMaW5lKHBvaW50ZXIpOyBicmVhazsgfVxuXG4gICAgICBpZiAoaXNGYWNpbGl0eVR5cGUocG9pbnRlci52YWx1ZSkgJiYgIWlzVW5pdEFiYnIocG9pbnRlci52YWx1ZSkpIHtcbiAgICAgICAgT1VULmZhY2lsaXR5VHlwZSA9IHBvaW50ZXI7XG4gICAgICAgIHBvaW50ZXIgPSBwb2ludGVyLm5leHQ7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuXG4gICAgICAvLyBJZiB0aGlzIGlzIGEgdW5pdCBhYmJyIGFzIGEgdHlwZSAoZXg6IFwiRmxvb3JcIiwgXCJQZW50aG91c2VcIiksIHNhdmUgaXQgYW5kIG1vdmUgb24uXG4gICAgICBpZiAoaXNVbml0QWJicihwb2ludGVyLnZhbHVlKSkge1xuICAgICAgICBjb25zdCBvbGRVbml0QWJicjogVG9rZW4gfCBudWxsID0gT1VULnVuaXRBYmJyO1xuICAgICAgICBPVVQudW5pdEFiYnIgPSBwb2ludGVyO1xuICAgICAgICBwb2ludGVyID0gcG9pbnRlci5uZXh0O1xuICAgICAgICAvLyBJZiBpcyBhIHVuaXQgYWJiciwgYW5kIHdlJ3ZlIGFscmVhZHkgZm91bmQgYSB1bml0IGFiYnJldmlhdGlvbiwgYmUgcHJlcGFyZWQgdG8gdG9zcyBvdXIgb2xkIHVuaXQgbnVtLlxuICAgICAgICBpZiAob2xkVW5pdEFiYnIgIT09IE9VVC51bml0QWJicikge1xuICAgICAgICAgIC8vIGJyZWFrO1xuICAgICAgICAgIHRvc3NPbk5leHRVbml0TnVtID0gdHJ1ZTtcbiAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIE9VVC51bml0TnVtID0gW107XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuXG4gICAgICAvLyBJZiB0aGlzIGlzIGEgZGlyZWN0aW9uYWwsIHB1c2ggdGhlIGFiYnJldmlhdGlvbiB0byB0aGUgdW5pdCBudW1iZXIgcGF0aC5cbiAgICAgIC8vIEV4OiBFYXN0IGFuZCBXZXN0IGJ1aWxkaW5ncyBvbiBhIGNhbXB1cyBcIjI1IFNpZXJyYSBTdCBBcHQgIzEyMyBFYXN0XCJcbiAgICAgIGlmIChpc0RpcmVjdGlvbmFsKHBvaW50ZXIudmFsdWUpICYmICghaGFzRnV0dXJlTmV3bGluZSB8fCBpc05ld2xpbmVTZXAocG9pbnRlcikpKSB7XG4gICAgICAgIHBvaW50ZXIudmFsdWUgPSB0b0RpcmVjdGlvbmFsKHBvaW50ZXIudmFsdWUpO1xuICAgICAgICBwb2ludGVyLmFscGhhcyA9IHBvaW50ZXIudmFsdWUubGVuZ3RoO1xuICAgICAgICBPVVQudW5pdE51bS5wdXNoKHBvaW50ZXIpO1xuICAgICAgICBwb2ludGVyID0gcG9pbnRlci5uZXh0O1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cblxuICAgICAgLy8gSWYgd2UncmUgbm90IHRvbGQgd2hlcmUgdGhlIFwiY2l0eSBzdGF0ZSB6aXBcIiBsaW5lIHN0YXJ0cywgd2UgbmVlZCB0byBtYWtlIGEgY2hvaWNlIHdoZW4gdG8gc3RvcCBhbmQgc3RhcnQgY29uc3VtaW5nIGNpdHkgbmFtZXMuXG4gICAgICAvLyBNb3N0IG9mIHRoZSB0aW1lLCB3ZSdsbCBqdXN0IGJlIGxlZnQgd2l0aCB1bml0IG51bWJlcnMgYXQgdGhpcyBwb2ludFxuICAgICAgaWYgKCFoYXNGdXR1cmVOZXdsaW5lICYmICFpc051bWJlck9yQ29kZShwb2ludGVyKSkge1xuICAgICAgICBicmVhaztcbiAgICAgIH1cblxuICAgICAgaWYgKHRvc3NPbk5leHRVbml0TnVtKSB7XG4gICAgICAgIE9VVC51bml0TnVtID0gW107XG4gICAgICAgIHRvc3NPbk5leHRVbml0TnVtID0gZmFsc2U7XG4gICAgICB9XG5cbiAgICAgIE9VVC51bml0TnVtLnB1c2gocG9pbnRlcik7XG5cbiAgICAgIHBvaW50ZXIgPSBwb2ludGVyLm5leHQ7XG4gICAgfVxuICB9XG5cbiAgLy8gQ29uc3VtZSBjaXR5IG5hbWUgdW50aWwgZW5jb3VudGVyIGEgc3RhdGUgYWJicmV2aWF0aW9uIG9yIGEgbnVtYmVyIChwcmVzdW1hYmx5IGEgemlwIGNvZGUpLlxuICB3aGlsZSAocG9pbnRlcikge1xuICAgIGlmICghcG9pbnRlci5zZXBhcmF0b3IgJiYgKGlzTnVtYmVyT3JDb2RlKHBvaW50ZXIpIHx8IGlzTGFzdFN0YXRlKHBvaW50ZXIpKSkge1xuICAgICAgYnJlYWs7XG4gICAgfVxuICAgIE9VVC5jaXR5LnB1c2gocG9pbnRlcik7XG4gICAgcG9pbnRlciA9IHBvaW50ZXIubmV4dDtcbiAgfVxuXG4gIC8vIENvbnN1bWUgU3RhdGUgaWYgYXZhaWxhYmxlXG4gIGlmIChwb2ludGVyICYmIGlzU3RhdGUocG9pbnRlci52YWx1ZSkpIHtcbiAgICBPVVQuc3RhdGUgPSBwb2ludGVyO1xuICAgIHBvaW50ZXIgPSBwb2ludGVyLm5leHQ7XG4gIH1cblxuICAvLyBJZiB3ZSdyZSBhdCB0aGUgZW5kIGFuZCB3ZSBoYXZlIGEgc3RyaW5nIHdpdGggbm8gYWxwaGFzLCBpdHMgYSB6aXAgY29kZS5cbiAgaWYgKHBvaW50ZXIgJiYgcG9pbnRlci5hbHBoYXMgPT09IDApIHtcbiAgICBPVVQuemlwID0gcG9pbnRlcjtcbiAgICBwb2ludGVyID0gcG9pbnRlci5uZXh0O1xuICB9XG5cbiAgLy8gSWYgd2UncmUgYXQgdGhlIGVuZCBhbmQgd2UgaGF2ZSBhIHN0cmluZyB3aXRoIG5vIGFscGhhcy4uLmFnYWluLCB0aGVuIGl0cyBhIHppcCs0IGNvZGUuXG4gIGlmIChwb2ludGVyICYmIHBvaW50ZXIuYWxwaGFzID09PSAwKSB7XG4gICAgT1VULnppcDQgPSBwb2ludGVyO1xuICAgIHBvaW50ZXIgPSBwb2ludGVyLm5leHQ7XG4gIH1cblxuICAvLyBDb21tb24gRXJyb3IgQ29ycmVjdGlvbnMhIE9yZGVyIGlzIGltcG9ydGFudCBoZXJlLlxuXG4gIC8vIFNvbWUgc3RyZWV0cyBoYXZlIHRoZSBzdHJlZXQgdHlwZSBhcyBhICpwcmVmaXgqIG5vdCBhICp0eXBlKi4gQ2F0Y2ggdGhlc2UuIElnbm9yZSBmb3IgXCJkaXJlY3Rpb25hbFwiIHN0cmVldHMgKGV4OiBTb3V0aCBTdC4pXG4gIGlmICghT1VULnN0cmVldFR5cGUgJiYgaXNTdHJlZXRUeXBlKE9VVC5zdHJlZXROYW1lWzBdPy52YWx1ZSkgJiYgKGlzTnVtYmVyT3JDb2RlKE9VVC5zdHJlZXROYW1lWzFdKSB8fCAoT1VULnN0cmVldE5hbWVbMV0/LnZhbHVlIHx8ICcnKS50b0xvd2VyQ2FzZSgpID09PSAnb2YnKSkge1xuICAgIE9VVC5zdHJlZXRUeXBlID0gT1VULnN0cmVldE5hbWUuc2hpZnQoKSBhcyBUb2tlbjtcbiAgfVxuXG4gIC8vIEFub3RoZXIgZXJyb3IgY2FzZS4gSWYgd2UgZG9uJ3QgaGF2ZSBhIHN0cmVldCB0eXBlLCBhbmQgdGhlIHN0cmVldCBuYW1lICppcyogYSB0eXBlLFxuICAvLyBzYXZlIGl0IGFzIHRoZSB0eXBlIHZhbHVlLiBFeDogMTAwIExha2UgQVBUIDIwMFxuICBpZiAoIU9VVC5zdHJlZXRUeXBlICYmIE9VVC5zdHJlZXROYW1lLmxlbmd0aCA9PT0gMSAmJiBpc1N0cmVldFR5cGUoT1VULnN0cmVldE5hbWVbMF0udmFsdWUpKSB7XG4gICAgT1VULnN0cmVldFR5cGUgPSBPVVQuc3RyZWV0TmFtZVswXTtcbiAgICBPVVQuc3RyZWV0TmFtZSA9IFtdO1xuICB9XG5cbiAgLy8gSWYgd2UgZG9uJ3QgaGF2ZSBhIHN0cmVldCB0eXBlIG9yIHVuaXQgYWJicmV2aWF0aW9uLCBjaGVjayB0byBtYWtlIHN1cmVcbiAgLy8gdGhlIHVuaXQgbnVtYmVyIGRpZG4ndCBhY2NpZGVudGFsbHkgZ2V0IGFwcGVuZGVkIHRvIHRoZSBzdHJlZXQgbmFtZS5cbiAgLy8gVGhpcyBpcyBhbiBlcnJvciBjYXNlIHdoZXJlIHdlIHRyeSB0byBkbyB0aGUgbGVzcyBsaWtlbHkgYmFkIHRoaW5nLlxuICBpZiAoT1VULnN0cmVldE5hbWUubGVuZ3RoICYmICFPVVQuc3RyZWV0VHlwZSAmJiAhT1VULnN0cmVldFBvc3REaXIgJiYgIU9VVC51bml0QWJicikge1xuICAgIGlmIChpc051bWVyaWNhbChPVVQuc3RyZWV0TmFtZVtPVVQuc3RyZWV0TmFtZS5sZW5ndGggLSAxXS52YWx1ZSkpIHtcbiAgICAgIE9VVC51bml0TnVtLnB1c2goT1VULnN0cmVldE5hbWUucG9wKCkgYXMgVG9rZW4pO1xuICAgIH1cbiAgfVxuXG4gIC8vIFdoZW4gd2UgaGF2ZSBhIGNpdHkgbmFtZSB0aGF0IGNvbnRhaW5zIGEgc3RyZWV0IHR5cGUgKGV4ICcyMTEgT0xJVkVSIFNUIEJVRU5BIFZJU1RBIDMxODAzJyksIGRvbid0XG4gIC8vIHB1bGwgdGhlIGNpdHkgbmFtZSBpbnRvIHRoZSBzdHJlZXQgbmFtZSBieSBhY2NpZGVudC5cbiAgaWYgKE9VVC5zdHJlZXRUeXBlICYmIE9VVC5zdHJlZXROYW1lLmxlbmd0aCAmJiAhT1VULmNpdHkubGVuZ3RoICYmIE9VVC51bml0TnVtLmxlbmd0aCA9PT0gMSAmJiBPVVQudW5pdE51bVswXS52YWx1ZS5sZW5ndGggPT09IDUgJiYgIU9VVC51bml0TnVtWzBdLmFscGhhcykge1xuICAgIGxldCBzdHJlZXRUeXBlOiBUb2tlbiB8IG51bGwgPSBudWxsO1xuICAgIGNvbnN0IHN0cmVldE5hbWU6IFRva2VuW10gPSBbXTtcbiAgICBjb25zdCBjaXR5OiBUb2tlbltdID0gW107XG4gICAgZm9yIChjb25zdCB0b2tlbiBvZiBPVVQuc3RyZWV0TmFtZSkge1xuICAgICAgaWYgKGlzU3RyZWV0VHlwZSh0b2tlbi52YWx1ZSkgJiYgIXN0cmVldFR5cGUpIHtcbiAgICAgICAgc3RyZWV0VHlwZSA9IHRva2VuO1xuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgIHN0cmVldFR5cGUgPyBjaXR5LnB1c2godG9rZW4pIDogc3RyZWV0TmFtZS5wdXNoKHRva2VuKTtcbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKHN0cmVldFR5cGUpIHtcbiAgICAgIGNpdHkucHVzaChPVVQuc3RyZWV0VHlwZSk7XG4gICAgICBPVVQuc3RyZWV0VHlwZSA9IHN0cmVldFR5cGU7XG4gICAgICBPVVQuc3RyZWV0TmFtZSA9IHN0cmVldE5hbWU7XG4gICAgICBPVVQuY2l0eSA9IGNpdHk7XG4gICAgICBPVVQuemlwID0gT1VULnVuaXROdW1bMF07XG4gICAgICBPVVQudW5pdE51bSA9IFtdO1xuICAgIH1cbiAgfVxuXG4gIC8vIElmIHdlIGhhdmUgbm8gc3RyZWV0IG5hbWUsIGFuZCB0aGUgbGFzdCBjaGFyYWN0ZXIgb2YgdGhlIGhvdXNlTnVtIGlzIGEgc2luZ2xlIGNoYXJhY3RlcixcbiAgLy8gVGhpcyBtdXN0IGJlIGEgc2luZ2xlIGxldHRlciBzdHJlZXQgbmFtZSEgRXg6IDEyMyBIIFN0LlxuICBpZiAoIU9VVC5zdHJlZXROYW1lLmxlbmd0aCAmJiBPVVQubnVtYmVyLmxlbmd0aCA+IDEpIHtcbiAgICBjb25zdCB3b3JraW5nOiBUb2tlbltdID0gW107XG4gICAgZG8ge1xuICAgICAgY29uc3QgdG9rZW4gPSBPVVQubnVtYmVyLnBvcCgpIGFzIFRva2VuO1xuICAgICAgaWYgKHdvcmtpbmcubGVuZ3RoICYmICF0b2tlbi5zZXBhcmF0b3IpIHtcbiAgICAgICAgT1VULm51bWJlci5wdXNoKHRva2VuKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICB3b3JraW5nLnVuc2hpZnQodG9rZW4pO1xuICAgIH0gd2hpbGUgKE9VVC5udW1iZXIubGVuZ3RoKTtcbiAgICBPVVQuc3RyZWV0TmFtZSA9IHdvcmtpbmc7XG4gIH1cblxuICAvLyBBQUFBQWFhYWFhbmQgYW5vdGhlci4gSWYgbm8gc3RyZWV0IG51bWJlciwgYnV0IHdlIGhhdmUgYSB1bml0IG51bWJlciwgYW5kIHRoZSBzdHJlZXQgdHlwZVxuICAvLyBpcyBub3Qgb25lIG9mIG91ciBzcGVjaWFsIHN0YW5kYWxvbmUgc3RyZWV0IGRlc2lnbmF0b3JzIChqdXN0ICdQTycgcmlnaHQgbm93IGZvciBQTyBCb3hlcyksXG4gIC8vIHRoZW4gdGhlIGlucHV0IG11c3QgaGF2ZSBsaXN0ZWQgdGhlIHN0cmVldCBudW1iZXIgYWZ0ZXIgdGhlIHN0cmVldCBuYW1lLlxuICAvLyBFeDogUyBTdCAzMDUsIFNhY3JhbWVudG8gQ0EsIGJ1dCBub3QgUE8gQm94IDEzMzdcbiAgaWYgKCFPVVQubnVtYmVyLmxlbmd0aCAmJiAoKE9VVC51bml0TnVtLmxlbmd0aCA9PT0gMSAmJiAhT1VULnVuaXRBYmJyKSB8fCAoT1VULnVuaXROdW0ubGVuZ3RoID4gMSAmJiAhT1VULmZhY2lsaXR5VHlwZSkpKSB7XG4gICAgT1VULm51bWJlci5wdXNoKE9VVC51bml0TnVtLnBvcCgpIGFzIFRva2VuKTtcbiAgfVxuXG4gIC8vIElmIHdlIGRvbid0IGhhdmUgYW4gZXhwbGljaXQgdW5pdCBhYmJyLCBhbmQgdGhlIHVuaXQgbnVtYmVyIGlzIG5vdCBhLi4uIG51bWJlcixcbiAgLy8gdGhlbiBpdCBtdXN0IGJlIGEgbWlzLW9yZGVyZWQgY29tcGFueSBuYW1lIGZpZWxkLlxuICBpZiAoIU9VVC51bml0QWJiciAmJiAhT1VULmNhcmUubGVuZ3RoICYmIE9VVC51bml0TnVtLmxlbmd0aCkge1xuICAgIGxldCBoYXNDb2RlID0gZmFsc2U7XG4gICAgZm9yIChjb25zdCB0b2tlbiBvZiBPVVQudW5pdE51bSkge1xuICAgICAgbGV0IGlzQ29kZSA9IGZhbHNlO1xuICAgICAgaWYgKGlzT3JkaW5hbCh0b2tlbi52YWx1ZSkpIHsgaXNDb2RlID0gZmFsc2U7IH1cbiAgICAgIGVsc2UgeyBpc0NvZGUgPSBpc051bWJlck9yQ29kZSh0b2tlbik7IH1cbiAgICAgIGhhc0NvZGUgPSBoYXNDb2RlIHx8IGlzQ29kZTtcbiAgICB9XG4gICAgaWYgKCFoYXNDb2RlKSB7XG4gICAgICBPVVQuY2FyZSA9IE9VVC51bml0TnVtO1xuICAgICAgT1VULnVuaXROdW0gPSBbXTtcbiAgICB9XG4gIH1cblxuICAvLyBGaXggc3BsaXQgUE8gQm94IG51bWJlcnMuIElmIGEgUE8gQm94IGhhcyBiZWVuIHByb3ZpZGVkLCB3ZSBjYW4gYXNzdW1lIHRoYXQgdGhlIG1vcmUgY29tbW9uIGh1bWFuXG4gIC8vIGVycm9yIHdpbGwgYmUgdG8gYWRkIGV4dHJhIHNwYWNlcyBvciBzZXBhcmF0b3JzIGluc3RlYWQgb2YgcHJvdmlkaW5nIHVuLWRlbGluZWF0ZWQgYWRkaXRpb25hbCBQSU5zLlxuICBpZiAodG9GYWNpbGl0eVR5cGUoT1VULmZhY2lsaXR5VHlwZT8udmFsdWUgfHwgJycpID09PSBGYWNpbGl0eVR5cGUuUE8gJiYgdG9Vbml0QWJicihPVVQudW5pdEFiYnI/LnZhbHVlIHx8ICcnKSA9PT0gVW5pdEFiYnIuQk9YICYmIE9VVC51bml0TnVtLmxlbmd0aCA+IDEpIHtcbiAgICBjb25zdCBmaXJzdCA9IE9VVC51bml0TnVtLnNoaWZ0KCkgYXMgVG9rZW47XG4gICAgZmlyc3Quc2VwYXJhdG9yID0gbnVsbDtcbiAgICBmb3IgKGNvbnN0IHRva2VuIG9mIE9VVC51bml0TnVtKSB7XG4gICAgICBmaXJzdC52YWx1ZSArPSB0b2tlbi52YWx1ZTtcbiAgICB9XG4gICAgT1VULnVuaXROdW0gPSBbZmlyc3RdO1xuICB9XG5cbiAgLy8gSWYgd2UgaGF2ZSBhIG5vbiBleHBsaWNpdGx5IG5hbWVkIGZhY2lsaXR5IHR5cGUsIGFuZCBubyBjYXJlLW9mIGZpZWxkIG9yIGEgcGluIG9mIGFuXG4gIC8vIHVua25vd24gdHlwZSwgcHJvbW90ZSB0aGUgYXJiaXRyYXJ5IFwiZmFjaWxpdHlcIiBuYW1lIHRvIHRoZSBjYXJlLW9mIGxpbmUuXG4gIGlmICghT1VULmZhY2lsaXR5VHlwZSAmJiBPVVQuZmFjaWxpdHkubGVuZ3RoICYmICFPVVQuY2FyZS5sZW5ndGgpIHtcbiAgICBPVVQuY2FyZSA9IE9VVC5mYWNpbGl0eTtcbiAgICBPVVQuZmFjaWxpdHkgPSBbXTtcbiAgfVxuXG4gIGlmIChPVVQuY2FyZS5sZW5ndGgpIHtcbiAgICBjb25zdCBsYXN0ID0gT1VULmNhcmVbT1VULmNhcmUubGVuZ3RoIC0gMV07XG4gICAgaWYgKGxhc3QgJiYgKGxhc3QudmFsdWUudG9VcHBlckNhc2UoKSA9PT0gJ0xJTUlURUQnIHx8IGxhc3QudmFsdWUudG9VcHBlckNhc2UoKSA9PT0gJ0xURCcpKSB7XG4gICAgICBPVVQuY2FyZS5wb3AoKTtcbiAgICB9XG4gIH1cblxuICBjb25zdCBsYXN0TnVtID0gT1VULm51bWJlcltPVVQubnVtYmVyLmxlbmd0aCAtIDFdO1xuICBpZiAoT1VULm51bWJlci5sZW5ndGggPiAxICYmIGxhc3ROdW0gJiYgKCFsYXN0TnVtLnByZXYuc2VwYXJhdG9yIHx8IGxhc3ROdW0uZGVjaW1hbHMgPT09IDApKSB7XG4gICAgT1VULnVuaXROdW0ucHVzaChPVVQubnVtYmVyLnBvcCgpIGFzIFRva2VuKTtcbiAgfVxuXG4gIGlmIChPVVQuZmFjaWxpdHlUeXBlICYmIHRvRmFjaWxpdHlUeXBlKE9VVC5mYWNpbGl0eVR5cGU/LnZhbHVlKSA9PT0gRmFjaWxpdHlUeXBlLlBPKSB7XG4gICAgT1VULnVuaXRBYmJyID0ge1xuICAgICAgdmFsdWU6IFVuaXRBYmJyLkJPWCxcbiAgICAgIHByZXY6IE9VVC5mYWNpbGl0eVR5cGUsXG4gICAgICBuZXh0OiBPVVQuZmFjaWxpdHlUeXBlLm5leHQsXG4gICAgICBkZWNpbWFsczogMCxcbiAgICAgIGFscGhhczogMyxcbiAgICAgIHNlcGFyYXRvcjogbnVsbCxcbiAgICAgIGlzRU9MOiBPVVQuZmFjaWxpdHlUeXBlLmlzRU9MLFxuICAgIH07XG4gICAgT1VULmZhY2lsaXR5VHlwZS5uZXh0ID0gT1VULnVuaXRBYmJyO1xuICB9XG5cbiAgLy8gQ09SUkVDVElPTiEgRm9yIG9yZGluYWwgdW5pdCBudW1iZXJzIGFwcGVhcmluZyBhZnRlciBzdHJlZXQgbmFtZSwgbGlrZSBcIjIwdGggRmxvb3JcIlxuICAvLyBpZiAoT1VULmZhY2lsaXR5Lmxlbmd0aCA9PT0gMSAmJiBpc1VuaXRBYmJyKE9VVC5mYWNpbGl0eVswXS52YWx1ZSkgJiYgT1VULnBpbk51bS5sZW5ndGggJiYgIU9VVC51bml0QWJiciAmJiAhT1VULnVuaXROdW0ubGVuZ3RoKSB7XG4gIC8vICAgT1VULnVuaXRBYmJyID0gT1VULmNhcmVbMF07XG4gIC8vICAgT1VULnVuaXROdW0gPSBPVVQucGluTnVtO1xuICAvLyAgIE9VVC5jYXJlID0gW107XG4gIC8vICAgT1VULnBpbk51bSA9IFtdO1xuICAvLyB9XG5cbiAgcmV0dXJuIHRvU2l0dXMoT1VUKTtcbn1cbiJdfQ==