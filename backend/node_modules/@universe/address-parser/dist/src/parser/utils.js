const alphas = new Set([
    'A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O',
    'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z',
    'a', 'b', 'c', 'd', 'e', 'f', 'g', 'h', 'i', 'j', 'k', 'l', 'm', 'n', 'o',
    'p', 'q', 'r', 's', 't', 'u', 'v', 'w', 'x', 'y', 'z',
]);
const decimals = new Set([
    '0', '1', '2', '3', '4', '5', '6', '7', '8', '9',
]);
const forceLowerCase = new Set([
    'an', 'the', 'of', 'and', 'but', 'for', 'at', 'by', 'from', 'in', 'on',
]);
export function titleCase(str) {
    str = str.toLowerCase().trim();
    if (forceLowerCase.has(str)) {
        return str;
    }
    for (let i = 0; i < str.length; i++) {
        if (i - 1 < 0 || (!alphas.has(str[i - 1]) && alphas.has(str[i]))) {
            str = str.slice(0, i) + str[i].toUpperCase() + str.slice(i + 1);
        }
    }
    // Ordinals don't get titled.
    str = str.replace(/(\d)St/g, '$1st');
    str = str.replace(/(\d)Nd/g, '$1nd');
    str = str.replace(/(\d)Rd/g, '$1rd');
    str = str.replace(/(\d)Th/g, '$1th');
    return str;
}
export function isNumerical(str) {
    let isNumber = true;
    for (let i = 0; i < str.length; i++) {
        isNumber = isNumber && decimals.has(str[i]);
    }
    return isNumber;
}
const ordinals = {
    FIRST: '1st',
    SECOND: '2nd',
    THIRD: '3rd',
    FOURTH: '4th',
    FIFTH: '5th',
    SIXTH: '6th',
    SEVENTH: '7th',
    EIGHTH: '8th',
    NINTH: '9th',
    TENTH: '10th',
    ELEVENTH: '11th',
    TWELFTH: '12th',
    THIRTEENTH: '13th',
    FOURTEENTH: '14th',
    FIFTEENTH: '15th',
};
const ORDINAL_MAP = new Map();
for (const [key, value] of Object.entries(ordinals)) {
    ORDINAL_MAP.set(key.toUpperCase(), value.toUpperCase());
    ORDINAL_MAP.set(value.toUpperCase(), key.toUpperCase());
}
export function isOrdinal(str) {
    return !!(str && str.match(/[0-9]+(st|nd|rd|th)/i));
}
export function isOrder(val) {
    return !!(ordinals[val.toUpperCase()] && ORDINAL_MAP.has(val.toUpperCase()));
}
export function ordinalToOrder(val) {
    if (!isOrdinal(val)) {
        return val;
    }
    return titleCase(ORDINAL_MAP.get(val.toUpperCase()) || val);
}
export function orderToOrdinal(val) {
    if (!isOrder(val)) {
        return val;
    }
    return titleCase(ORDINAL_MAP.get(val.toUpperCase()) || val);
}
export function normalize(str) {
    if (!str) {
        return '';
    }
    return String(str).toUpperCase();
}
// Unit numbers should always have numbers followed by letters and be sentence case
export function normalizeUnitNum(tokens) {
    const out = [];
    const suffix = [];
    for (const token of tokens) {
        if (!isOrdinal(token.value)) {
            // Push single character prefixes to the end
            if (token.decimals && token.alphas === 1 && /[a-z]/i.test(token.value[0])) {
                suffix.push(token.value[0].toUpperCase());
                suffix.push(' ');
                token.value = token.value.slice(1);
                token.alphas = 0;
            }
            // Push double character prefixes to the end
            if (token.decimals && token.alphas === 2 && /[a-z]/i.test(token.value[0]) && /[a-z]/i.test(token.value[1])) {
                suffix.push(token.value[0].toUpperCase());
                suffix.push(token.value[1].toUpperCase());
                suffix.push(' ');
                token.value = token.value.slice(1);
                token.alphas = 0;
            }
            // Push single character suffixes to the end
            if (token.decimals && token.alphas === 1 && /[a-z]/i.test(token.value[token.value.length - 1])) {
                suffix.push(token.value[token.value.length - 1].toUpperCase());
                suffix.push(' ');
                token.value = token.value.slice(0, -1);
                token.alphas = 0;
            }
            // Push double character suffixes to the end
            if (token.decimals && token.alphas === 2 && /[a-z]/i.test(token.value[token.value.length - 1]) && /[a-z]/i.test(token.value[token.value.length - 2])) {
                suffix.push(token.value[token.value.length - 2].toUpperCase());
                suffix.push(token.value[token.value.length - 1].toUpperCase());
                suffix.push(' ');
                token.value = token.value.slice(0, -2);
                token.alphas = 0;
            }
        }
        const value = (token.decimals && token.alphas) ? isOrdinal(token.value) ? token.value.toLowerCase() : token.value.toUpperCase() : titleCase(token.value);
        // All alpha codes are put on the suffix and upper cased.
        if (!token.decimals && value.length <= 3) {
            suffix.push(value.toUpperCase());
            switch (token.separator) {
                case '-':
                    suffix.push('-');
                    break;
                default: suffix.push(' ');
            }
        }
        else {
            out.push(value);
            switch (token.separator) {
                case '#':
                    out.push(' # ');
                    break;
                case '.':
                    out.push('.');
                    break;
                case '&':
                    out.push(' & ');
                    break;
                case ',':
                    out.push(' ');
                    break;
                case '-':
                    out.push('-');
                    break;
                case '/':
                    out.push('/');
                    break;
                default: out.push('');
            }
        }
    }
    suffix.pop();
    out.pop();
    // Ordinals don't get titled.
    return [...out, ...suffix].join('').trim().replace(/(\d)St/gi, '$1st').replace(/(\d)Nd/gi, '$1nd').replace(/(\d)Rd/gi, '$1rd').replace(/(\d)Th/gi, '$1th');
}
export function normalizeHouseNum(str) {
    if (str === null) {
        return null;
    }
    str = str.toUpperCase();
    let out = '';
    for (let i = 0; i < str.length; i++) {
        const prev = str[i - 1];
        const char = str[i];
        const next = str[i + 1];
        // Place a space between decimals and alphas
        if ((decimals.has(prev) && alphas.has(char)) || (alphas.has(prev) && decimals.has(char))) {
            // out += ` ${char}`;
        }
        // Remove unnecessary dashes between decimals and alphas
        if (char === '-' && (decimals.has(prev) && alphas.has(next))) {
            out += ' ';
        }
        else {
            out += char;
        }
    }
    return out.trim();
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXRpbHMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvcGFyc2VyL3V0aWxzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUVBLE1BQU0sTUFBTSxHQUFHLElBQUksR0FBRyxDQUFDO0lBQ3JCLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRztJQUN6RSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRztJQUVyRCxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUc7SUFDekUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUc7Q0FDdEQsQ0FBQyxDQUFDO0FBRUgsTUFBTSxRQUFRLEdBQUcsSUFBSSxHQUFHLENBQUM7SUFDdkIsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRztDQUNqRCxDQUFDLENBQUM7QUFFSCxNQUFNLGNBQWMsR0FBRyxJQUFJLEdBQUcsQ0FBQztJQUM3QixJQUFJLEVBQUUsS0FBSyxFQUFF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QUksR0FBRyxDQUFDO1FBQ2IsQ0FBQzthQUNJLENBQUM7WUFDSixHQUFHLElBQUksSUFBSSxDQUFDO1FBQ2QsQ0FBQztJQUNILENBQUM7SUFFRCxPQUFPLEdBQUcsQ0FBQyxJQUFJLEVBQUUsQ0FBQztBQUNwQixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgVG9rZW4gfSBmcm9tICcuL3Rva2VuaXplci5qcyc7XG5cbmNvbnN0IGFscGhhcyA9IG5ldyBTZXQoW1xuICAnQScsICdCJywgJ0MnLCAnRCcsICdFJywgJ0YnLCAnRycsICdIJywgJ0knLCAnSicsICdLJywgJ0wnLCAnTScsICdOJywgJ08nLFxuICAnUCcsICdRJywgJ1InLCAnUycsICdUJywgJ1UnLCAnVicsICdXJywgJ1gnLCAnWScsICdaJyxcblxuICAnYScsICdiJywgJ2MnLCAnZCcsICdlJywgJ2YnLCAnZycsICdoJywgJ2knLCAnaicsICdrJywgJ2wnLCAnbScsICduJywgJ28nLFxuICAncCcsICdxJywgJ3InLCAncycsICd0JywgJ3UnLCAndicsICd3JywgJ3gnLCAneScsICd6Jyxcbl0pO1xuXG5jb25zdCBkZWNpbWFscyA9IG5ldyBTZXQoW1xuICAnMCcsICcxJywgJzInLCAnMycsICc0JywgJzUnLCAnNicsICc3JywgJzgnLCAnOScsXG5dKTtcblxuY29uc3QgZm9yY2VMb3dlckNhc2UgPSBuZXcgU2V0KFtcbiAgJ2FuJywgJ3RoZScsICdvZicsICdhbmQnLCAnYnV0JywgJ2ZvcicsICdhdCcsICdieScsICdmcm9tJywgJ2luJywgJ29uJyxcbl0pO1xuXG5leHBvcnQgZnVuY3Rpb24gdGl0bGVDYXNlKHN0cjogc3RyaW5nKTogc3RyaW5nIHtcbiAgc3RyID0gc3RyLnRvTG93ZXJDYXNlKCkudHJpbSgpO1xuXG4gIGlmIChmb3JjZUxvd2VyQ2FzZS5oYXMoc3RyKSkge1xuICAgIHJldHVybiBzdHI7XG4gIH1cblxuICBmb3IgKGxldCBpID0gMDsgaSA8IHN0ci5sZW5ndGg7IGkrKykge1xuICAgIGlmIChpIC0gMSA8IDAgfHwgKCFhbHBoYXMuaGFzKHN0cltpIC0gMV0pICYmIGFscGhhcy5oYXMoc3RyW2ldKSkpIHtcbiAgICAgIHN0ciA9IHN0ci5zbGljZSgwLCBpKSArIHN0cltpXS50b1VwcGVyQ2FzZSgpICsgc3RyLnNsaWNlKGkgKyAxKTtcbiAgICB9XG4gIH1cblxuICAvLyBPcmRpbmFscyBkb24ndCBnZXQgdGl0bGVkLlxuICBzdHIgPSBzdHIucmVwbGFjZSgvKFxcZClTdC9nLCAnJDFzdCcpO1xuICBzdHIgPSBzdHIucmVwbGFjZSgvKFxcZClOZC9nLCAnJDFuZCcpO1xuICBzdHIgPSBzdHIucmVwbGFjZSgvKFxcZClSZC9nLCAnJDFyZCcpO1xuICBzdHIgPSBzdHIucmVwbGFjZSgvKFxcZClUaC9nLCAnJDF0aCcpO1xuXG4gIHJldHVybiBzdHI7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBpc051bWVyaWNhbChzdHI6IHN0cmluZyk6IGJvb2xlYW4ge1xuICBsZXQgaXNOdW1iZXIgPSB0cnVlO1xuICBmb3IgKGxldCBpID0gMDsgaSA8IHN0ci5sZW5ndGg7IGkrKykge1xuICAgIGlzTnVtYmVyID0gaXNOdW1iZXIgJiYgZGVjaW1hbHMuaGFzKHN0cltpXSk7XG4gIH1cbiAgcmV0dXJuIGlzTnVtYmVyO1xufVxuXG5jb25zdCBvcmRpbmFscyA9IHtcbiAgRklSU1Q6ICcxc3QnLFxuICBTRUNPTkQ6ICcybmQnLFxuICBUSElSRDogJzNyZCcsXG4gIEZPVVJUSDogJzR0aCcsXG4gIEZJRlRIOiAnNXRoJyxcbiAgU0lYVEg6ICc2dGgnLFxuICBTRVZFTlRIOiAnN3RoJyxcbiAgRUlHSFRIOiAnOHRoJyxcbiAgTklOVEg6ICc5dGgnLFxuICBURU5USDogJzEwdGgnLFxuICBFTEVWRU5USDogJzExdGgnLFxuICBUV0VMRlRIOiAnMTJ0aCcsXG4gIFRISVJURUVOVEg6ICcxM3RoJyxcbiAgRk9VUlRFRU5USDogJzE0dGgnLFxuICBGSUZURUVOVEg6ICcxNXRoJyxcbn07XG5cbmNvbnN0IE9SRElOQUxfTUFQOiBNYXA8c3RyaW5nLCBzdHJpbmc+ID0gbmV3IE1hcCgpO1xuZm9yIChjb25zdCBbIGtleSwgdmFsdWUgXSBvZiBPYmplY3QuZW50cmllcyhvcmRpbmFscykpIHtcbiAgT1JESU5BTF9NQVAuc2V0KGtleS50b1VwcGVyQ2FzZSgpLCB2YWx1ZS50b1VwcGVyQ2FzZSgpKTtcbiAgT1JESU5BTF9NQVAuc2V0KHZhbHVlLnRvVXBwZXJDYXNlKCksIGtleS50b1VwcGVyQ2FzZSgpKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGlzT3JkaW5hbChzdHI6IHN0cmluZyB8IG51bGwpOiBib29sZWFuIHtcbiAgcmV0dXJuICEhKHN0ciAmJiBzdHIubWF0Y2goL1swLTldKyhzdHxuZHxyZHx0aCkvaSkpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gaXNPcmRlcih2YWw6IHN0cmluZyk6IGJvb2xlYW4ge1xuICByZXR1cm4gISEob3JkaW5hbHNbdmFsLnRvVXBwZXJDYXNlKCkgYXMga2V5b2YgdHlwZW9mIG9yZGluYWxzXSAmJiBPUkRJTkFMX01BUC5oYXModmFsLnRvVXBwZXJDYXNlKCkpKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIG9yZGluYWxUb09yZGVyKHZhbDogc3RyaW5nKTogc3RyaW5nIHtcbiAgaWYgKCFpc09yZGluYWwodmFsKSkgeyByZXR1cm4gdmFsOyB9XG4gIHJldHVybiB0aXRsZUNhc2UoT1JESU5BTF9NQVAuZ2V0KHZhbC50b1VwcGVyQ2FzZSgpKSB8fCB2YWwpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gb3JkZXJUb09yZGluYWwodmFsOiBzdHJpbmcpOiBzdHJpbmcge1xuICBpZiAoIWlzT3JkZXIodmFsKSkgeyByZXR1cm4gdmFsOyB9XG4gIHJldHVybiB0aXRsZUNhc2UoT1JESU5BTF9NQVAuZ2V0KHZhbC50b1VwcGVyQ2FzZSgpKSB8fCB2YWwpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gbm9ybWFsaXplKHN0cjogc3RyaW5nKTogc3RyaW5nIHtcbiAgaWYgKCFzdHIpIHsgcmV0dXJuICcnOyB9XG4gIHJldHVybiBTdHJpbmcoc3RyKS50b1VwcGVyQ2FzZSgpO1xufVxuXG4vLyBVbml0IG51bWJlcnMgc2hvdWxkIGFsd2F5cyBoYXZlIG51bWJlcnMgZm9sbG93ZWQgYnkgbGV0dGVycyBhbmQgYmUgc2VudGVuY2UgY2FzZVxuZXhwb3J0IGZ1bmN0aW9uIG5vcm1hbGl6ZVVuaXROdW0odG9rZW5zOiBUb2tlbltdKTogc3RyaW5nIHwgbnVsbCB7XG4gIGNvbnN0IG91dCA9IFtdO1xuICBjb25zdCBzdWZmaXggPSBbXTtcbiAgZm9yIChjb25zdCB0b2tlbiBvZiB0b2tlbnMpIHtcbiAgICBpZiAoIWlzT3JkaW5hbCh0b2tlbi52YWx1ZSkpIHtcbiAgICAgIC8vIFB1c2ggc2luZ2xlIGNoYXJhY3RlciBwcmVmaXhlcyB0byB0aGUgZW5kXG4gICAgICBpZiAodG9rZW4uZGVjaW1hbHMgJiYgdG9rZW4uYWxwaGFzID09PSAxICYmIC9bYS16XS9pLnRlc3QodG9rZW4udmFsdWVbMF0pKSB7XG4gICAgICAgIHN1ZmZpeC5wdXNoKHRva2VuLnZhbHVlWzBdLnRvVXBwZXJDYXNlKCkpO1xuICAgICAgICBzdWZmaXgucHVzaCgnICcpO1xuICAgICAgICB0b2tlbi52YWx1ZSA9IHRva2VuLnZhbHVlLnNsaWNlKDEpO1xuICAgICAgICB0b2tlbi5hbHBoYXMgPSAwO1xuICAgICAgfVxuXG4gICAgICAvLyBQdXNoIGRvdWJsZSBjaGFyYWN0ZXIgcHJlZml4ZXMgdG8gdGhlIGVuZFxuICAgICAgaWYgKHRva2VuLmRlY2ltYWxzICYmIHRva2VuLmFscGhhcyA9PT0gMiAmJiAvW2Etel0vaS50ZXN0KHRva2VuLnZhbHVlWzBdKSAmJiAvW2Etel0vaS50ZXN0KHRva2VuLnZhbHVlWzFdKSkge1xuICAgICAgICBzdWZmaXgucHVzaCh0b2tlbi52YWx1ZVswXS50b1VwcGVyQ2FzZSgpKTtcbiAgICAgICAgc3VmZml4LnB1c2godG9rZW4udmFsdWVbMV0udG9VcHBlckNhc2UoKSk7XG4gICAgICAgIHN1ZmZpeC5wdXNoKCcgJyk7XG4gICAgICAgIHRva2VuLnZhbHVlID0gdG9rZW4udmFsdWUuc2xpY2UoMSk7XG4gICAgICAgIHRva2VuLmFscGhhcyA9IDA7XG4gICAgICB9XG5cbiAgICAgIC8vIFB1c2ggc2luZ2xlIGNoYXJhY3RlciBzdWZmaXhlcyB0byB0aGUgZW5kXG4gICAgICBpZiAodG9rZW4uZGVjaW1hbHMgJiYgdG9rZW4uYWxwaGFzID09PSAxICYmIC9bYS16XS9pLnRlc3QodG9rZW4udmFsdWVbdG9rZW4udmFsdWUubGVuZ3RoIC0gMV0pKSB7XG4gICAgICAgIHN1ZmZpeC5wdXNoKHRva2VuLnZhbHVlW3Rva2VuLnZhbHVlLmxlbmd0aCAtIDFdLnRvVXBwZXJDYXNlKCkpO1xuICAgICAgICBzdWZmaXgucHVzaCgnICcpO1xuICAgICAgICB0b2tlbi52YWx1ZSA9IHRva2VuLnZhbHVlLnNsaWNlKDAsIC0xKTtcbiAgICAgICAgdG9rZW4uYWxwaGFzID0gMDtcbiAgICAgIH1cblxuICAgICAgLy8gUHVzaCBkb3VibGUgY2hhcmFjdGVyIHN1ZmZpeGVzIHRvIHRoZSBlbmRcbiAgICAgIGlmICh0b2tlbi5kZWNpbWFscyAmJiB0b2tlbi5hbHBoYXMgPT09IDIgJiYgL1thLXpdL2kudGVzdCh0b2tlbi52YWx1ZVt0b2tlbi52YWx1ZS5sZW5ndGggLSAxXSkgJiYgL1thLXpdL2kudGVzdCh0b2tlbi52YWx1ZVt0b2tlbi52YWx1ZS5sZW5ndGggLSAyXSkpIHtcbiAgICAgICAgc3VmZml4LnB1c2godG9rZW4udmFsdWVbdG9rZW4udmFsdWUubGVuZ3RoIC0gMl0udG9VcHBlckNhc2UoKSk7XG4gICAgICAgIHN1ZmZpeC5wdXNoKHRva2VuLnZhbHVlW3Rva2VuLnZhbHVlLmxlbmd0aCAtIDFdLnRvVXBwZXJDYXNlKCkpO1xuICAgICAgICBzdWZmaXgucHVzaCgnICcpO1xuICAgICAgICB0b2tlbi52YWx1ZSA9IHRva2VuLnZhbHVlLnNsaWNlKDAsIC0yKTtcbiAgICAgICAgdG9rZW4uYWxwaGFzID0gMDtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBjb25zdCB2YWx1ZSA9ICh0b2tlbi5kZWNpbWFscyAmJiB0b2tlbi5hbHBoYXMpID8gaXNPcmRpbmFsKHRva2VuLnZhbHVlKSA/IHRva2VuLnZhbHVlLnRvTG93ZXJDYXNlKCkgOiB0b2tlbi52YWx1ZS50b1VwcGVyQ2FzZSgpIDogdGl0bGVDYXNlKHRva2VuLnZhbHVlKTtcblxuICAgIC8vIEFsbCBhbHBoYSBjb2RlcyBhcmUgcHV0IG9uIHRoZSBzdWZmaXggYW5kIHVwcGVyIGNhc2VkLlxuICAgIGlmICghdG9rZW4uZGVjaW1hbHMgJiYgdmFsdWUubGVuZ3RoIDw9IDMpIHtcbiAgICAgIHN1ZmZpeC5wdXNoKHZhbHVlLnRvVXBwZXJDYXNlKCkpO1xuICAgICAgc3dpdGNoICh0b2tlbi5zZXBhcmF0b3IpIHtcbiAgICAgICAgY2FzZSAnLSc6IHN1ZmZpeC5wdXNoKCctJyk7IGJyZWFrO1xuICAgICAgICBkZWZhdWx0OiBzdWZmaXgucHVzaCgnICcpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGVsc2Uge1xuICAgICAgb3V0LnB1c2godmFsdWUpO1xuICAgICAgc3dpdGNoICh0b2tlbi5zZXBhcmF0b3IpIHtcbiAgICAgICAgY2FzZSAnIyc6IG91dC5wdXNoKCcgIyAnKTsgYnJlYWs7XG4gICAgICAgIGNhc2UgJy4nOiBvdXQucHVzaCgnLicpOyBicmVhaztcbiAgICAgICAgY2FzZSAnJic6IG91dC5wdXNoKCcgJiAnKTsgYnJlYWs7XG4gICAgICAgIGNhc2UgJywnOiBvdXQucHVzaCgnICcpOyBicmVhaztcbiAgICAgICAgY2FzZSAnLSc6IG91dC5wdXNoKCctJyk7IGJyZWFrO1xuICAgICAgICBjYXNlICcvJzogb3V0LnB1c2goJy8nKTsgYnJlYWs7XG4gICAgICAgIGRlZmF1bHQ6IG91dC5wdXNoKCcnKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBzdWZmaXgucG9wKCk7XG4gIG91dC5wb3AoKTtcblxuICAvLyBPcmRpbmFscyBkb24ndCBnZXQgdGl0bGVkLlxuICByZXR1cm4gWyAuLi5vdXQsIC4uLnN1ZmZpeCBdLmpvaW4oJycpLnRyaW0oKS5yZXBsYWNlKC8oXFxkKVN0L2dpLCAnJDFzdCcpLnJlcGxhY2UoLyhcXGQpTmQvZ2ksICckMW5kJykucmVwbGFjZSgvKFxcZClSZC9naSwgJyQxcmQnKS5yZXBsYWNlKC8oXFxkKVRoL2dpLCAnJDF0aCcpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gbm9ybWFsaXplSG91c2VOdW0oc3RyOiBzdHJpbmcgfCBudWxsKTogc3RyaW5nIHwgbnVsbCB7XG4gIGlmIChzdHIgPT09IG51bGwpIHsgcmV0dXJuIG51bGw7IH1cbiAgc3RyID0gc3RyLnRvVXBwZXJDYXNlKCk7XG4gIGxldCBvdXQgPSAnJztcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBzdHIubGVuZ3RoOyBpKyspIHtcbiAgICBjb25zdCBwcmV2ID0gc3RyW2kgLSAxXTtcbiAgICBjb25zdCBjaGFyID0gc3RyW2ldO1xuICAgIGNvbnN0IG5leHQgPSBzdHJbaSArIDFdO1xuICAgIC8vIFBsYWNlIGEgc3BhY2UgYmV0d2VlbiBkZWNpbWFscyBhbmQgYWxwaGFzXG4gICAgaWYgKChkZWNpbWFscy5oYXMocHJldikgJiYgYWxwaGFzLmhhcyhjaGFyKSkgfHwgKGFscGhhcy5oYXMocHJldikgJiYgZGVjaW1hbHMuaGFzKGNoYXIpKSkge1xuICAgICAgLy8gb3V0ICs9IGAgJHtjaGFyfWA7XG4gICAgfVxuICAgIC8vIFJlbW92ZSB1bm5lY2Vzc2FyeSBkYXNoZXMgYmV0d2VlbiBkZWNpbWFscyBhbmQgYWxwaGFzXG4gICAgaWYgKGNoYXIgPT09ICctJyAmJiAoZGVjaW1hbHMuaGFzKHByZXYpICYmIGFscGhhcy5oYXMobmV4dCkpKSB7XG4gICAgICBvdXQgKz0gJyAnO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIG91dCArPSBjaGFyO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiBvdXQudHJpbSgpO1xufVxuIl19